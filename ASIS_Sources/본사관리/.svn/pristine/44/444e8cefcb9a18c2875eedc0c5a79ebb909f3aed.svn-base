VERSION 5.00
Object = "{065E6FD1-1BF9-11D2-BAE8-00104B9E0792}#3.0#0"; "ssa3d30.ocx"
Object = "{86CF1D34-0C5F-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCT2.OCX"
Object = "{F856EC8B-F03C-4515-BDC6-64CBD617566A}#8.0#0"; "fpSPR80.OCX"
Begin VB.Form P_08001 
   Caption         =   "자료 송수신 (HANDY/DISK)"
   ClientHeight    =   10245
   ClientLeft      =   1620
   ClientTop       =   1920
   ClientWidth     =   15240
   BeginProperty Font 
      Name            =   "굴림체"
      Size            =   9.75
      Charset         =   129
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   LinkTopic       =   "Form1"
   MDIChild        =   -1  'True
   ScaleHeight     =   10245
   ScaleWidth      =   15240
   WindowState     =   2  '최대화
   Begin Threed.SSPanel panMain 
      Align           =   1  '위 맞춤
      Height          =   9135
      Left            =   0
      TabIndex        =   0
      Top             =   435
      Width           =   15240
      _ExtentX        =   26882
      _ExtentY        =   16113
      _Version        =   196609
      RoundedCorners  =   0   'False
      Begin Threed.SSPanel panTitle 
         Height          =   435
         Index           =   0
         Left            =   240
         TabIndex        =   15
         Top             =   720
         Width           =   14835
         _ExtentX        =   26167
         _ExtentY        =   767
         _Version        =   196609
         Caption         =   "정  상  출  고  자  료"
         RoundedCorners  =   0   'False
         Outline         =   -1  'True
         FloodShowPct    =   -1  'True
      End
      Begin FPSpreadADO.fpSpread spdView 
         Height          =   3135
         Index           =   0
         Left            =   240
         TabIndex        =   5
         Top             =   1140
         Width           =   14835
         _Version        =   196608
         _ExtentX        =   26167
         _ExtentY        =   5530
         _StockProps     =   64
         BackColorStyle  =   1
         ColHeaderDisplay=   0
         EditEnterAction =   5
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "굴림체"
            Size            =   9.75
            Charset         =   129
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         MaxCols         =   10
         SpreadDesigner  =   "P_08001.frx":0000
      End
      Begin Threed.SSCommand cmdSubBtn 
         Height          =   555
         Index           =   0
         Left            =   240
         TabIndex        =   2
         Top             =   120
         Width           =   1815
         _ExtentX        =   3201
         _ExtentY        =   979
         _Version        =   196609
         Caption         =   "입고자료수신"
      End
      Begin Threed.SSCommand cmdSubBtn 
         Height          =   555
         Index           =   1
         Left            =   2100
         TabIndex        =   3
         Top             =   120
         Width           =   1815
         _ExtentX        =   3201
         _ExtentY        =   979
         _Version        =   196609
         Caption         =   "핸드터미널수신"
      End
      Begin Threed.SSCommand cmdSubBtn 
         Height          =   555
         Index           =   2
         Left            =   3960
         TabIndex        =   4
         Top             =   120
         Width           =   1815
         _ExtentX        =   3201
         _ExtentY        =   979
         _Version        =   196609
         Caption         =   "출고자료송신"
      End
      Begin Threed.SSCommand cmdSubBtn 
         Height          =   555
         Index           =   3
         Left            =   5820
         TabIndex        =   6
         Top             =   120
         Width           =   1815
         _ExtentX        =   3201
         _ExtentY        =   979
         _Version        =   196609
         Caption         =   "수신자료초기화"
      End
      Begin Threed.SSCommand cmdSubBtn 
         Height          =   555
         Index           =   4
         Left            =   7680
         TabIndex        =   7
         Top             =   120
         Width           =   1815
         _ExtentX        =   3201
         _ExtentY        =   979
         _Version        =   196609
         Caption         =   "할인자료송신"
      End
      Begin Threed.SSCommand cmdSubBtn 
         Height          =   555
         Index           =   5
         Left            =   9540
         TabIndex        =   8
         Top             =   120
         Width           =   1815
         _ExtentX        =   3201
         _ExtentY        =   979
         _Version        =   196609
         Caption         =   "목요세일자료송신"
      End
      Begin Threed.SSCommand cmdSubBtn 
         Height          =   555
         Index           =   6
         Left            =   11400
         TabIndex        =   9
         Top             =   120
         Width           =   1815
         _ExtentX        =   3201
         _ExtentY        =   979
         _Version        =   196609
         Caption         =   "대리점품목송신"
      End
      Begin Threed.SSCommand cmdSubBtn 
         Height          =   555
         Index           =   7
         Left            =   13260
         TabIndex        =   10
         Top             =   120
         Width           =   1815
         _ExtentX        =   3201
         _ExtentY        =   979
         _Version        =   196609
         Caption         =   "수선자료송신"
      End
      Begin FPSpreadADO.fpSpread spdView 
         Height          =   1935
         Index           =   1
         Left            =   240
         TabIndex        =   13
         Top             =   4740
         Width           =   14835
         _Version        =   196608
         _ExtentX        =   26167
         _ExtentY        =   3413
         _StockProps     =   64
         BackColorStyle  =   1
         ColHeaderDisplay=   0
         EditEnterAction =   5
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "굴림체"
            Size            =   9.75
            Charset         =   129
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         MaxCols         =   10
         SpreadDesigner  =   "P_08001.frx":197D
      End
      Begin FPSpreadADO.fpSpread spdView 
         Height          =   1935
         Index           =   2
         Left            =   240
         TabIndex        =   14
         Top             =   7140
         Width           =   14835
         _Version        =   196608
         _ExtentX        =   26167
         _ExtentY        =   3413
         _StockProps     =   64
         BackColorStyle  =   1
         ColHeaderDisplay=   0
         EditEnterAction =   5
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "굴림체"
            Size            =   9.75
            Charset         =   129
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         MaxCols         =   10
         SpreadDesigner  =   "P_08001.frx":32FA
      End
      Begin Threed.SSPanel panTitle 
         Height          =   435
         Index           =   1
         Left            =   240
         TabIndex        =   16
         Top             =   4320
         Width           =   14835
         _ExtentX        =   26167
         _ExtentY        =   767
         _Version        =   196609
         Caption         =   "중  복  출  고  자  료"
         RoundedCorners  =   0   'False
         Outline         =   -1  'True
         FloodShowPct    =   -1  'True
      End
      Begin Threed.SSPanel panTitle 
         Height          =   435
         Index           =   2
         Left            =   240
         TabIndex        =   17
         Top             =   6720
         Width           =   14835
         _ExtentX        =   26167
         _ExtentY        =   767
         _Version        =   196609
         Caption         =   "기  존  출  고  자  료"
         RoundedCorners  =   0   'False
         Outline         =   -1  'True
         FloodShowPct    =   -1  'True
      End
   End
   Begin Threed.SSPanel panInput 
      Align           =   1  '위 맞춤
      Height          =   435
      Left            =   0
      TabIndex        =   1
      Top             =   0
      Width           =   15240
      _ExtentX        =   26882
      _ExtentY        =   767
      _Version        =   196609
      RoundedCorners  =   0   'False
      Begin MSComCtl2.DTPicker dtInput 
         Height          =   315
         Left            =   1680
         TabIndex        =   11
         Top             =   60
         Visible         =   0   'False
         Width           =   3015
         _ExtentX        =   5318
         _ExtentY        =   556
         _Version        =   393216
         CheckBox        =   -1  'True
         Format          =   59637760
         CurrentDate     =   36686
      End
      Begin Threed.SSPanel panCaption 
         Height          =   315
         Index           =   3
         Left            =   60
         TabIndex        =   12
         Top             =   60
         Visible         =   0   'False
         Width           =   1635
         _ExtentX        =   2884
         _ExtentY        =   556
         _Version        =   196609
         Caption         =   "수선적용일자"
         BevelOuter      =   1
         RoundedCorners  =   0   'False
      End
   End
End
Attribute VB_Name = "P_08001"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Dim RS01 As ADODB.Recordset
Dim sValue() As String

Dim Err_Num As Long
Dim Err_Dec As String

Private Sub cmdSubBtn_Click(Index As Integer)
    Select Case Index
        Case 0          ' 입고자료수신
            Call DataSave1
        Case 1          ' 핸드터미널수신
            Call DataSave3
        Case 2          ' 출고자료송신
            Call DataSave4
        Case 3          ' 수신자료초기화
            Call DataSave5
        Case 4          ' 할인자료송신
            P_08001_01.Show 1
        Case 5          ' 목요세일자료송신
            P_08001_02.Show 1
        Case 6          ' 대리점품목송신
            P_08001_03.Show 1
        Case 7          ' 수선자료송신
            Call DataSave6
    End Select
End Sub

Private Sub BtnDisable()
    cmdSubBtn(0).Enabled = False
    cmdSubBtn(1).Enabled = False
    cmdSubBtn(2).Enabled = False
    cmdSubBtn(3).Enabled = False
    cmdSubBtn(4).Enabled = False
    cmdSubBtn(5).Enabled = False
    cmdSubBtn(6).Enabled = False
    cmdSubBtn(7).Enabled = False
End Sub

Private Sub BtnEnable()
    cmdSubBtn(0).Enabled = True
    cmdSubBtn(1).Enabled = True
    cmdSubBtn(2).Enabled = True
    cmdSubBtn(3).Enabled = True
    cmdSubBtn(4).Enabled = True
    cmdSubBtn(5).Enabled = True
    cmdSubBtn(6).Enabled = True
    cmdSubBtn(7).Enabled = True
End Sub

Private Sub DataSave1()
    Dim AgencyName As String
    Dim FileName As String
    Dim AgencyCode As String
    Dim DataType As String
    Dim AllFileName() As String
    Dim i As Integer
    Dim j As Integer
    
    Call BtnDisable
    
    MsgBox "A:드라이버에 대리점용 디스켓을 넣으십시요"
    
    While Not DriverChk
        If MsgBox("A:드라이버에 디스켓을 넣으십시요", vbRetryCancel) = vbCancel Then
            Call BtnEnable
            
            Exit Sub
        End If
    Wend
    
    FileName = Dir("A:*.dat")
    
    If FileName = "" Then
        MsgBox "A:드라이버에 데이타화일이 없습니다."
        Exit Sub
    End If
    
    i = 0
    
    ' 여러개의 파일을 배열에 넣어준다.
    Do While Len(FileName) > 0
        ReDim Preserve AllFileName(0 To i)
        
        AllFileName(i) = FileName
        FileName = Dir
        i = i + 1
    Loop
    
    ' 배열을 순서대로 읽어서 입고데이터를 처리한다.
    For j = 0 To i - 1
        FileName = AllFileName(j)
        
        ' 파일명의 확장자는 대리점코드
        AgencyCode = Mid(FileName, 10, 3)
        AgencyName = GetAgencyName(AgencyCode)
        
        If Mid(FileName, 14, 1) = "1" Then
            Call DataSave2(FileName)
        End If
        
    Next j
    
    MsgBox "입고자료 수신이 완료되었습니다."
    
    Call BtnEnable
End Sub

Private Sub DataSave2(FileName As String)
    Dim iCnt As Integer
    Dim uCnt As Integer
    Dim Str As String
    Dim tCnt As Integer
    Dim tempStr As String
    Dim strCode As String
    Dim strDate As String
    
    Dim FilePath As String
    Dim BCPPath As String
    
    Open "A:" & FileName For Input As #1
    
    ' A드라이브로 부터 읽은 내역을 C드라이브로 Data를 이동한다.
    FilePath = GetIniStr("TEXT DATA", "ReceiveJobFilePath", "", sIniFile)
    BCPPath = GetIniStr("TEXT DATA", "BCPPath", "", sIniFile)
    
    Open FilePath & "\IpChul.Dat" For Output As #2
    
    iCnt = 0
    
    Line Input #1, tempStr
    
    ' Data가 일일마감이면
    If Not Mid(tempStr, 1, 4) = "일일마감" Then
       tempStr = ""
       
       Close #1
       Open "A:" & FileName For Input As #1
    End If
    
    ' 디스켓 데이터를 일어서 BCP로 사용할 Data File을 만든다.
    While Not EOF(1)
        Line Input #1, Str
        
        ' 읽어온 데이타중 끝의 두자리(CR,LF)를 삭제한다.
        tCnt = Len(Trim(Str)) - 2
        
        Str = Mid(Str, 1, tCnt) & " ||"
        
        ' 일일마감이면 끝에 '|4'를 그렇치 않으면 '|3'을 넣어준다.
        If tempStr = "" Then
           Print #2, Str & "|4"
        Else
           Print #2, Str & "|3"
        End If
        
        iCnt = iCnt + 1
    Wend
    
    Close #1
    Close #2
    
    ' 임시 입출고 테이블의 내역을 삭제한다.
    ReDim sValue(0)
    sValue(0) = "0"
    Call ExecPro("PRO_P_08001_00", sValue(), Err_Num, Err_Dec)
    
    ' BCP를 사용하여서 Text Data File을 DB에 올린다.
    If iCnt > 0 Then
        ' 완료파일이 있으면 삭제한다.
        If Not Dir(BCPPath & "\OK.OK") = "" Then
            Kill BCPPath & "\OK.OK"
        End If
        
        ' BCP를 위한 배치파일을 실행한다.
        Shell BCPPath & "\IpChul.Bat", vbHide
        
        'Bat 화일 완료시 까지 대기
        Do While Dir(BCPPath & "\OK.OK") = ""
            DoEvents
        Loop
        
        Kill BCPPath & "\OK.OK"
        
        ReDim sValue(0)
        
        ' Temp Table -> 입고 Table에 등록한다.
        sValue(0) = "0"
        Call ExecPro("PRO_P_08001_01", sValue(), Err_Num, Err_Dec)
        
        '일일수금 자료 생성
        If Not tempStr = "" Then
            ReDim sValue(9)
            
            sValue(0) = Mid(FileName, 1, 8)         ' 수금일자
            sValue(1) = Mid(FileName, 10, 3)        ' 대리점코드
            sValue(2) = Val(Mid(tempStr, 6, 4))     ' 입고수량
            sValue(3) = Mid(tempStr, 55, 4)         ' 시작택
            sValue(4) = Mid(tempStr, 60, 4)         ' 종료택
            sValue(5) = Val(Mid(tempStr, 35, 8))    ' 금액
            sValue(6) = Val(Mid(tempStr, 16, 4))    ' 재세탁수량
            sValue(7) = Val(Mid(tempStr, 21, 4))    ' 수선수량
            sValue(8) = Val(Mid(tempStr, 11, 4))    ' 반품수량
            sValue(9) = 0                           ' 출고수량
            
            Call ExecPro("PRO_P_08001_02", sValue(), Err_Num, Err_Dec)
        Else
            ReDim sValue(0)
            
            sValue(0) = "1"
            
            Call ExecPro("PRO_P_08001_03", sValue(), Err_Num, Err_Dec)
        End If
    End If
End Sub

Private Sub DataSave3()
    Dim iCnt As Integer
    Dim TmpStr As String
    Dim sInOut As String
    Dim sTagNo As String
    Dim sItem As String
    Dim sDate As String
    Dim sCode As String
    Dim mDate As String
    Dim bDate As String
    
    Dim DupCnt As Integer
    Dim ErrorCnt As Integer
    
    Dim TerminalPath As String
    
    P_TRANS.saveYN = False
    P_TRANS.Show 1
    P_TRANS.Hide

    If P_TRANS.saveYN = False Then
        Exit Sub
    End If

    '중복검사 화면
    spdView(0).MaxRows = 0
    spdView(1).MaxRows = 0
    spdView(2).MaxRows = 0
      
    DupCnt = 0
    ErrorCnt = 0
    
    iCnt = 0
    
    '핸디로부터 읽은 데이타를 db로
    TerminalPath = GetIniStr("TERMINAL DATA", "TerminalFilePath", "", sIniFile)
    
    Open TerminalPath & "\Ibchul.dat" For Input As #1
    
    Do While Not EOF(1)
        DoEvents
        
        iCnt = iCnt + 1
        Input #1, TmpStr
        
        sInOut = Trim(Mid(TmpStr, 1, 1))                    ' 입출고구분 첫번째자리
        sDate = CStr(Year(Date)) & Trim(Mid(TmpStr, 6, 4))  ' dat파일에서 6 자리일자를 8자리로 변환
        mDate = Format(sDate, "####/##/##")
        sCode = Trim(Mid(TmpStr, 10, 3))                    ' dat파일에서 read
        sTagNo = Trim(Mid(TmpStr, 13, 4))                   ' ''
        sItem = Trim(Mid(TmpStr, 18, 1))                    ' 소품구분
        
        '비정상 자료 check
        If sInOut < "2" Or sInOut > "3" Or _
           Len(Trim(sDate)) <> 8 Or Not IsDate(mDate) Or _
           Len(Trim(sCode)) <> 3 Or Not IsNumeric(sCode) Or _
           Len(Trim(sTagNo)) <> 4 Or Not IsNumeric(sTagNo) Or _
           sItem < "0" Or sItem > "1" Then
           
              spdView(0).MaxRows = spdView(0).MaxRows + 1
              spdView(0).Row = spdView(0).MaxRows
              spdView(0).Col = -1
              spdView(0).BackColor = vbYellow
              spdView(0).Col = 10
              spdView(0).Text = Mid(TmpStr, 1, 20)
              
              GoTo handy_err
        End If
        
        ReDim sValue(2)
        
        sValue(0) = sCode
        sValue(1) = sTagNo
        sValue(2) = sDate
        
        Set RS01 = New ADODB.Recordset
        Set RS01 = ExecPro("PRO_P_08001_04", sValue(), Err_Num, Err_Dec)
        
        ' 출고일자를 기준으로 하여 입고일자가 30일 이전인 경우
        If Not RS01.BOF And Not RS01.EOF Then
            Do While Not RS01.EOF
                ' 30일이전에 중복TAG이 있는 경우 노란색으로 표시
                If RS01.RecordCount > 1 Then
                    spdView(1).MaxRows = spdView(1).MaxRows + 1
                    spdView(1).Row = spdView(1).MaxRows
                
                    spdView(1).Col = 1
                    spdView(1).Text = "[" & RS01!대리점코드 & "] " & RS01!대리점명
                    spdView(1).Col = 2
                    spdView(1).Text = RS01!입고일자
                    spdView(1).Col = 3
                    spdView(1).Text = RS01!택번호
                    spdView(1).Col = 4
                    spdView(1).Text = "[" & RS01!품목코드 & "] " & RS01!품명
                    spdView(1).Col = 5
                    spdView(1).Text = RS01!출고일자
                    spdView(1).Col = 6
                    If sInOut = "2" Then
                        spdView(1).Text = "[2] 정상"
                    ElseIf sInOut = "3" Then
                        spdView(1).Text = "[3] 반품"
                    End If
                    spdView(1).Col = 7
                    If sItem = "1" Then
                        spdView(1).Text = "[1] 소품"
                    Else
                        spdView(1).Text = "[0] 정상"
                    End If
                    
                    spdView(1).Col = 8
                    If sInOut = "2" Then
                        spdView(1).Text = "정상"
                    ElseIf sInOut = "3" Then
                        spdView(1).Text = "반품"
                    End If
                   
                    spdView(1).Col = 9
                    If sItem = "1" Then
                        spdView(1).Text = "소품"
                    Else
                        spdView(1).Text = ""
                    End If
                   
                    spdView(1).Col = 10
                    spdView(1).Text = Mid(TmpStr, 1, 20)
                Else
                    If Not IsNull(RS01!출고일자) Then
                        spdView(2).MaxRows = spdView(2).MaxRows + 1
                        spdView(2).Row = spdView(2).MaxRows
                    
                        spdView(2).Col = 1
                        spdView(2).Text = "[" & RS01!대리점코드 & "] " & RS01!대리점명
                        spdView(2).Col = 2
                        spdView(2).Text = RS01!입고일자
                        spdView(2).Col = 3
                        spdView(2).Text = RS01!택번호
                        spdView(2).Col = 4
                        spdView(2).Text = "[" & RS01!품목코드 & "] " & RS01!품명
                        spdView(2).Col = 5
                        spdView(2).Text = RS01!출고일자
                        spdView(2).Col = 6
                        If sInOut = "2" Then
                            spdView(2).Text = "[2] 정상"
                        ElseIf sInOut = "3" Then
                            spdView(2).Text = "[3] 반품"
                        End If
                        spdView(2).Col = 7
                        If sItem = "1" Then
                            spdView(2).Text = "[1] 소품"
                        Else
                            spdView(2).Text = "[0] 정상"
                        End If
                        
                        spdView(2).Col = 8
                        If sInOut = "2" Then
                            spdView(2).Text = "정상"
                        ElseIf sInOut = "3" Then
                            spdView(2).Text = "반품"
                        End If
                       
                        spdView(2).Col = 9
                        If sItem = "1" Then
                            spdView(2).Text = "소품"
                        Else
                            spdView(2).Text = ""
                        End If
                       
                        spdView(2).Col = 10
                        spdView(2).Text = Mid(TmpStr, 1, 20)
                    Else
                        spdView(0).MaxRows = spdView(0).MaxRows + 1
                        spdView(0).Row = spdView(0).MaxRows
                        
                        spdView(0).Col = 1
                        spdView(0).Text = "[" & RS01!대리점코드 & "] " & RS01!대리점명
                        spdView(0).Col = 2
                        spdView(0).Text = RS01!입고일자
                        spdView(0).Col = 3
                        spdView(0).Text = RS01!택번호
                        spdView(0).Col = 4
                        spdView(0).Text = "[" & RS01!품목코드 & "] " & RS01!품명
                        spdView(0).Col = 5
                        spdView(0).Text = RS01!출고일자
                        spdView(0).Col = 6
                        If sInOut = "2" Then
                            spdView(0).Text = "[2] 정상"
                        ElseIf sInOut = "3" Then
                            spdView(0).Text = "[3] 반품"
                        End If
                        spdView(0).Col = 7
                        If sItem = "1" Then
                            spdView(0).Text = "[1] 소품"
                        Else
                            spdView(0).Text = "[0] 정상"
                        End If
                        
                        spdView(0).Col = 8
                        If sInOut = "2" Then
                            spdView(0).Text = "정상"
                        ElseIf sInOut = "3" Then
                            spdView(0).Text = "반품"
                        End If
                       
                        spdView(0).Col = 9
                        If sItem = "1" Then
                            spdView(0).Text = "소품"
                        Else
                            spdView(0).Text = ""
                        End If
                       
                        spdView(0).Col = 10
                        spdView(0).Text = Mid(TmpStr, 1, 20)
                    End If
                End If
                
                RS01.MoveNext
            Loop
        
            GoTo handy_err
        Else
            Set RS01 = New ADODB.Recordset
            Set RS01 = ExecPro("PRO_P_08001_10", sValue(), Err_Num, Err_Dec)
            
            If RS01.EOF Then
                spdView(0).MaxRows = spdView(0).MaxRows + 1
                spdView(0).Row = spdView(0).MaxRows
                
                spdView(0).Col = -1
                spdView(0).BackColor = vbGreen
                
                spdView(0).Col = 1
                spdView(0).Text = "[" & sCode & "]"
                spdView(0).Col = 3
                spdView(0).Text = Mid(sTagNo, 1, 1) & "-" & Mid(sTagNo, 2, 3)
            
                spdView(0).Col = 10
                spdView(0).Text = Mid(TmpStr, 1, 20)
            Else
                If Not IsNull(RS01!출고일자) Then
                    spdView(2).MaxRows = spdView(2).MaxRows + 1
                    spdView(2).Row = spdView(2).MaxRows
                    
                    spdView(2).Col = -1
                    spdView(2).BackColor = vbGreen
                        
                     spdView(2).Col = 1
                     spdView(2).Text = "[" & RS01!대리점코드 & "] " & RS01!대리점명
                     spdView(2).Col = 2
                     spdView(2).Text = RS01!입고일자
                     spdView(2).Col = 3
                     spdView(2).Text = RS01!택번호
                     spdView(2).Col = 4
                     spdView(2).Text = "[" & RS01!품목코드 & "] " & RS01!품명
                     spdView(2).Col = 5
                     spdView(2).Text = RS01!출고일자
                     spdView(2).Col = 6
                     If sInOut = "2" Then
                         spdView(2).Text = "[2] 정상"
                     ElseIf sInOut = "3" Then
                         spdView(2).Text = "[3] 반품"
                     End If
                     spdView(2).Col = 7
                     If sItem = "1" Then
                         spdView(2).Text = "[1] 소품"
                     Else
                         spdView(2).Text = "[0] 정상"
                     End If
                     
                     spdView(2).Col = 8
                     If sInOut = "2" Then
                         spdView(2).Text = "정상"
                     ElseIf sInOut = "3" Then
                         spdView(2).Text = "반품"
                     End If
                    
                     spdView(2).Col = 9
                     If sItem = "1" Then
                         spdView(2).Text = "소품"
                     Else
                         spdView(2).Text = ""
                     End If
                    
                     spdView(2).Col = 10
                     spdView(2).Text = Mid(TmpStr, 1, 20)
                Else
                    spdView(0).MaxRows = spdView(0).MaxRows + 1
                    spdView(0).Row = spdView(0).MaxRows
                    
                    spdView(0).Col = -1
                    spdView(0).BackColor = vbGreen
                    
                    spdView(0).Col = 1
                    spdView(0).Text = "[" & RS01!대리점코드 & "] " & RS01!대리점명
                    spdView(0).Col = 2
                    spdView(0).Text = RS01!입고일자
                    spdView(0).Col = 3
                    spdView(0).Text = RS01!택번호
                    spdView(0).Col = 4
                    spdView(0).Text = "[" & RS01!품목코드 & "] " & RS01!품명
                    spdView(0).Col = 5
                    spdView(0).Text = RS01!출고일자
                    spdView(0).Col = 6
                    If sInOut = "2" Then
                        spdView(0).Text = "[2] 정상"
                    ElseIf sInOut = "3" Then
                        spdView(0).Text = "[3] 반품"
                    End If
                    spdView(0).Col = 7
                    If sItem = "1" Then
                        spdView(0).Text = "[1] 소품"
                    Else
                        spdView(0).Text = "[0] 정상"
                    End If
                     
                    spdView(0).Col = 8
                    If sInOut = "2" Then
                        spdView(0).Text = "정상"
                    ElseIf sInOut = "3" Then
                        spdView(0).Text = "반품"
                    End If
                    
                    spdView(0).Col = 9
                    If sItem = "1" Then
                        spdView(0).Text = "소품"
                    Else
                        spdView(0).Text = ""
                    End If
                    
                    spdView(0).Col = 10
                    spdView(0).Text = Mid(TmpStr, 1, 20)
                End If
            
            End If
            
            GoTo handy_err
        End If
        
        DoEvents
handy_err:
    Loop
    Close #1
    
    If spdView(0).MaxRows <> 0 Or spdView(1).MaxRows <> 0 Or spdView(2).MaxRows <> 0 Then
        P_00000.cmdBtn(2).Enabled = True
        P_00000.cmdBtn(3).Enabled = True
    End If
    
    If ErrorCnt > 0 Then
       MsgBox CStr(ErrorCnt) & "건이 입고내역이 없습니다."
    End If
End Sub

Private Sub DataSave4()
    Dim FileName As String
    Dim AgencyCode As String
    Dim TagNo As String
    Dim ChulGu As String
    Dim RecCount As Long
    
    ReDim sValue(0)

    Set RS01 = New ADODB.Recordset
    Set RS01 = ExecPro("PRO_P_08001_07", sValue(), Err_Num, Err_Dec)
    
    If RS01.BOF Or RS01.EOF Then
        MsgBox "디스켓에 복사할 자료가 없습니다."
        DoEvents
        Exit Sub
    End If
        
    FileName = "Down" & RS01!대리점코드 & ".Dat"
        
    'a:드라이버에 디스켓이 있는지 확인
    Call Msg("A:드라이버 확인중")
    
    While Not DriverChk
        If MsgBox("A:드라이버에 디스켓을 넣으십시요", vbRetryCancel) = vbCancel Then
            BtnEnable
            Exit Sub
        End If
    Wend
    
    AgencyCode = RS01!대리점코드
    DoEvents
    Open "A:\" & FileName For Output As #1
    
    While Not RS01.EOF And Not RS01.BOF
        '대리점이 바뀌었으면 다른이름으로 다시 저장한다.
        If AgencyCode <> RS01!대리점코드 Then
            Close #1
            FileName = "Down" & RS01!대리점코드 & ".Dat"
            Open "A:\" & FileName For Output As #1
        End If
        
        AgencyCode = RS01!대리점코드
        TagNo = RS01!택번호
        
        ChulGu = IIf(IsNull(RS01!출고구분), 0, RS01!출고구분)
        
        Print #1, " " & RS01!입고일자 & " " & TagNo & " " & ChulGu
        RS01.MoveNext
        DoEvents
    Wend
    
    Close #1
End Sub

Private Sub DataSave5()
    ReDim sValue(0)
    
    Call ExecPro("PRO_P_08001_08", sValue(), Err_Num, Err_Dec)
End Sub

Private Sub DataSave6()
    '하드디스크작성
    Dim FileName As String
    Dim rName As String
    Dim rAmt As String
    
'    panCaption(0).Visible = True
    dtInput.Visible = True
    dtInput.Value = Date
    dtInput.Value = ""
    
    DoEvents
    
    If dtInput.Value = "" Then
       Exit Sub
    End If
    
    ReDim sValue(0)
    
    sValue(0) = "0"
    
    Set RS01 = New ADODB.Recordset
    Set RS01 = ExecPro("PRO_P_08001_05", sValue(), Err_Num, Err_Dec)
    
    If RS01.RecordCount = 0 Then
        MsgBox "디스켓에 복사할 자료가 없습니다."
        RS01.Close
        Exit Sub
    End If
        
    FileName = "R" & Format(dtInput.Value, "yyyymmdd") & ".Dat"
        
    'a:드라이버에 디스켓이 있는지 확인
    Call Msg("A:드라이버 확인중")
    
    While Not DriverChk
        If MsgBox("A:드라이버에 디스켓을 넣으십시요", vbRetryCancel) = vbCancel Then
            RS01.Close
            Exit Sub
        End If
    Wend
    
    Call Msg("수선자료를 복사중입니다.")
    
    Open "A:\" & FileName For Output As #1
    
    While Not RS01.EOF
        rAmt = "       "
        LSet rAmt = RS01!금액
        
        Print #1, rAmt;
        Print #1, RS01!명칭
        
        RS01.MoveNext
        
        DoEvents
    Wend
    
    Close #1
    
    RS01.Close
End Sub

Private Sub Form_Activate()
    P_00000.panProgramID = Me.Name
    P_00000.panProgramName = Me.Caption
End Sub

Private Sub Form_Unload(Cancel As Integer)
    P_00000.cmdBtn(0).Enabled = False
    P_00000.cmdBtn(1).Enabled = False
    P_00000.cmdBtn(2).Enabled = False
    P_00000.cmdBtn(3).Enabled = False
    P_00000.cmdBtn(4).Enabled = False
    P_00000.cmdBtn(5).Enabled = False
    P_00000.cmdBtn(6).Enabled = False
    
    P_00000.panProgramID = ""
    P_00000.panProgramName = ""
    
    P_08001_Flag = False
End Sub

Private Sub spdView_MouseDown(Index As Integer, Button As Integer, Shift As Integer, x As Single, y As Single)
    If Button = 2 Then
        PopupMenu P_00000.PopUp
    End If
End Sub

Public Sub DataSave()
    Dim i As Integer
    Dim sMemAgencyCode As String
    Dim sDownPath As String
    Dim sSendData As String
    
    ReDim sValue(5)
    
    For i = 1 To spdView(0).MaxRows
        spdView(0).Row = i
        
        spdView(0).Col = 1
        sValue(0) = Mid(spdView(0).Text, 2, 3)
        spdView(0).Col = 3
        sValue(1) = spdView(0).Value
        spdView(0).Col = 2
        sValue(2) = Format(spdView(0).Text, "yyyymmdd")
        spdView(0).Col = 5
        sValue(3) = Format(Now, "yyyymmdd")
        spdView(0).Col = 6
        sValue(4) = Mid(spdView(0).Text, 2, 1)
        spdView(0).Col = 7
        sValue(5) = Mid(spdView(0).Text, 2, 1)
        
        Call ExecPro("PRO_P_08001_06", sValue(), Err_Num, Err_Dec)
        
        If Err_Num <> 0 Then
            MsgBox "[" & Err_Num & "] " & Err_Dec
            Exit Sub
        End If
    Next i
    
    For i = 1 To spdView(1).MaxRows
        spdView(1).Row = i
        
        spdView(1).Col = 1
        sValue(0) = Mid(spdView(1).Text, 2, 3)
        spdView(1).Col = 3
        sValue(1) = spdView(1).Value
        spdView(1).Col = 2
        sValue(2) = Format(spdView(1).Text, "yyyymmdd")
        spdView(1).Col = 5
        sValue(3) = Format(Now, "yyyymmdd")
        spdView(1).Col = 6
        sValue(4) = Mid(spdView(1).Text, 2, 1)
        spdView(1).Col = 7
        sValue(5) = Mid(spdView(1).Text, 2, 1)
        
        Call ExecPro("PRO_P_08001_06", sValue(), Err_Num, Err_Dec)
        
        If Err_Num <> 0 Then
            MsgBox "[" & Err_Num & "] " & Err_Dec
            Exit Sub
        End If
    Next i
    
    For i = 1 To spdView(2).MaxRows
        spdView(2).Row = i
        
        spdView(2).Col = 1
        sValue(0) = Mid(spdView(2).Text, 2, 3)
        spdView(2).Col = 3
        sValue(1) = spdView(2).Value
        spdView(2).Col = 2
        sValue(2) = ""
        spdView(2).Col = 5
        sValue(3) = Format(Now, "yyyymmdd")
        spdView(2).Col = 6
        sValue(4) = Mid(spdView(2).Text, 2, 1)
        spdView(2).Col = 7
        sValue(5) = Mid(spdView(2).Text, 2, 1)
        
        Call ExecPro("PRO_P_08001_06", sValue(), Err_Num, Err_Dec)
        
        If Err_Num <> 0 Then
            MsgBox "[" & Err_Num & "] " & Err_Dec
            Exit Sub
        End If
    Next i
    
    sDownPath = GetIniStr("SERVER DATA", "SendPath", "", sIniFile)
    
    For i = 1 To spdView(0).MaxRows
        spdView(0).Row = i
        spdView(0).Col = 1
            
        If sMemAgencyCode <> Mid(spdView(0).Text, 2, 3) Then
            ReDim sValue(2)
            
            sValue(0) = "0"
            sValue(1) = Format(Now, "yyyymmdd")
            sValue(2) = sMemAgencyCode
            
            Open sDownPath & "\Down" & sValue(2) & sValue(1) & ".Dat" For Output As #1
            
            Set RS01 = New ADODB.Recordset
            Set RS01 = ExecPro("PRO_P_08003_01", sValue(), Err_Num, Err_Dec)
            
            Do While Not RS01.EOF
                Print #1, " " & RS01!입고일자 & " " & RS01!택번호 & " " & RS01!출고구분
            
                RS01.MoveNext
            Loop
        
            Close #1
        End If
        
        sMemAgencyCode = Mid(spdView(0).Text, 2, 3)
    Next i
    
    For i = 1 To spdView(1).MaxRows
        spdView(1).Row = i
        spdView(1).Col = 1
            
        If sMemAgencyCode <> Mid(spdView(1).Text, 2, 3) Then
            ReDim sValue(2)
            
            sValue(0) = "0"
            sValue(1) = Format(Now, "yyyymmdd")
            sValue(2) = sMemAgencyCode
            
            Open sDownPath & "\Down" & sValue(2) & sValue(1) & ".Dat" For Output As #1
            
            Set RS01 = New ADODB.Recordset
            Set RS01 = ExecPro("PRO_P_08003_01", sValue(), Err_Num, Err_Dec)
            
            Do While Not RS01.EOF
                Print #1, " " & RS01!입고일자 & " " & RS01!택번호 & " " & RS01!출고구분
            
                RS01.MoveNext
            Loop
        
            Close #1
        End If
        
        sMemAgencyCode = Mid(spdView(1).Text, 2, 3)
    Next i
    
    For i = 1 To spdView(2).MaxRows
        spdView(2).Row = i
        spdView(2).Col = 1
            
        If sMemAgencyCode <> Mid(spdView(2).Text, 2, 3) Then
            ReDim sValue(2)
            
            sValue(0) = "0"
            sValue(1) = Format(Now, "yyyymmdd")
            sValue(2) = sMemAgencyCode
            
            Open sDownPath & "\Down" & sValue(2) & sValue(1) & ".Dat" For Output As #1
            
            Set RS01 = New ADODB.Recordset
            Set RS01 = ExecPro("PRO_P_08003_01", sValue(), Err_Num, Err_Dec)
            
            Do While Not RS01.EOF
                Print #1, " " & RS01!입고일자 & " " & RS01!택번호 & " " & RS01!출고구분
            
                RS01.MoveNext
            Loop
        
            Close #1
        End If
        
        sMemAgencyCode = Mid(spdView(2).Text, 2, 3)
    Next i
    
    MsgBox "해당되는 데이터가 정상적으로 저장이 되었습니다", vbInformation
End Sub

Public Sub DataDelete()
    spdView(0).Row = spdView(0).ActiveRow
    spdView(0).Col = -1
    spdView(0).Action = ActionDeleteRow
    
    spdView(0).MaxRows = spdView(0).MaxRows - 1
End Sub
