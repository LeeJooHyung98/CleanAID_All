Attribute VB_Name = "basGlobal"
Option Explicit


Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
Declare Function CopyFile Lib "kernel32" Alias "CopyFileA" (ByVal lpExistingFileName As String, ByVal lpNewFileName As String, ByVal bFailIfExists As Long) As Long

' ini File Control에 관한 API라이브러리
Declare Function GetPrivateProfileInt Lib "kernel32" Alias "GetPrivateProfileIntA" (ByVal lpApplicationName As String, ByVal lpKeyName As String, ByVal nDefault As Long, ByVal lpFileName As String) As Long
Declare Function GetPrivateProfileString Lib "kernel32" Alias "GetPrivateProfileStringA" (ByVal lpApplicationName As String, ByVal lpKeyName As Any, ByVal lpDefault As String, ByVal lpReturnedString As String, ByVal nSize As Long, ByVal lpFileName As String) As Long
Declare Function WritePrivateProfileString Lib "kernel32" Alias "WritePrivateProfileStringA" (ByVal lpApplicationName As String, ByVal lpKeyName As Any, ByVal lpString As Any, ByVal lpFileName As String) As Long
Declare Function GetWindowsDirectory Lib "kernel32" Alias "GetWindowsDirectoryA" (ByVal lpBuffer As String, ByVal nSize As Long) As Long

Public Declare Sub ZeroMemory Lib "kernel32" Alias "RtlZeroMemory" (dest As Any, ByVal numBytes As Long)

Public Bill_Printer    As String   ' 프린터 구분(0-레이저, 1-미니프린터) (예전 -> 0=도트 1= 잉크젯, 2= 레이저)

'Public Printer_BO_Gb As String   ' 보관증 구분 0=이전 1= 신규
'Public Connect_Gb    As Boolean  ' 전송   구분 0=모뎀 1= 인터넷

Public Const m_UpdateUrl      As String = "123.141.99.251"

Public ADOCon        As ADODB.Connection
Public HostCon       As ADODB.Connection
Public MDBCon        As ADODB.Connection

Public ADORs         As ADODB.Recordset
Public SUBRs         As ADODB.Recordset
Public Rs            As ADODB.Recordset
Public Query         As String
Public i             As Long

Public Const sID = "sa"
Public Const sPWD = "clean1996"
Public Const m_SMS_Lng = 90

Public PreManager    As String
Public strManager    As String
Public 환불사유      As String

Public 판매취소여부  As Boolean

Public Ret           As Long
Public Rtn           As Integer  'MessageBox Return 값...
Public AppPath       As String
Public XML           As String

Public ActiveForm    As String

Public TagNo         As Integer  '택번호
Public 의류코드      As String   '의류코드
Public iCur          As Integer  '현재커서의 위치
Public bSearch       As Boolean  '접수, 출고에서 고객정보와 미출고내역 조회여부

Public 결제취소여부  As Boolean
Public 판매취소현금반환 As Boolean

'Public Err As Error         '에러오브젝트

Public nDayCloseChk As Boolean       ' 전일 마감을 했는지의 여부를 확인한다.
Public m_strDayClose  As String        ' 전일 마감여부.
Public tempCol      As Integer       ' form1에서 임시사용
Public tempRow      As Integer       ' form1에서 임시사용
Public NewRowchk    As Boolean       ' 자료유무확인
Public chkDaySale   As Boolean       ' 목요세일여부
Public chkEventSale As Boolean       ' 행사여부
Public chkPassWord  As Boolean       ' 비빌번호 확인여부 ture 이면 확인한 상태

Public chkServicePassWord As String  ' 세탁 서비스의 여부를 결정한다. 한손님에 한해서
Public chkPricPassWord    As String  ' 금액 입력 비빌번호 확인하면 그 택번호가 저장된다.
Public chkPassInput       As String  ' 입력한 비밀번호

Public Const ServerMode = "1"        ' 서버

Public chkInputKey  As Boolean       ' 입고 버튼을 누른경우 전화번호에 커서를 두기위해
Public chkinputflig As String        ' 현재 입력 위치 ' 입고,출고,조회

Public iniFile      As String        ' ini 파일
Public MailCheck    As Boolean

Public bMsgMode     As Boolean       ' 메시지출력 여부
Public strMessage   As String        ' 출력할 메시지

Public Const M_COUPON_LENGTH = 8

' 20091008일 체인점 코드에서 지사 코드로 변경
Public Const M_COUPON_KLENZ_CODE = "1024"
'Public Const M_COUPON_KLENZ_CODE = "100273"

Public m_SignFileName    As String

Public bUpdatePoing As Boolean

Type TYPE고객정보
    고객코드         As String
    성명             As String
    전화번호         As String
    휴대전화         As String
    주소             As String
    미수금액           As String
    본사전송여부     As String
    카드번호         As String
    SMS전송여부      As String
    등록일자         As String
    메모             As String
    고객등급         As String
    이용횟수         As String
    총접수금액       As String
    누적마일리지     As String
    사용가능마일리지 As String
End Type

Type TYPE가맹점정보
    지사코드         As String
    가맹점코드       As String
    가맹점명         As String
    적용일자         As String
    택코드           As String
    택색상           As String
    수선             As String
    택번호           As String
    일수             As String
    비율             As String
    전화1            As String
    전화2            As String
    전화매장         As String
    전화SMS          As String
    전화번호         As String
    요일할인         As String
    세트상품세일     As String
    수선마진         As String
    운동화마진       As String
    가죽무스탕마진   As String
    카페트마진       As String
    외주마진         As String
    프린터           As String
    세탁소요일       As String
    마일리지여부     As String
    기준금액         As String
    적립마일리지     As String
    최소마일리지     As String
    마일리지증가구분 As String
    지정할인비율     As String
    지정할인여부     As String
    삼성카드할인여부 As String
    삼성카드할인비율 As String
    특정할인비율     As String
    특정할인여부     As String
    고가세탁비율     As String
    세탁환불여부     As String
    전화번호출력     As String
    가맹점카드영수증출력YN  As String
    CAT단말기종류    As String
    SMS_EMART        As String
    SMS_사고품       As String
    DualComputer     As String
    
    로열티여부1      As String
    로열티비율1      As String
    로열티여부2      As String
    로열티비율2      As String
    수수료지원여부   As String
    수수료지원비율   As String
    
    PG사용종료일     As String
    가맹점상태       As String

End Type

Type TYPE일일마감정보
    마감일자     As String
    접수수량     As String
    반품수량     As String
    재세탁수량   As String
    수선수량     As String
    접수금액     As String
    본사금액     As String
    가맹점금액   As String
    수선금액     As String
    판매구분     As String
    시작택       As String
    종료택       As String
    마감여부     As String
    본사전송여부 As String
End Type

Type TYPE_SMS_SERVER
    ServerIP    As String
    DBName      As String
    UserID      As String
    UserPW      As String
    timeout     As Integer
End Type

Public m_SMS        As TYPE_SMS_SERVER
Public 고객정보     As TYPE고객정보
Public 가맹점정보   As TYPE가맹점정보
Public 일일마감정보 As TYPE일일마감정보
Public 고객수정     As TYPE고객정보

'컨트롤 상태 열거형
Public Enum CommandFiles
    BACKUP      ' DB백업
    DBSend      ' DB를 본사에 보넨다
    Restore     ' DB를 복구한다.
    PGDown      ' 프로그램 다운로드
End Enum

Public Type monRecord
    strDay   As String * 2
    intCount As Integer
    dblTptal As Double
End Type

Type chkbill
    strchkdate(100)        As String
    strchkTno(100)         As String
    strchkItem(100)        As String
    lngMoney(100)          As Long
    lngchkRejectmoney(100) As Long
End Type

'Type TYPE마일리지정보
'    검색여부        As Boolean
'    총사용금액      As Double
'    마일리지        As Double
'    최종발생금액    As Double
'    발생총누계      As Double
'    사용누계        As Double
'    미반환마일리지  As Double
'End Type

Type TYPE마일리지정보
    사용가능마일리지  As Long
    누적마일리지      As Long
End Type

Public 마일리지  As TYPE마일리지정보


Type TypeGoodsCodeList
    Code    As String
    Order   As String
End Type
Public m_의류정보()   As TypeGoodsCodeList

Public Const NextMileage = 100000   ' 다음 마일리지 발생금액

Public m_CommandTimeOut    As Long
Public M_CompnyMasterName  As String
Public m_SMS_EMART_PASS    As Boolean

Public PROG_MODE           As String 'TEST or REAL
Public PosPrinterDelayTiem  As Integer

Public Enum Approve_Type
    Credit_Approve
    Credit_Cancel_Today
    Credit_Cancel_Prev_Day
    Cash_Approve
    Cash_Cancel_Today
    Cash_Cancel_Prev_Day
End Enum
'Sound
Public Declare Function sndPlaySound Lib "winmm.dll" Alias "sndPlaySoundA" (ByVal lpszSoundName As String, ByVal uFlags As Long) As Long

'====================================================================================================
' Procedure : MDB_Connection
' DateTime  :
' Author    :
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 :
'====================================================================================================
Public Function MDB_Connection(MDBCon As ADODB.Connection, Optional MDBPath As String) As Boolean
    On Error GoTo ErrRtn
  
    Set MDBCon = Nothing
    Set MDBCon = New ADODB.Connection

    With MDBCon
        If MDBPath = "" Then
            .ConnectionString = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\Laundry\DB\LAUNDRY.MDB;Jet OLEDB:Database Password="
        Else
            .ConnectionString = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" & MDBPath & ";Jet OLEDB:Database Password="
        End If
        
        .Open
    End With
    
    MDB_Connection = True
    
    On Error GoTo 0
    
    Exit Function

ErrRtn:
    MDB_Connection = False

    Call Error_Msg("MDB_Connection", Err.Source, Err.Number, Err.description)
End Function

'====================================================================================================
' Procedure : Server_Connection
' DateTime  : 2008-04-15 04:13
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 최초 신규 매장코드가 없을 경우 본사에 등록되어있는 내용을 가저온다.
'====================================================================================================
Public Function Server_Connection(HostCon As ADODB.Connection, Optional sOffice As String) As Boolean
    Dim sServer   As String
    Dim sDatabase As String
    Dim sID       As String
    Dim sPWD      As String
    
    Dim Server_Connect As String
    
    On Error GoTo ErrRtn
 
    '서버에 접속여부
    Server_Connect = GetIniStr("SERVER", "Server_Connect", "", iniFile)                  '
    
    If Server_Connect = "N" Then
        Server_Connection = False
    Else
        sServer = Get_Decrypt(GetIniStr("SERVER", "SERVER", "", iniFile), "")     '
        sDatabase = Get_Decrypt(GetIniStr("SERVER", "DATABASE", "", iniFile), "") '
        sID = Get_Decrypt(GetIniStr("SERVER", "ID", "", iniFile), "")             '
        sPWD = Get_Decrypt(GetIniStr("SERVER", "PWD", "", iniFile), "")           '
     
        If sOffice <> "" Then
            sDatabase = sOffice
        End If
        
        Set HostCon = Nothing
        Set HostCon = New ADODB.Connection
    
        If HostCon.State = adStateOpen Then HostCon.Close
    
        With HostCon
            If UCase(sOffice) = "LAUNDRY1000" Then
                .ConnectionString = "Provider=SQLOLEDB;Persist Security Info=False;User ID=" & sID & ";Password=" & sPWD & ";Initial Catalog=" & sOffice & ";Data Source=" & sServer
            Else
                .ConnectionString = "Provider=SQLOLEDB;Persist Security Info=False;User ID=" & sID & ";Password=" & sPWD & ";Initial Catalog=" & sDatabase & ";Data Source=" & sServer
            End If
            
            .ConnectionTimeout = 10
            .CommandTimeout = IIf(m_CommandTimeOut = 0, 30, m_CommandTimeOut)
            .Open
        End With
        
        Server_Connection = True
    End If
    
    Exit Function

ErrRtn:
    Server_Connection = False
    
    '서버접속 오류메시지는 막음
    'Call Error_Msg("Server_Connection", Err.Source, Err.Number, Err.Description)
End Function

Public Function SendStoreDefaultInfo(sOldDate As String, sOldMstCode As String, sOldTag As String, sOldStoreCode As String, sOldStoreName As String) As Boolean
    Dim sValue(12)  As String
    
    On Error GoTo ErrRtn

    If Get_가맹점정보 = "Error" Then
        MsgBox "가맹점 정보가 올바르지 않습니다. 확인후 저장하여 주십시요.", vbInformation, "확인"
        
        frm환경설정.Show 1
        End
    End If
    
    If Trim(가맹점정보.가맹점코드) = "" Then
        MsgBox "가맹점 정보가 올바르지 않습니다.", vbCritical, "경고"
        Exit Function
    End If
    
    If Server_Connection(HostCon) = True Then
        HostCon.BeginTrans
        
        '-------------------------------------------------------------------------------------------
        ' 기존 자료에 종료일자 등록
        '-------------------------------------------------------------------------------------------
        Query = "UPDATE MASTER_TAG_TBL SET END_DT = '" & Format(DateAdd("d", -1, Date), "YYYY-MM-DD") & "'"
        Query = Query & " WHERE Store_CD  = '" & 가맹점정보.가맹점코드 & "'"
        Query = Query & "   AND END_DT    = '20991231' "
        Query = Query & "   AND START_DT <> '" & 가맹점정보.적용일자 & "'"
        HostCon.Execute Query
    
        '-------------------------------------------------------------------------------------------
        '
        '-------------------------------------------------------------------------------------------
        Query = "SELECT STORE_CD "
        Query = Query & " FROM MASTER_TAG_TBL "
        Query = Query & " WHERE Store_CD = '" & 가맹점정보.가맹점코드 & "' "
        Query = Query & "   AND START_DT = '" & 가맹점정보.적용일자 & "' "
        Set SUBRs = New ADODB.Recordset
        SUBRs.Open Query, HostCon, adOpenStatic, adLockOptimistic
        
        If SUBRs.EOF = True Then
            Query = "INSERT INTO TB_MASTER_TAG_TBL (STORE_CD, START_DT, MASTER_CD, TAG_NB, END_DT) "
            Query = Query & " VALUES ('" & 가맹점정보.가맹점코드 & "', '" & 가맹점정보.적용일자 & "', "
            Query = Query & " '" & 가맹점정보.지사코드 & "', '" & 가맹점정보.택코드 & "','20991231')"
            HostCon.Execute Query
        Else
            Query = "UPDATE MASTER_TAG_TBL "
            Query = Query & "SET TAG_NB =  '" & 가맹점정보.택코드 & "', "
            Query = Query & "    END_DT = '20991231', "
            Query = Query & "    MASTER_CD = '" & 가맹점정보.지사코드 & "'  "
            Query = Query & " WHERE Store_CD = '" & 가맹점정보.가맹점코드 & "' "
            Query = Query & "   AND START_DT = '" & 가맹점정보.적용일자 & "' "
            HostCon.Execute Query
        End If
        
        '-------------------------------------------------------------------------------------------
        '
        '-------------------------------------------------------------------------------------------
        Query = "UPDATE STORE_TBL "
        Query = Query & " SET TAG_NB = '" & 가맹점정보.택코드 & "', "
        Query = Query & "     MASTER_CD = '" & 가맹점정보.지사코드 & "',  "
        Query = Query & "     START_DT = '" & 가맹점정보.적용일자 & "' "
        Query = Query & " WHERE Store_CD = '" & 가맹점정보.가맹점코드 & "' "
        HostCon.Execute Query
    
        
        ' 변경 여부를 문자로 전송한다.
        ' 전송, 메시지타입, 수신번호, 발신번호, 메시지, 지사코드, 가맹점코드, 고객코드, 고객성명, 참고5, 참고6
        sValue(0) = "1"
        sValue(1) = "0"
        sValue(2) = "010-9004-4523"
        sValue(3) = "031-522-2025"
        sValue(4) = "[정보변경] " & vbNewLine
        sValue(4) = sValue(4) & Hangul_Mid(가맹점정보.가맹점명, 1, 12) & vbNewLine
        sValue(4) = sValue(4) & sOldDate & "->" & Replace(가맹점정보.적용일자, "-", "") & vbNewLine
        sValue(4) = sValue(4) & sOldStoreCode & "->" & 가맹점정보.가맹점코드 & vbNewLine
        sValue(4) = sValue(4) & sOldMstCode & "->" & 가맹점정보.지사코드 & vbNewLine
        sValue(4) = sValue(4) & sOldTag & "->" & 가맹점정보.택코드 & vbNewLine
        sValue(5) = "9999"
        sValue(6) = "999"
        sValue(7) = " "
        sValue(8) = "Laundry"
        sValue(9) = "999999"
        sValue(10) = "2"
        
        '-------------------------------------------------------------------------------------------
        '
        '-------------------------------------------------------------------------------------------
        Query = "EXEC PRO_SMS_SEND "
        Query = Query & "'" & sValue(0) & "', "
        Query = Query & "'" & sValue(1) & "', "
        Query = Query & "'" & sValue(2) & "', "
        Query = Query & "'" & sValue(3) & "', "
        Query = Query & "'" & sValue(4) & "', "
        Query = Query & "'" & sValue(5) & "', "
        Query = Query & "'" & sValue(6) & "', "
        Query = Query & "'" & sValue(7) & "', "
        Query = Query & "'" & sValue(8) & "', "
        Query = Query & "'" & sValue(9) & "', "
        Query = Query & "'" & sValue(10) & "' "
        
        If 가맹점정보.지사코드 <> "9999" Then
            HostCon.Execute Query
        End If
                
        ' 정보 변경 히스토리
        
        sValue(0) = "1"
        sValue(1) = sOldDate
        sValue(2) = sOldMstCode
        sValue(3) = sOldTag
        sValue(4) = sOldStoreCode
        sValue(5) = sOldStoreName
        sValue(6) = Format(가맹점정보.적용일자, "YYYY-MM-DD")
        sValue(7) = 가맹점정보.지사코드
        sValue(8) = 가맹점정보.택코드
        sValue(9) = 가맹점정보.가맹점코드
        sValue(10) = 가맹점정보.가맹점명
        sValue(11) = "LAUNDRY"
        sValue(12) = Now
        
        '-------------------------------------------------------------------------------------------
        '
        '-------------------------------------------------------------------------------------------
        Query = "EXEC PRO_STORE_CHANGE "
        Query = Query & "'" & sValue(0) & "', "
        Query = Query & "'" & sValue(1) & "', "
        Query = Query & "'" & sValue(2) & "', "
        Query = Query & "'" & sValue(3) & "', "
        Query = Query & "'" & sValue(4) & "', "
        Query = Query & "'" & sValue(5) & "', "
        Query = Query & "'" & sValue(6) & "', "
        Query = Query & "'" & sValue(7) & "', "
        Query = Query & "'" & sValue(8) & "', "
        Query = Query & "'" & sValue(9) & "', "
        Query = Query & "'" & sValue(10) & "', "
        Query = Query & "'" & sValue(11) & "', "
        Query = Query & "'" & sValue(12) & "' "
        HostCon.Execute Query
    
        HostCon.CommitTrans
    End If

    SUBRs.Close
    Set SUBRs = Nothing
    
    Set HostCon = Nothing

    On Error GoTo 0
    
    Exit Function

ErrRtn:
    HostCon.RollbackTrans
    
    SendStoreDefaultInfo = False
    
    Call Error_Msg("SendStoreDefaultInfo", Err.Source, Err.Number, Err.description)
    
    Resume
End Function

Public Function GetMasterStoreFromToDate(ByVal sDate As String, ByRef sMaster As String, ByRef sStore As String) As Boolean
    GetMasterStoreFromToDate = False
    
    If Server_Connection(HostCon) = True Then
        '---------------------------------------------------------------------------------------
        ' 해당 기간은 무조건 1개여야 한다. 2개 이상일 경우 첫번째것으로 처리한다.
        '---------------------------------------------------------------------------------------
        Query = "SELECT TOP 1 * "
        Query = Query & " FROM MASTER_TAG_TBL "
        Query = Query & " WHERE Store_CD = '" & 가맹점정보.가맹점코드 & "' "
        Query = Query & "   AND START_DT BETWEEN '" & sDate & "' AND ISNULL(END_DT,'2099-12-31') "
        'Query = Query & "   AND '" & sDate & "' BETWEEN START_DT AND ISNULL(END_DT,'2099-12-31') "
        Query = Query & " ORDER BY START_DT "
        Set Rs = New ADODB.Recordset
        Rs.Open Query, HostCon, adOpenStatic, adLockOptimistic
        
        'If Rs.State = adStateOpen Then Rs.Close
        'Rs.CursorLocation = adUseClient
        'Rs.Open Query, HostCon, adOpenStatic, adLockBatchOptimistic, adCmdText

        If Not Rs.EOF = True Then
            sMaster = Rs.Fields("MASTER_CD") & ""
            sStore = Rs.Fields("TAG_NB") & ""
            
            GetMasterStoreFromToDate = True
        Else
            sMaster = ""
            sStore = ""
            
            GetMasterStoreFromToDate = False
        End If
    End If
    Rs.Close
    Set Rs = Nothing
    
    Set HostCon = Nothing
End Function

'
''====================================================================================================
'' Procedure : SendNoSalesData
'' DateTime  : 2008-04-15 20:29
'' Author    : pds2004
'' Last Edit :
'' Return Val:
''----------------------------------------------------------------------------------------------------
'' 설     명 : "N"로 설정되어 있는 모든 일자의 자료를 다시전송한다..
''====================================================================================================
'Public Function SendNoSalesData() As Boolean
'    Dim iDay    As Integer
'    Dim iTempDay    As String
'
'    Dim sData(27)   As String
'    Dim sCode(1)    As String
'
'    Dim sSendDate() As String
'
'    On Error GoTo ErrRtn
'
'    If Trim(가맹점정보.가맹점코드) = "000000" Then
'        MsgBox "가맹점 정보가 올바르지 않습니다.", vbCritical, "경고"
'        Exit Function
'    End If
'
'
'    If Server_Connection(HostCon) = True Then
'        'N로 설정되어 있는 모든 일자를 구한다.
'        Query = "SELECT    STORE_CD"
'        Query = Query & ", SALE_DT"
'        Query = Query & " FROM SALE_TBL"
'        Query = Query & " WHERE Store_CD  = '" & 가맹점정보.가맹점코드 & "'"
'        Query = Query & "   AND TRANS_CHK = 'N'"
'        Set SUBRs = New ADODB.Recordset
'        SUBRs.Open Query, HostCon, adOpenStatic, adLockOptimistic
'
'        'If ADORset.State = adStateOpen Then ADORset.Close
'        'ADORset.CursorLocation = adUseClient
'        'ADORset.Open Query, HostCon, adOpenStatic, adLockBatchOptimistic, adCmdText
'
'        iDay = 0
'
'        Do While Not SUBRs.EOF
'            ReDim Preserve sSendDate(iDay)
'
'            sSendDate(iDay) = SUBRs.Fields("SALE_DT") & ""
'            iDay = iDay + 1
'
'            SUBRs.MoveNext
'        Loop
'        SUBRs.Close
'        Set SUBRs = Nothing
'
'        ' 없을 경우
'        If iDay <= 0 Then
'            Exit Function
'        End If
'
'        For iDay = 0 To UBound(sSendDate)
'            '실제 전송일자
'            iTempDay = Format(sSendDate(iDay), "YYYY-MM-DD")
'
'            ' 전송 정보를 알아온다.
'            Erase sData
'
'            Call GetSendDataValues(iTempDay, sData)
'
'            ' 해당 일자의 자료가 있을 경우만 작업한다.
'            If sData(1) <> "" Then
'                ' 해당 일자의 지사및 체인점 코드를 알아온다.
'                Erase sCode
'
'                If GetMasterStoreFromToDate(Format(iTempDay, "YYYY-MM-DD"), sCode(0), sCode(1)) = False Then
'                    ' 본사에서 확인하여 처리할 수 있도록 하기위하여
'                    ' 지사 정보가 없더라도 전송 처리한다.
'                End If
'
'                '---------------------------------------------------------------------------
'                '
'                '---------------------------------------------------------------------------
'                Query = "SELECT STORE_CD, TRANS_CHK "
'                Query = Query & " FROM SALE_TBL "
'                Query = Query & " WHERE Store_CD = '" & 가맹점정보.가맹점코드 & "' "
'                Query = Query & "   AND SALE_DT  = '" & Format(iTempDay, "YYYY-MM-DD") & "' "
'                Set SUBRs = New ADODB.Recordset
'                SUBRs.Open Query, HostCon, adOpenStatic, adLockOptimistic
'
'                If SUBRs.EOF = True Then
'                    Query = "INSERT INTO SALE_TBL (SALE_DT, STORE_CD, "
'                    Query = Query & " MASTER_CD , TAG_NB, "
'                    Query = Query & " START_TAG, END_TAG, "
'                    Query = Query & " SALE_AMT, MASTER_AMT, "
'                    Query = Query & " STORE_AMT , IN_CNT, "
'                    Query = Query & " JAES_CNT, SU_CNT, "
'                    Query = Query & " BAN_CNT , OUT_CNT, "
'                    Query = Query & " CARD_AMT, CARD_CNT, "
'                    Query = Query & " SU_AMT, SALE_CHK, "
'                    Query = Query & " CREATE_MIL, USE_MIL, DELETE_MIL,"
'                    Query = Query & " TRANS_CHK , TRANS_DT)"
'
'                    Query = Query & " VALUES ('" & sData(1) & "', '" & 가맹점정보.가맹점코드 & "', "
'                    Query = Query & " '" & sCode(0) & "', '" & sCode(1) & "',"
'                    Query = Query & " '" & sData(11) & "', '" & sData(12) & "', " 'START_TAG, END_TAG
'                    Query = Query & " " & sData(6) & ", " & sData(7) & ", "       'SALE_AMT, MASTER_AMT
'                    Query = Query & " " & sData(8) & ", " & sData(2) & ", "       'STORE_AMT, IN_CNT
'                    Query = Query & " " & sData(4) & ", " & sData(5) & ", "       'JAES_CNT, SU_CNT
'                    Query = Query & " " & sData(3) & ", " & "0" & ", "            'BAN_CNT, OUT_CNT
'                    Query = Query & " " & sData(18) & ", " & sData(19) & ", "     'CARD_AMT, CARD_CNT
'                    Query = Query & " " & sData(9) & ", '" & sData(10) & "', "     'SU_AMT, SALE_CHK
'                    Query = Query & " " & sData(15) & ", " & sData(16) & ", " & sData(17) & ", "     'CREATE_MIL, USE_MIL, DELETE_MIL
'                    Query = Query & " 'Y', '" & Format(Date, "YYYY-MM-DD") & "' "    'TRANS_CHK , TRANS_DT
'                    Query = Query & " )"
'                    HostCon.Execute Query
'                Else
'                    If SUBRs.Fields("TRANS_CHK") = "N" Then
'                        Query = "UPDATE SALE_TBL SET"
'                        Query = Query & "  MASTER_CD  = '" & sCode(0) & "'"
'                        Query = Query & ", TAG_NB     = '" & sCode(1) & "'"
'                        Query = Query & ", START_TAG  = '" & sData(11) & "'"
'                        Query = Query & ", END_TAG    = '" & sData(12) & "'"
'                        Query = Query & ", SALE_AMT   =  " & sData(6)
'                        Query = Query & ", MASTER_AMT =  " & sData(7)
'                        Query = Query & ", STORE_AMT  =  " & sData(8)
'                        Query = Query & ", IN_CNT     =  " & sData(2)
'                        Query = Query & ", JAES_CNT   =  " & sData(4)
'                        Query = Query & ", SU_CNT     =  " & sData(5)
'                        Query = Query & ", BAN_CNT    =  " & sData(3)
'                        Query = Query & ", OUT_CNT    =  " & "0"
'                        Query = Query & ", CARD_AMT   =  " & sData(18)
'                        Query = Query & ", CARD_CNT   =  " & sData(19)
'                        Query = Query & ", SU_AMT     =  " & sData(9)
'                        Query = Query & ", SALE_CHK   = '" & sData(10) & "', "
'                        Query = Query & ", CREATE_MIL =  " & sData(15)
'                        Query = Query & ", USE_MIL    =  " & sData(16)
'                        Query = Query & ", DELETE_MIL =  " & sData(17)
'                        Query = Query & ", TRANS_CHK  = 'Y'"
'                        Query = Query & ", TRANS_DT   = '" & Format(Date, "YYYY-MM-DD") & "'"
'                        Query = Query & " WHERE Store_CD = '" & 가맹점정보.가맹점코드 & "'"
'                        Query = Query & "   AND SALE_DT  = '" & Format(iTempDay, "YYYY-MM-DD") & "'"
'                        HostCon.Execute Query
'                    End If
'                End If
'                SUBRs.Close
'                Set SUBRs = Nothing
'
'            End If
'        Next iDay
'    End If
'
'    Set HostCon = Nothing
'
'    SendNoSalesData = True
'
'    Exit Function
'
'ErrRtn:
'    SendNoSalesData = False
'
'    Call Error_Msg("SendNoSalesData", Err.Source, Err.Number, Err.Description)
'End Function
'
''====================================================================================================
'' Procedure : SendSalesData
'' DateTime  : 2008-04-15 20:29
'' Author    : pds2004
'' Last Edit :
'' Return Val:
''----------------------------------------------------------------------------------------------------
'' 설     명 : 기본적으로 최근 1주일 내용을 전송한다.
''====================================================================================================
'Public Function SendSalesData(ByVal sSendDate As String, Optional iSendDay As Integer = 0) As Boolean
'    Dim iDay      As Integer
'    Dim iTempDay  As String
'
'    Dim sData(27) As String
'    Dim sCode(1)  As String
'
'    On Error GoTo ErrRtn
'
'    If Trim(가맹점정보.가맹점코드) = "000000" Then
'        MsgBox "가맹점 정보가 올바르지 않습니다.", vbCritical, "경고"
'
'        Exit Function
'    End If
'
'    If Server_Connection(HostCon) = True Then
'        For iDay = 0 To iSendDay
'            '실제 전송일자
'            iTempDay = DateAdd("d", iDay, sSendDate)
'
'            ' 전송 정보를 알아온다.
'            Erase sData
'
'            Call GetSendDataValues(iTempDay, sData)
'
'            ' 해당 일자의 자료가 있을 경우만 작업한다.
'            If sData(1) <> "" And sData(2) <> "0" Then
'                ' 해당 일자의 지사및 체인점 코드를 알아온다.
'                Erase sCode
'
'                If GetMasterStoreFromToDate(Format(iTempDay, "YYYY-MM-DD"), sCode(0), sCode(1)) = False Then
'                    ' 본사에서 확인하여 처리할 수 있도록 하기위하여 지사 정보가 없도라도 전송 처리한다.
'                End If
'
'                '--------------------------------------------------------------------------
'                '
'                '--------------------------------------------------------------------------
'                Query = "SELECT STORE_CD, TRANS_CHK "
'                Query = Query & " FROM SALE_TBL "
'                Query = Query & " WHERE Store_CD = '" & 가맹점정보.가맹점코드 & "' "
'                Query = Query & "   AND SALE_DT  = '" & Format(iTempDay, "YYYY-MM-DD") & "' "
'                Set SUBRs = New ADODB.Recordset
'                SUBRs.Open Query, HostCon, adOpenStatic, adLockOptimistic
'
'                If SUBRs.EOF = True Then
'                    Query = "INSERT INTO TB_SALE_TBL ("
'                    Query = Query & "  SALE_DT"            '
'                    Query = Query & ", STORE_CD"           '
'                    Query = Query & ", MASTER_CD"          '
'                    Query = Query & ", TAG_NB"             '
'                    Query = Query & ", START_TAG"          '
'                    Query = Query & ", END_TAG"            '
'                    Query = Query & ", SALE_AMT"           '
'                    Query = Query & ", MASTER_AMT"         '
'                    Query = Query & ", STORE_AMT"          '
'                    Query = Query & ", IN_CNT"             '
'                    Query = Query & ", JAES_CNT"           '
'                    Query = Query & ", SU_CNT"             '
'                    Query = Query & ", BAN_CNT"            '
'                    Query = Query & ", OUT_CNT"            '
'                    Query = Query & ", CARD_AMT"           '
'                    Query = Query & ", CARD_CNT"           '
'                    Query = Query & ", SU_AMT"             '
'                    Query = Query & ", SALE_CHK"           '
'                    Query = Query & ", CREATE_MIL"         '
'                    Query = Query & ", USE_MIL"            '
'                    Query = Query & ", DELETE_MIL"         '
'                    Query = Query & ", RunningCnt"         '
'                    Query = Query & ", RunningMoney"       '
'                    Query = Query & ", RunningPer"         '
'                    Query = Query & ", SALERETURN_CNT"     '
'                    Query = Query & ", SALERETURN_AMT"     '
'                    Query = Query & ", SAMSUNGCARDMEM_CNT" '
'                    Query = Query & ", SAMSUNGCARD_CNT"    '
'                    Query = Query & ", SAMSUNGCARD_AMT"    '
'                    Query = Query & ", TRANS_CHK"          '
'                    Query = Query & ", TRANS_DT)"          '
'
'                    Query = Query & " VALUES ("
'                    Query = Query & "  '" & sData(1) & "'"                   '
'                    Query = Query & ", '" & 가맹점정보.가맹점코드 & "'"       '
'                    Query = Query & ", '" & sCode(0) & "'"                   '
'                    Query = Query & ", '" & sCode(1) & "'"                   '
'                    Query = Query & ", '" & sData(11) & "'"                  'START_TAG
'                    Query = Query & ", '" & sData(12) & "'"                  'END_TAG
'                    Query = Query & ",  " & sData(6)                         'SALE_AMT
'                    Query = Query & ",  " & sData(7)                         'MASTER_AMT
'                    Query = Query & ",  " & sData(8)                         'STORE_AMT
'                    Query = Query & ",  " & sData(2)                         'IN_CNT
'                    Query = Query & ",  " & sData(4)                         'JAES_CNT
'                    Query = Query & ",  " & sData(5)                         'SU_CNT
'                    Query = Query & ",  " & sData(3)                         'BAN_CNT
'                    Query = Query & ",  " & "0"                              'OUT_CNT
'                    Query = Query & ",  " & sData(18)                        'CARD_AMT
'                    Query = Query & ",  " & sData(19)                        'CARD_CNT
'                    Query = Query & ",  " & sData(9)                         'SU_AMT
'                    Query = Query & ", '" & sData(10) & "'"                  'SALE_CHK
'                    Query = Query & ", " & sData(15)                         'CREATE_MIL
'                    Query = Query & ", " & sData(16)                         'USE_MIL
'                    Query = Query & ", " & sData(17)                         'DELETE_MIL
'
'                    Query = Query & ", " & sData(20)                         'RunningCnt
'                    Query = Query & ", " & sData(21)                         'RunningMoney
'                    Query = Query & ", " & sData(22)                         'RunningPer
'                    Query = Query & ", " & sData(23)                         '
'                    Query = Query & ", " & sData(24)                         'RunningCnt , RunningMoney, RunningPer, "
'                    Query = Query & ", " & sData(25)                         'RunningCnt
'                    Query = Query & ", " & sData(26)                         'RunningMoney
'                    Query = Query & ", " & sData(27)                         'RunningPer
'                    Query = Query & ", 'Y'"                                  'TRANS_CHK
'                    Query = Query & ", '" & Format(Date, "YYYY-MM-DD") & "'" 'TRANS_DT
'                    Query = Query & ")"
'                    HostCon.Execute Query
'
'                Else
'                    If SUBRs.Fields("TRANS_CHK") = "N" Then
'                        Query = "UPDATE SALE_TBL SET"
'                        Query = Query & "  MASTER_CD          = '" & sCode(0) & "'"
'                        Query = Query & ", TAG_NB             = '" & sCode(1) & "'"
'                        Query = Query & ", START_TAG          = '" & sData(11) & "'"
'                        Query = Query & ", END_TAG            = '" & sData(12) & "'"
'                        Query = Query & ", SALE_AMT           =  " & sData(6)
'                        Query = Query & ", MASTER_AMT         =  " & sData(7)
'                        Query = Query & ", STORE_AMT          =  " & sData(8)
'                        Query = Query & ", IN_CNT             =  " & sData(2)
'                        Query = Query & ", JAES_CNT           =  " & sData(4)
'                        Query = Query & ", SU_CNT             =  " & sData(5)
'                        Query = Query & ", BAN_CNT            =  " & sData(3)
'                        Query = Query & ", OUT_CNT            =  " & "0"
'                        Query = Query & ", CARD_AMT           =  " & sData(18)
'                        Query = Query & ", CARD_CNT           =  " & sData(19)
'                        Query = Query & ", SU_AMT             =  " & sData(9)
'                        Query = Query & ", SALE_CHK           = '" & sData(10) & "'"
'                        Query = Query & ", CREATE_MIL         =  " & sData(15)
'                        Query = Query & ", USE_MIL            =  " & sData(16)
'                        Query = Query & ", DELETE_MIL         =  " & sData(17)
'                        Query = Query & ", RunningCnt         =  " & sData(20)
'                        Query = Query & ", RunningMoney       =  " & sData(21)
'                        Query = Query & ", RunningPer         =  " & sData(22)
'                        Query = Query & ", SALERETURN_CNT     =  " & sData(23)
'                        Query = Query & ", SALERETURN_AMT     =  " & sData(24)
'                        Query = Query & ", SAMSUNGCARDMEM_CNT =  " & sData(25)
'                        Query = Query & ", SAMSUNGCARD_CNT    =  " & sData(26)
'                        Query = Query & ", SAMSUNGCARD_AMT    =  " & sData(27)
'                        Query = Query & ", TRANS_CHK          = 'Y'"
'                        Query = Query & ", TRANS_DT           = '" & Format(Date, "YYYY-MM-DD") & "'"
'                        Query = Query & " WHERE Store_CD = '" & 가맹점정보.가맹점코드 & "'"
'                        Query = Query & "   AND SALE_DT  = '" & Format(iTempDay, "YYYY-MM-DD") & "'"
'                        HostCon.Execute Query
'                    End If
'                End If
'                SUBRs.Close
'                Set SUBRs = Nothing
'            End If
'        Next iDay
'    End If
'
'    Set HostCon = Nothing
'
'    SendSalesData = True
'
'    Exit Function
'
'ErrRtn:
'    SendSalesData = False
'
'    Call Error_Msg("SendSalesData", Err.Source, Err.Number, Err.Description)
'End Function

Private Function GetSendDataValues(ByVal sSendData As String, ByRef sData() As String) As Boolean
    Dim dblMil      As Double
    Dim StoreMoney  As Double
    Dim MasterMoney As Double
        
    On Error GoTo ErrRtn
    
    GetSendDataValues = False
        
    '-----------------------------------------------------------------------
    ' 가맹점 코드를 Check한다.
    '-----------------------------------------------------------------------
    Query = "SELECT * FROM TB_일일마감"
    Query = Query & " WHERE 마감일자 = '" & Format(sSendData, "YYYY-MM-DD") & "' "
    Set Rs = New ADODB.Recordset
    Rs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    ' 가맹점코드가 없으면 종료를 한다.
    If Not Rs.EOF Then
        dblMil = IIf(IsNull(Rs!사용마일리지) = True, 0, Rs!사용마일리지)

'        If Format(sSendData, "YYYY-MM-DD") >= "20080501" Then
'            ' 2009-08-27일
'            ' 이부분에서 오류가 있음
'            ' 본사및 가맹점매출에서 해당 마일리지 비율을 제외한 금액을 전송하려고 하였으나
'            ' 비율에 0이 들어가는 오류로 본사 금액은 마일리지가 포함된금액이 그래로 전송이 되며
'            ' 체인점 금액에서 마일리지가 차감된 금액으로 전송하도록 되어 있음. ㅡㅡ
'            ' 임으로 바꿀수 없어서 본사 처리루틴에서 일괄 적용 하기로 처리함
'            MasterMoney = Rs.Fields("본사금액") - (dblMil * dblRatio)
'            StoreMoney = Rs.Fields("가맹점금액") - (dblMil * (1 - dblRatio))
'        Else
'            MasterMoney = Rs.Fields("본사금액")
'            StoreMoney = Rs.Fields("가맹점금액")
'        End If
    
        MasterMoney = Rs.Fields("본사금액")
        StoreMoney = Rs.Fields("가맹점금액")
    
    
        sData(0) = 가맹점정보.가맹점코드 & ""
        sData(1) = Trim(Rs!일자 & "")
        sData(2) = IIf(IsNumeric(Rs!접수수량 & ""), Rs!접수수량, "0")
        sData(3) = IIf(IsNumeric(Rs!반품수량 & ""), Rs!반품수량, "0")
        sData(4) = IIf(IsNumeric(Rs!재세탁수량 & ""), Rs!재세탁수량, "0")
        sData(5) = IIf(IsNumeric(Rs!수선수량 & ""), Rs!수선수량, "0")
        sData(6) = IIf(IsNumeric(Rs!접수금액 & ""), Rs!접수금액, "0")
        sData(7) = MasterMoney
        sData(8) = StoreMoney
        sData(9) = IIf(IsNumeric(Rs!수선금액 & ""), Rs!수선금액, "0")
        sData(10) = Rs!판매구분 & ""
        sData(11) = Rs!시작택 & ""
        sData(12) = Rs!종료택 & ""
        sData(13) = Rs!마감여부 & ""
        sData(14) = Rs!본사전송여부 & ""
        sData(15) = IIf(IsNumeric(Rs!발생마일리지 & ""), Rs!발생마일리지, "0")
        sData(16) = IIf(IsNumeric(Rs!사용마일리지 & ""), Rs!사용마일리지, "0")
        sData(17) = IIf(IsNumeric(Rs!삭제마일리지 & ""), Rs!삭제마일리지, "0")
        sData(18) = IIf(IsNumeric(Rs!카드금액 & ""), Rs!카드금액, "0")
        sData(19) = IIf(IsNumeric(Rs!카드건수 & ""), Rs!카드건수, "0")
        
        sData(20) = IIf(IsNumeric(Rs!운동화건수 & ""), Rs!운동화건수, "0")
        sData(21) = IIf(IsNumeric(Rs!운동화금액 & ""), Rs!운동화금액, "0")
        sData(22) = Val(가맹점정보.외주마진 & "")
        
        sData(23) = IIf(IsNumeric(Rs!세탁환불건수 & ""), Rs!세탁환불건수, "0")
        sData(24) = IIf(IsNumeric(Rs!세탁환불금액 & ""), Rs!세탁환불금액, "0")
        
        sData(25) = IIf(IsNumeric(Rs!삼성카드할인고객수 & ""), Rs!삼성카드할인고객수, "0")
        sData(26) = IIf(IsNumeric(Rs!삼성카드할인건수 & ""), Rs!삼성카드할인건수, "0")
        sData(27) = IIf(IsNumeric(Rs!삼성카드할인금액 & ""), Rs!삼성카드할인금액, "0")
        
        
        ' 마감되지 않았을 경우 전송하지 않는다.
        If sData(13) <> "Y" Then sData(2) = "0"
        
    Else
        sData(0) = 가맹점정보.가맹점코드 & ""
        
        If 가맹점정보.적용일자 <= Format(sSendData, "YYYY-MM-DD") Then
            sData(1) = Format(sSendData, "YYYY-MM-DD")
        Else
            sData(1) = ""
        End If
        
        sData(2) = "0"
        sData(3) = "0"
        sData(4) = "0"
        sData(5) = "0"
        sData(6) = "0"
        sData(7) = "0"
        sData(8) = "0"
        sData(9) = "0"
        sData(10) = ""
        sData(11) = ""
        sData(12) = ""
        sData(13) = ""
        sData(14) = ""
        sData(15) = "0"
        sData(16) = "0"
        sData(17) = "0"
        sData(18) = "0"
        sData(19) = "0"
        sData(20) = "0"
        sData(21) = "0"
        sData(22) = "0"
    
        sData(23) = "0"
        sData(24) = "0"
        sData(25) = "0"
        sData(26) = "0"
        sData(27) = "0"
    End If
        
    Rs.Close
    Set Rs = Nothing
    
    GetSendDataValues = True
    
    Exit Function
    
ErrRtn:
    GetSendDataValues = False
    
    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure GetSendDataValues of Module Global"
End Function

Private Function GetSendDataCouponValues(ByVal sSendData As String, ByRef sData() As String) As Boolean
    On Error GoTo ErrRtn
    
    GetSendDataCouponValues = False
    
    ' 가맹점 코드를 Check한다.
    'Set SUBRs = MyDB.OpenRecordset("SELECT * FROM TB_쿠폰자료 WHERE 접수일자 = '" & Format(sSendData, "YYYY-MM-DD") & "' ")
            
    '----------------------------------------------------------------------------
    '
    '----------------------------------------------------------------------------
    Query = "SELECT * FROM TB_쿠폰자료"
    Query = Query & " WHERE 접수일자 = '" & Format(sSendData, "YYYY-MM-DD") & "' "
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    ' 자료가 없으면 종료를 한다.
    If Not SUBRs.EOF Then
        sData(0) = 가맹점정보.가맹점코드 & ""
        sData(1) = Trim(SUBRs!접수일자 & "")
        sData(2) = Trim(SUBRs!쿠폰번호 & "")
        sData(3) = IIf(IsNumeric(SUBRs!쿠폰단가 & ""), SUBRs!쿠폰단가, "0")
        sData(4) = IIf(IsNumeric(SUBRs!쿠폰금액 & ""), SUBRs!쿠폰금액, "0")
        sData(5) = Trim(SUBRs!고객코드 & "")
        sData(6) = Trim(SUBRs!고객이름 & "")
        sData(7) = IIf(IsNumeric(SUBRs!접수금액 & ""), SUBRs!접수금액, "0")
        sData(8) = Trim(SUBRs!택번호 & "")
    
    Else
        sData(0) = 가맹점정보.가맹점코드 & ""
        
        If 가맹점정보.적용일자 <= Format(sSendData, "YYYY-MM-DD") Then
            sData(1) = Format(sSendData, "YYYY-MM-DD")
        Else
            sData(1) = ""
        End If
        
        sData(2) = ""
        sData(3) = "0"
        sData(4) = "0"
        sData(5) = ""
        sData(6) = ""
        sData(7) = "0"
        sData(8) = "0"
    End If
    
    SUBRs.Close
    Set SUBRs = Nothing
        
    GetSendDataCouponValues = True
    
    Exit Function
    
ErrRtn:
    GetSendDataCouponValues = False
    
    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure GetSendDataCouponValues of Module Global"
End Function


Public Function GetMailConvert(sData As String, bMode As String) As String
    Select Case bMode
        Case "READ"
            GetMailConvert = Replace(sData, "~&^", "'")
        
          '  sTemp = Replace(sTemp, vbNewLine, "")
          '  sTemp = Replace(sTemp, Chr(8), "")
        
        Case "SAVE"
            GetMailConvert = Replace(sData, "'", "~&^")
        
        Case Else
            GetMailConvert = sData
    End Select
End Function

'
''====================================================================================================
'' Procedure : GetMailData
'' DateTime  : 2008-04-15 20:29
'' Author    : pds2004
'' Last Edit :
'' Return Val:
''----------------------------------------------------------------------------------------------------
'' 설     명 : "N"로 설정되어 있는 모든 일자의 자료를 다시전송한다..
''====================================================================================================
'Public Function GetMailData() As Boolean
'    Dim sTemp       As String
'
'    On Error GoTo GetMailData_Error
'
'    If Trim(가맹점정보.가맹점코드) = "000000" Then
'        MsgBox "가맹점 정보가 올바르지 않습니다.", vbCritical, "경고"
'
'        Exit Function
'    End If
'
'    If Server_Connection(HostCon) = True Then
'        'N로 설정되어 있는 모든 일자를 구한다.
'        Query = "SELECT * FROM Mail_ALL"
'        Query = Query & " WHERE SendChk = '1'"
'        Query = Query & "   AND AgencyCode = '" & 가맹점정보.가맹점코드 & "' "
'        Set SUBRs = New ADODB.Recordset
'        SUBRs.Open Query, HostCon, adOpenStatic, adLockOptimistic
'
'        'If ADORset.State = adStateOpen Then ADORset.Close
'        '
'        'ADORset.CursorLocation = adUseClient
'        'ADORset.Open Query, HostCon, adOpenStatic, adLockBatchOptimistic, adCmdText
'
'        Do While Not SUBRs.EOF
'            Query = "SELECT * FROM TB_공지사항"
'            Query = Query & " WHERE 작성일자 = '" & SUBRs.Fields("MailDate") & "' "
'            Query = Query & "   AND 문서번호 = " & SUBRs.Fields("MailNo") & " "
'            Query = Query & "   AND 공지구분 = '2' "
'            Set Rs = New ADODB.Recordset
'            Rs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
'
'            sTemp = GetMailConvert(SUBRs.Fields("MailDesc"), "SAVE")
'
'            'Set rsTempTb = MyDB.OpenRecordset(Query)
'
'            If Not Rs.EOF Then
'                Query = "UPDATE TB_공지사항 SET"
'                Query = Query & "  공지내용 = '" & sTemp & "'"
'                Query = Query & ", 시작일자 = '" & SUBRs.Fields("MailFrom") & "'"
'                Query = Query & ", 종료일자 = '" & SUBRs.Fields("MailTo") & "'"
'                Query = Query & ", 수신여부 = 'N'"
'                Query = Query & ", 수신일자 = ''"
'                Query = Query & " WHERE 작성일자 = '" & SUBRs.Fields("MailDate") & "' "
'                Query = Query & "   AND 문서번호 =  " & SUBRs.Fields("MailNo") & " "
'                Query = Query & "   AND 공지구분 = '2' "
'                ADOCon.Execute Query
'            Else
'                Query = "INSERT INTO TB_공지사항("
'                Query = Query & "  공지구분"
'                Query = Query & ", 작성일자"
'                Query = Query & ", 문서번호"
'                Query = Query & ", 공지내용"
'                Query = Query & ", 시작일자"
'                Query = Query & ", 종료일자"
'                Query = Query & ", 수신여부"
'                Query = Query & ", 수신일자"
'                Query = Query & ", 본사전송여부) VALUES ("
'                Query = Query & "  '" & SUBRs.Fields("MailType") & "'"
'                Query = Query & ", '" & SUBRs.Fields("MailDate") & "'"
'                Query = Query & ",  " & SUBRs.Fields("MailNo") & ""
'                Query = Query & ", '" & sTemp & "'"
'                Query = Query & ", '" & SUBRs.Fields("MailFrom") & "'"
'                Query = Query & ", '" & SUBRs.Fields("MailTo") & "'"
'                Query = Query & ", 'N'"
'                Query = Query & ",''"
'                Query = Query & ",'N')"
'                ADOCon.Execute Query
'            End If
'            Rs.Close
'            Set Rs = Nothing
'
'            '---------------------------------------------------------------------
'            '
'            '---------------------------------------------------------------------
'            Query = "UPDATE Mail_ALL SET SendChk = '2'"
'            Query = Query & " WHERE SendChk    = '1'"
'            Query = Query & "   AND AgencyCode = '" & 가맹점정보.가맹점코드 & "' "
'            Query = Query & "   AND MailNo     = " & SUBRs.Fields("MailNo") & " "
'            HostCon.Execute Query
'
'            SUBRs.MoveNext
'        Loop
'
'        SUBRs.Close
'        Set SUBRs = Nothing
'    End If
'
'    Set HostCon = Nothing
'
'    GetMailData = True
'
'    On Error GoTo 0
'
'    Exit Function
'
'GetMailData_Error:
'    GetMailData = False
'    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure GetMailData of Module Global"
'End Function

'------------------------------------------------------------------
' 전달된 택번호가 입출고에 있을 경우 False를 리턴한다.
' 판매 취소일 경우는 False로 리턴한다.
'------------------------------------------------------------------
Public Function DayTagchk(ByVal strTagChk As String) As Boolean
    Dim 택번호    As String
    Dim strDayChk As String
    
    택번호 = 가맹점정보.택코드 & Replace(strTagChk, "-", "")
    
    '입출고 table 에 자료가 중복된경우 체크
    strDayChk = strTagChk
    
    If Not IsTagNo(strDayChk) Then
        MsgBox " 전달된 택번호가 올바르지 않습니다. ", "택번호 오류"
        Exit Function
    End If
    
    '------------------------------------------------------------------------
    '
    '------------------------------------------------------------------------
    Query = "SELECT 택번호 FROM TB_입출고"
    Query = Query & " WHERE 택번호   = '" & 택번호 & "'"
    Query = Query & "   AND 접수일자 >= '" & Format(DateAdd("d", -5, Date), "yyyy-MM-dd") & "'"
    Query = Query & "   AND ( 판매취소 <> 'Y'  OR 판매취소 IS NULL )"
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
    
    If SUBRs.EOF Then
        DayTagchk = True        ' 같은 택번호가 없는경우
    Else
        DayTagchk = False       ' 같은 택번호가 있는경우
    End If
    SUBRs.Close
    Set SUBRs = Nothing
End Function

Public Function TAG_Check(ByVal txtTag As String) As Boolean
    '화면상에서 중복된 자료 체크

    Dim LastRow1 As Integer
    Dim strTag   As String
    Dim strTAG2  As String
    
    Dim chkRow   As Long
    
    strTag = Trim(txtTag)
    
    If Not IsTagNo(strTag) Then
        MsgBox " 전달된 택번호가 올바르지 않습니다. ", vbCritical, "택번호 오류"
        TAG_Check = False
        Exit Function
    End If
    
    LastRow1 = GetSpreadLine(frm접수.sprGrid) - 1
    
    ' 마지막 라인이 2줄보다 작을 경우 입력한 내용은 1줄이므로 비교할 필요가 없다.
    If LastRow1 < 1 Then
        TAG_Check = True
        Exit Function
    End If
    
    For chkRow = 1 To LastRow1
        strTAG2 = Get_SpreadText(frm접수.sprGrid, chkRow, 2)
        
        If Len(strTAG2) >= 1 Then
            If strTag = Trim(strTAG2) Then
                TAG_Check = False
                
                Exit Function
            End If
        End If
    Next chkRow
    
    TAG_Check = True
End Function

' 색상이 입력 되어 있는지 검사한다.
' 입력시 True 리턴
Public Function f_newRowChk()
    frm접수.sprGrid.Row = frm접수.sprGrid.ActiveRow
    frm접수.sprGrid.Col = 3
    
    If Len(frm접수.sprGrid.Text) > 1 Then
        NewRowchk = True
    Else
        NewRowchk = False
    End If
End Function

Public Function PrNumSet(Num As Variant, Cnt As Integer)
    Dim Num1 As Double
    Dim Str As String
    
    Num1 = Val(Num)
    Str = "                   " & Format(Num1, "#,##0")
    PrNumSet = Right(Str, Cnt)
End Function

Public Sub G_CashKeyUp(Text2 As Control, KeyCode As Integer)
    Dim iCurSelstart  As Integer
    Dim iTextEnd_flag As Integer
    Dim iTextLen1     As Integer
    Dim iTextLen2     As Integer
    Dim buff          As String
    
    iCurSelstart = Text2.SelStart
    
    If (KeyCode >= vbKey0 And KeyCode <= vbKey9 Or _
        KeyCode >= vbKeyNumpad0 And KeyCode <= vbKeyNumpad9 Or _
        KeyCode = vbKeyBack Or KeyCode = vbKeyDelete) Then
        
        '정상적인 키입력과 수정하려는 키입력을 구분하기 위해 플래그를 설치
        '-----------------------------------------------------------------
        If iCurSelstart = LenB(Text2.Text) Then
            iTextEnd_flag = True
        Else
            iTextEnd_flag = False
        End If
        
        iTextLen1 = LenB(Text2.Text)                        ' 포맷형식으로 수정되기 전의 길이
        
        buff = Format(Text2.Text, "###############")
        
        If Left(buff, 1) = "," Then buff = Mid(buff, 2)     ' ",###"일경우 "###"로
        
        Text2.Text = Format(buff, "###,###,###,###,###")
        
        If iTextEnd_flag = True Then
            Text2.SelStart = LenB(Text2.Text)
        Else
            iTextLen2 = LenB(Text2.Text) '포맷형식으로 수정된 길이
            '길이차이가 1만큼난다는 것은 자릿수가 하나 더 늘었다는 것을 의미
            '---------------------------------------------------------------
            If iTextLen2 - iTextLen1 = 1 Then
                Text2.SelStart = iCurSelstart + 1
            Else
                If iCurSelstart >= 4 Then
                    Text2.SelStart = iCurSelstart + 1
                Else
                    Text2.SelStart = iCurSelstart
                End If
            End If
        End If
    End If
    
    Set Text2 = Nothing
End Sub

Public Function G_CashKeyPress(KeyAscii As Integer) As Integer
    If (KeyAscii >= vbKey0 And KeyAscii <= vbKey9) Or KeyAscii = vbKeyReturn Or _
        KeyAscii = vbKeyDelete Or KeyAscii = vbKeyBack Or KeyAscii = vbKeyReturn Then
    Else
        KeyAscii = 0
    End If
    
    G_CashKeyPress = KeyAscii
End Function

Sub TAG_Load()
    Dim strTagNo As String
    Dim strDate  As String
    
    '--------------------------------------------------------------
    '
    '--------------------------------------------------------------
    Query = "SELECT 택번호 FROM TB_기본정보 "
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    If SUBRs.EOF Then
        frm접수.cmdTagNo.Caption = "00" + "-" + "001"
        
    ElseIf IsNull(SUBRs(0)) = True Then
        frm접수.cmdTagNo.Caption = "00" + "-" + "001"
        
    ElseIf SUBRs!택번호 = "000000" Then
        frm접수.cmdTagNo.Caption = "00" + "-" + "001"
        
    Else
        strTagNo = SUBRs(0) & ""
        
        '-----------------------------------------------------------------------
        ' 신프로그램으로 변경시 앞으로 사용할 택번호가 출력되게 변경했기 때문에
        ' 기존 구프로그램은 사용한 택번호가 찍히므로 구 택번호에 판매정보가
        ' 신프로그램 처음 사용시 첫 접수자로 변경되는 것을 막기위해 추가.
        ' 2002.12.06
        '-----------------------------------------------------------------------
        ' 현재 접수일자를 확인한다.
        If Get_일일마감여부(Format(Date, "YYYY-MM-DD")) = True Then
            strDate = Format(DateAdd("d", 1, Date), "YYYY-MM-DD")
        Else
            strDate = Format(Date, "YYYY-MM-DD")
        End If
        
        SUBRs.Close
        Set SUBRs = Nothing
        
        '--------------------------------------------------------------
        '
        '--------------------------------------------------------------
        Query = "SELECT * FROM TB_입출고"
        Query = Query & " WHERE 접수일자    = '" & strDate & "'"
        Query = Query & "   AND 택번호    = '" & strTagNo & "'"
        Query = Query & "   AND 판매취소 <> 'Y' "
        Set SUBRs = New ADODB.Recordset
        SUBRs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
        
        If SUBRs.EOF Then
            frm접수.cmdTagNo.Caption = SUBRs(0) & ""
        Else
            frm접수.cmdTagNo.Caption = Get_TagNo(SUBRs(0), "+")
            
            Call TAG_Update
        End If
    End If
    
    SUBRs.Close
    Set SUBRs = Nothing
End Sub

'----------------------------------------------------------------------------------------
' 함수명 : Main
' 설  명 : 버전은 반드시 1.01.01 이런식으로 명명해줘야 한다. (업데이트 때문에...)
'
'----------------------------------------------------------------------------------------
Sub Main()
    Dim strVersion As String
    Dim InfoText   As String
    
    
    If App.PrevInstance = True Then End
    
    strVersion = Format(App.Major, "00") & "." & Format(App.Minor, "00") & "." & Format(App.Revision, "00") '
    
    If Right(App.Path, 1) = "\" Then
        AppPath = App.Path
    Else
        AppPath = App.Path & "\"
    End If

    
    iniFile = AppPath & "CleanAID.ini" ' 환경 설정 파일의 이름을 설정한다.
    m_SignFileName = AppPath & "sign.bmp"
    
    ' sql 자료 복구 내용 추가
    Call SQL_주의대상복구

    ' 업데이트 경로를 설정한다.
    Call SetIniStr("UPDATE", "URL", m_UpdateUrl, iniFile)
    
    frmUpdateCheck.Show
    frmUpdateCheck.lblVersion.Caption = "Ver " & strVersion & ""
    frmUpdateCheck.Refresh
    
    i = frmUpdateCheck.SmartUpdateX.GetInfo 'Geturl 에서 버전 정보화일을 읽어옵니다
  
    If i = 1 Then '접속 성공 - 업데이트 정보 가저옴
        InfoText = frmUpdateCheck.SmartUpdateX.GetInfoText '서버에서 가저온 IniFileName 모든 내용을 보여줍니다
     
        Open AppPath & "Update.ini" For Output As #1
    
        Print #1, InfoText
        Close #1
        
        If strVersion < frmUpdateCheck.SmartUpdateX.ReadInfo("VER", "INFO") Then
            frmUpdateCheck.lblNewVersion.Caption = "New Ver " & frmUpdateCheck.SmartUpdateX.ReadInfo("VER", "INFO") & ""
            
            ' 업데이트가 안되어서 파일을 지워버린다. 그럼 다음에 프로그램 실행할때 파일이 없기 때문에 다시 다운로드 한다.
            If Dir(App.Path & "\DataBaseCreate.exe", vbDirectory) <> "" Then
                Kill App.Path & "\DataBaseCreate.exe"
            End If
            
            
            frmUpdateCheck.DownLoadFileName = "CLEANAID.EXE"
            Call frmUpdateCheck.SmartUpdate 'CleanAID.EXE 업데이트
            DoEvents
            
'
'            frmUpdateCheck.DownLoadFileName = "AidSupportFileDown"
'            Call frmUpdateCheck.AidSupportFileDown    '파일 다운로드
'            DoEvents
'
'            frmUpdateCheck.DownLoadFileName = "DBUpdate_FileDown"
'            Call frmUpdateCheck.DBUpdate_FileDown     '파일 다운로드
'            DoEvents
'
'            frmUpdateCheck.DownLoadFileName = "DataBaseCreate_FileDown"
'            Call frmUpdateCheck.DataBaseCreate_FileDown     '파일 다운로드
'            DoEvents
'
'            ' 무엇이든 물어보세요 파일이 없을 경우
'            If frmUpdateCheck.SmartUpdateX.ReadInfo("VER", "AIDHELP") > "01.00.01" Then
''            If Dir(App.Path & "\CleanAidHelp.pdf", vbDirectory) = "" Then
'                Call frmUpdateCheck.CleanAidHelp_FileDown     '파일 다운로드
'                DoEvents
'            End If
'
'
'            ' KSNet_Dongle_Ocx 파일 다운로드
'            If Trim(GetIniStr("OCX_UPDATE", "KSNet_Dongle_20150901", "N", iniFile)) <> "Y" Then
'                Call frmUpdateCheck.FileDown_KSNet_Dongle_Ocx    '파일 다운로드
'                DoEvents
'                Call frmUpdateCheck.FileDown_KSNet_Dongle_Cab    '파일 다운로드
'                DoEvents
'            End If
        Else
        
            '원격 지원 파일이 없을 경우 다운로드 한다.
            If Dir(App.Path & "\AidSupport.exe", vbDirectory) = "" Then
                Call frmUpdateCheck.AidSupportFileDown    '파일 다운로드
                DoEvents
            End If
        
            ' 자료 전송 프로그램 파일이 없을 경우 다운로드 한다.
            If Dir(App.Path & "\DBUpdate.exe", vbDirectory) = "" Then
                Call frmUpdateCheck.DBUpdate_FileDown    '파일 다운로드
                DoEvents
            End If
            
            ' DB 생성 프로그램이 없을 경우
            If Dir(App.Path & "\DataBaseCreate.exe", vbDirectory) = "" Then
                Call frmUpdateCheck.DataBaseCreate_FileDown     '파일 다운로드
                DoEvents
            End If
        
            ' 무엇이든 물어보세요 파일이 없을 경우
            If frmUpdateCheck.SmartUpdateX.ReadInfo("VER", "AIDHELP") > "01.00.01" Then
'            If Dir(App.Path & "\CleanAidHelp.pdf", vbDirectory) = "" Then
                Call frmUpdateCheck.CleanAidHelp_FileDown     '파일 다운로드
                DoEvents
            End If
        
            Debug.Print "D: " & Now
            ' KSNet_Dongle_Ocx 파일 다운로드
'            If Trim(GetIniStr("OCX_UPDATE", "KSNet_Dongle_20150901", "N", iniFile)) <> "Y" Then
'                Call frmUpdateCheck.FileDown_KSNet_Dongle_Ocx    '파일 다운로드
'                DoEvents
'                Call frmUpdateCheck.FileDown_KSNet_Dongle_Cab     '파일 다운로드
'                DoEvents
'            End If
            If Dir(App.Path & "\KiccPosIEX.ocx") = "" Then
                Call frmUpdateCheck.Download_OCX("OCX1")
                Call frmUpdateCheck.Download_OCX("OCX2")
                Call frmUpdateCheck.Download_OCX("OCX3")
                
            End If
            
            Debug.Print "E: " & Now
            Unload frmUpdateCheck
            
            frmSplash.Show     '메세지
            frmSplash.Refresh

            Call Program_Check '
            
            Load frmLogin      '로그인
        
            Unload frmSplash
            frmLogin.Show
        End If
    Else
        Unload frmUpdateCheck
        
        frmSplash.Show     '메세지
        frmSplash.Refresh

        Call Program_Check '
        
        Load frmLogin      '로그인
    
        Unload frmSplash
        frmLogin.Show
    End If
    
    
''    frmSplash.Show     '메세지
''    frmSplash.Refresh
''
''    Call Program_Check '
''
''    Load frmLogin      '로그인
''
''    Unload frmSplash
''    frmLogin.Show
End Sub

'--------------------------------------------------------------------------------------------------------------
' 함수명 : Program_Check
' 기  능 :
'
'
'--------------------------------------------------------------------------------------------------------------
Public Sub Program_Check()
    Dim strTemp As String
        
    Call Set_ProgramVersion              ' 프로그램 버전을 설정한다.
    
    M_CompnyMasterName = Trim(GetIniStr("RUNMODE", "ProgramName", "", iniFile)) ' 프로그램명
    PROG_MODE = Trim(GetIniStr("RUNMODE", "MODE", "", iniFile))                 ' REAL or TEST
    
    If M_CompnyMasterName = "" Then
        M_CompnyMasterName = "(주)크린에이드"       '
    End If
    
    If Trim(GetIniStr("RUNMODE", "PosPrinterDelay", "", iniFile)) = "" Then
        Call SetIniStr("RUNMODE", "PosPrinterDelay", "0", iniFile)
        PosPrinterDelayTiem = 0
    
    ElseIf IsNumeric(Trim(GetIniStr("RUNMODE", "PosPrinterDelay", "", iniFile))) = True Then
        PosPrinterDelayTiem = Trim(GetIniStr("RUNMODE", "PosPrinterDelay", "", iniFile))
        If PosPrinterDelayTiem > 10 Then PosPrinterDelayTiem = 10
    Else
        Call SetIniStr("RUNMODE", "PosPrinterDelay", "0", iniFile)
        PosPrinterDelayTiem = 0
    
    End If
    
    bMsgMode = False ' 메시지 출력 여부 설정
    
    'OCX를 업그레이드 한다.
    If Trim(GetIniStr("OCX_UPDATE", "OCX_20180201", "N", iniFile)) = "N" Then
        
            ' 무조건 만든다.
        Dim HFandle As Integer
        
        HFandle = FreeFile
                
        Open App.Path & "\OCX.Bat" For Output As #HFandle
        Print #HFandle, "copy KiccEtc.dll c:\windows\system32\KiccEtc.dll"
        Print #HFandle, "copy KiccPosIEX.ocx c:\windows\system32\KiccPosIEX.ocx"
        Print #HFandle, "copy KiccV.dll c:\windows\system32\KiccV.dll"
        '
        Print #HFandle, "copy KiccEtc.dll c:\windows\SysWOW64\KiccEtc.dll"
        Print #HFandle, "copy KiccPosIEX.ocx c:\windows\SysWOW64\KiccPosIEX.ocx"
        Print #HFandle, "copy KiccV.dll c:\windows\SysWOW64\KiccV.dll"
        Print #HFandle, "regsvr32 /s c:\windows\system32\KiccPosIEX.ocx"
        Close #HFandle
        
        Call Shell("OCX.BAT ", vbNormalFocus)
    
        Call SetIniStr("OCX_UPDATE", "OCX_20180201", "Y", iniFile)
    
    End If
    
    ' DB 연결
    If DB_Connect = False Then
        frm서버.Show 1

        End
    End If
    
    ' 이전 내용 이거 사용하지 말것
    Call Database_Check(False) 'DB 컬럼 확인및 추가
    
    
    chkinputflig = "메뉴"
    
    If Get_가맹점정보 = "Error" Then
        Dim sMsg    As String
        
        sMsg = "프로그램 실행에 필요한 기초 정보가 올바르지 않습니다." + vbNewLine + vbNewLine
        sMsg = sMsg & "해당 메시지가 계속 나타날 경우 본사 전산실로 연락 바랍니다." + vbNewLine + vbNewLine
        sMsg = sMsg & "본사 전산실: 031-522-2025"

        MsgBox sMsg, vbCritical, "확인"
    
        frm환경설정.Show 1
        
        End

    End If
    
    
    Call 공지사항_Download
    
    Call 행사관련자료
    
    Exit Sub
    
ErrRtn:
    Call Delay(5)
    Resume
End Sub

Private Sub 공지사항_Download()
    
    On Error GoTo ErrRtn
        
    If Server_Connection(HostCon, "LAUNDRY1000") = False Then Exit Sub
    
    Query = "SELECT * FROM TB_공지사항"
    Query = Query & " WHERE 가맹점코드 = '" & 가맹점정보.가맹점코드 & "'"
    Query = Query & "   AND (수신여부 <> 'Y' OR 수신여부 IS NULL)"
    Query = Query & "   AND 공지구분 IN ('2','3')"
    Query = Query & " ORDER BY 작성일자 ASC"
    Set ADORs = New ADODB.Recordset
    ADORs.Open Query, HostCon, adOpenForwardOnly, adLockReadOnly
    
    Do Until ADORs.EOF
        Query = "SELECT * FROM TB_공지사항"
        Query = Query & " WHERE 가맹점코드 = '" & ADORs!가맹점코드 & "'"
        Query = Query & "   AND 공지구분   = '" & ADORs!공지구분 & "'"
        Query = Query & "   AND 작성일자   = '" & ADORs!작성일자 & "'"
        Query = Query & "   AND 문서번호   =  " & ADORs!문서번호
        Set SUBRs = New ADODB.Recordset
        SUBRs.Open Query, ADOCon, adOpenDynamic, adLockOptimistic
    
        If SUBRs.EOF Then SUBRs.AddNew
        
        SUBRs!가맹점코드 = ADORs!가맹점코드 & ""     '1
        SUBRs!공지구분 = ADORs!공지구분 & ""         '2
        SUBRs!작성일자 = ADORs!작성일자 & ""         '3
        SUBRs!문서번호 = ADORs!문서번호 & ""         '4
        SUBRs!시작일자 = ADORs!시작일자 & ""         '5
        SUBRs!종료일자 = ADORs!종료일자 & ""         '6
        SUBRs!공지내용 = ADORs!공지내용 & ""         '7
        SUBRs!수신여부 = ADORs!수신여부 & ""         '8
        SUBRs!수신일자 = ADORs!수신일자 & ""         '9
        SUBRs!파일명 = ADORs!파일명 & ""            '9
        
        SUBRs.Update
        
        SUBRs.Close
        Set SUBRs = Nothing
        
        '서버
        Query = "UPDATE TB_공지사항 SET 수신여부 = 'Y'"
        Query = Query & "             , 수신일자 = '" & Format(Now, "YYYY-MM-DD hh:mm:ss") & "'"
        Query = Query & " WHERE 가맹점코드 = '" & 가맹점정보.가맹점코드 & "'"
        Query = Query & "   AND 공지구분   = '" & ADORs!공지구분 & "'"
        Query = Query & "   AND 작성일자   = '" & ADORs!작성일자 & "'"
        Query = Query & "   AND 문서번호   =  " & ADORs!문서번호
        HostCon.Execute Query
        
        If ADORs!파일명 & "" <> "" Then Call 공지사항파일_Download(ADORs!작성일자 & "", ADORs!문서번호 & "")
        
        
        
        ADORs.MoveNext
    Loop
    ADORs.Close
    Set ADORs = Nothing
        
    HostCon.Close
    Set HostCon = Nothing

    Exit Sub
    
ErrRtn:

End Sub




Public Function DB_Connect() As Boolean
    Dim sServer   As String
    Dim sDatabase As String
    Dim sID       As String
    Dim sPWD      As String
    
    On Error GoTo ErrRtn

    sServer = Get_Decrypt(GetIniStr("DB", "SERVER", "", iniFile), "")    '
    sDatabase = Get_Decrypt(GetIniStr("DB", "DATABASE", "", iniFile), "") '
    sID = Get_Decrypt(GetIniStr("DB", "ID", "", iniFile), "")             '
    sPWD = Get_Decrypt(GetIniStr("DB", "PWD", "", iniFile), "")            '
 
    Set ADOCon = New ADODB.Connection

    With ADOCon
        .ConnectionString = "Provider=SQLOLEDB;Persist Security Info=False;User ID=" & sID & ";Password=" & sPWD & ";Initial Catalog=" & sDatabase & ";Data Source=" & sServer
        .CursorLocation = adUseClient
        .ConnectionTimeout = 10
        .CommandTimeout = 0
        .Open
    End With
   
    DB_Connect = True
   
    Exit Function
   
ErrRtn:
    DB_Connect = False
    
    Call Error_Msg("", Err.Source, Err.Number, Err.description)
End Function

Sub FormChk()
    Dim frm As Form
    
    For Each frm In Forms
        If Not (frm.Name = "frmMain" Or frm.Name = "frmBase") Then
            
            Unload frm
        End If
    Next frm
End Sub

Sub FormChkEsc()
    Dim Response As Integer
    Dim frm As Form
    
    If UCase(chkinputflig) = "메뉴" Then
        Response = MsgBox("프로그램을 종료 하시겠습니까?" & Space(10), vbInformation + vbYesNo + vbDefaultButton1, "종료 확인")
        If Response <> vbYes Then Exit Sub
        End
    End If
    
    For Each frm In Forms
        If Not (frm.Name = "frmMain" Or frm.Name = "frmBase") Then
            Unload frm
            chkinputflig = "메뉴"
        End If
    Next frm
End Sub

Public Sub TAG_Update()
    Dim 택번호 As String
    
    택번호 = frm접수.btnTagCode.Caption & Replace(frm접수.cmdTagNo.Caption, "-", "")
    
    Query = "UPDATE TB_기본정보 SET 택번호 = '" & 택번호 & "'"
    ADOCon.Execute Query
End Sub

Function KeyChk(key As Integer) As Integer
    Select Case key
        Case vbKeyF5 '입고
'            chkinputflig = "입고중" '현재 상태..
            If chkinputflig = "입고중" Then
                If Len(Get_SpreadText(frm접수.sprGrid, 1, 1)) > 0 Then
                    If MsgBox("입고 작업을 취소 하시겠습니까?", vbInformation + vbYesNo, "종료 확인") <> vbYes Then
                        Exit Function
                    End If
                End If
            End If
            
            Call FormChk
            
            chkInputKey = True
            frm접수.SetFocus
            
            'If chkDaySale = True Then
            '   'TitleSet SET_TITLE_INPUT & "(목요SALE)"
            'Else
            '   'TitleSet SET_TITLE_INPUT
            'End If
        
        Case vbKeyF6 '출고
'            chkinputflig = "출고중" '현재 상태..
            If chkinputflig = "입고중" Then
                If Len(Get_SpreadText(frm접수.sprGrid, 1, 1)) > 0 Then
                    If MsgBox("입고 작업을 취소 하시겠습니까?", vbInformation + vbYesNo, "종료 확인") <> vbYes Then
                        Exit Function
                    End If
                End If
            End If
            
            Call FormChk
            
            frm출고.SetFocus
            'TitleSet SET_TITLE_OUTPUT
        
        Case vbKeyF7 '조회
        Case vbKeyF8 '조회
        
        Case vbKeyEscape '종료
            'TitleSet SET_TITLE_EXIT
                    
            If chkinputflig = "입고중" Then
                If Len(Get_SpreadText(frm접수.sprGrid, 1, 1)) > 0 Then
                    If MsgBox("입고 작업을 취소 하시겠습니까?     ", vbInformation + vbYesNo, "종료 확인") <> vbYes Then
                        Exit Function
                    End If
                End If
            End If

'            If TypeName(frmMain.ActiveForm) = "frm접수" Then
'                If MsgBox("입고 프로그램을 끝내시겠습니까?", vbYesNo) = vbNo Then
'                    chkinputflig = "입고중"
'                   Exit Function
'                End If
'            End If
                
            FormChkEsc
            
''            frmMain.Command1(1).Enabled = True
''            frmMain.Command1(0).Enabled = True
''            frmMain.Command1(2).Enabled = True
''
''            ' 서버모드가 아닐경우 입고를 할 수 없게 한다.
''            If chkProgramMode <> ServerMode Then frmMain.Command1(1).Enabled = False
    End Select
End Function

Public Function GetIniStr(SectionName As String, LineName As String, defValue As String, iniFile As String) As String
    Dim retStr As String * 256
    Dim result As Integer
    
    result = GetPrivateProfileString(SectionName, LineName, defValue, retStr, Len(retStr), iniFile)
    
    GetIniStr = Replace(Left(retStr, result), Chr(0), "")
End Function

Public Function SetIniStr(SectionName As String, LineName As String, defValue As String, iniFile As String) As String
    Dim result As Integer
    
    result = WritePrivateProfileString(SectionName, LineName, defValue, iniFile)
End Function

'+------------------------------------------------------
'+
'+ 2002/11/22
'+
'+루틴설명
'+  1. 택번호를 전달받아 입출고에 있을경우 Ture 를 리턴한다
'+------------------------------------------------------
Public Function TagNoCheck(sTagNo As String) As Boolean
    Query = "Select 택번호 "
    Query = Query & " FROM TB_입출고 "
    Query = Query & " Where 택번호 = '" & sTagNo & "' "
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    If Not SUBRs.EOF Then
        If SUBRs!택번호 = sTagNo Then
            TagNoCheck = True
        Else
            TagNoCheck = False
        End If
    Else
        TagNoCheck = False
    End If
    
    SUBRs.Close
    Set SUBRs = Nothing
End Function

'+------------------------------------------------------
'+ 함수명 : Get_일일마감여부
'+ 일  자 : 2002/11/17
'+ 설  명 :
'+  1. 전달 날짜가 마감 처리 되었는지 확인한다.
'+  2. 리턴값 =>    마감되었으면 : True
'+                  미마감시     : False
'+------------------------------------------------------
Public Function Get_일일마감여부(sDate As String) As Boolean
    Query = "SELECT 마감여부 FROM TB_일일마감 "
    Query = Query & " WHERE 마감일자 = '" & sDate & "'"
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly

    If SUBRs.EOF Then
        Get_일일마감여부 = False
    Else
        If SUBRs!마감여부 = "Y" Then
            Get_일일마감여부 = True
        Else
            Get_일일마감여부 = False
        End If
    End If
    SUBRs.Close
    Set SUBRs = Nothing
End Function

'+------------------------------------------------------
'+
'+ 2002/11/17
'+
'+루틴설명
'+  1. 정보를 전역번수에 저장한다.
'+  2. 가맹점정보을 검색하지 못한경우 'Error'값을 넘긴다.
'+------------------------------------------------------
Public Function Get_가맹점정보() As String
    On Error GoTo ErrRtn
    
    '-------------------------------------------------------
    ' 가맹점 코드를 Check한다.
    '-------------------------------------------------------
    Query = "SELECT * FROM TB_기본정보"
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
    
    ' 가맹점코드가 없으면 종료를 한다.
    If SUBRs.EOF Then
        Get_가맹점정보 = "Error"
        MsgBox "등록된 가맹점 정보가 없습니다.", vbCritical, "오류"
    Else
        가맹점정보.지사코드 = SUBRs!지사코드 & ""       '
        가맹점정보.가맹점코드 = SUBRs!가맹점코드 & ""   '
        가맹점정보.가맹점명 = Trim(SUBRs!가맹점명 & "") '
        가맹점정보.적용일자 = Trim(SUBRs!적용일자 & "") '
    
        가맹점정보.택코드 = SUBRs!택코드 & ""           '
        가맹점정보.택색상 = SUBRs!택색상 & ""           '
        가맹점정보.요일할인 = SUBRs!요일할인 & ""       '
        
        If IsNull(SUBRs!세트상품세일) Or Trim(SUBRs!세트상품세일) = "" Then
            가맹점정보.세트상품세일 = "0000000"               '
        Else
            가맹점정보.세트상품세일 = SUBRs!세트상품세일 & "" '
        End If
        
        가맹점정보.비율 = 60
        '가맹점정보.수선 = SUBRs!수선 & ""
        '가맹점정보.수선마진 = SUBRs!수선마진 & ""
        '가맹점정보.운동화마진 = SUBRs!운동화마진 & ""
        '가맹점정보.가죽무스탕마진 = SUBRs!가죽무스탕마진 & ""
        '가맹점정보.카페트마진 = SUBRs!카페트마진 & ""
        '가맹점정보.외주마진 = SUBRs!외주마진 & ""
        '가맹점정보.일수 = SUBRs!일수 & ""
        '가맹점정보.전화1 = SUBRs!전화1 & ""
        '가맹점정보.전화2 = SUBRs!전화2 & ""
        '가맹점정보.프린터 = SUBRs!프린터 & ""
        
        '가맹점정보.마일리지증가구분 = SUBRs!마일리지증가구분 & ""
                
        가맹점정보.세탁소요일 = SUBRs!세탁소요일 & "" '
        가맹점정보.전화매장 = Trim(SUBRs!매장전화번호) & "" '
        가맹점정보.전화SMS = Trim(SUBRs!문자발신전화) & ""  '
        가맹점정보.택번호 = SUBRs!택번호 & ""               '
        가맹점정보.마일리지여부 = SUBRs!마일리지여부 & ""   '
        가맹점정보.기준금액 = SUBRs!기준금액 & ""           '
        가맹점정보.적립마일리지 = SUBRs!적립마일리지 & ""   '
        
        ' 본사 가맹점 정보에서 1,000으로 수정 하였기 때문에. 일부 필요한 매장을 변경하여 적용될수 있도록 다시 설정 한다.
        가맹점정보.최소마일리지 = SUBRs!최소마일리지 & ""
        
'        If Format(Date, "yyyy-MM-dd") >= "2013-11-01" And 가맹점정보.지사코드 <> "1024" Then
'            가맹점정보.최소마일리지 = 1000  '2013-11-01일부로 최소 마일리지 1,000원으로 변경
'        Else
'            가맹점정보.최소마일리지 = SUBRs!최소마일리지 & ""
'        End If
        
        가맹점정보.지정할인여부 = SUBRs!지정할인여부 & ""   '
        가맹점정보.지정할인비율 = SUBRs!지정할인비율 & ""   '
        
        If 가맹점정보.지정할인여부 = "Y" Then
            If SUBRs!지정할인시작일 & "" <= Format(Date, "YYYY-MM-DD") And SUBRs!지정할인종료일 & "" >= Format(Date, "YYYY-MM-DD") Then
                가맹점정보.지정할인여부 = "Y"
            Else
                가맹점정보.지정할인여부 = "N"
            End If
        End If
        
        가맹점정보.특정할인여부 = SUBRs!특정할인여부 & ""
        가맹점정보.특정할인비율 = SUBRs!특정할인비율 & ""
        
        If 가맹점정보.특정할인여부 = "Y" Then
            If SUBRs!특정할인시작일 & "" <= Format(Date, "YYYY-MM-DD") And SUBRs!특정할인종료일 & "" >= Format(Date, "YYYY-MM-DD") Then
                가맹점정보.특정할인여부 = "Y"
            Else
                가맹점정보.특정할인여부 = "N"
            End If
        End If
        
        가맹점정보.고가세탁비율 = SUBRs!고가세탁비율 & ""
        가맹점정보.세탁환불여부 = SUBRs!세탁환불여부 & ""
        가맹점정보.전화번호출력 = GetIniStr("Printer", "TelPrint", "Y", iniFile)
        가맹점정보.가맹점카드영수증출력YN = GetIniStr("Printer", "CardStorePrint", "Y", iniFile)
        
        가맹점정보.CAT단말기종류 = GetIniStr("VAN", "KSCAT_GUBUN", "", iniFile) '
        ' 단말기 종류를 설정한다.(없을 경우 초기값으로 설정)
        If 가맹점정보.CAT단말기종류 = "" Then 가맹점정보.CAT단말기종류 = "KS7500i, KS7050i"
        
        가맹점정보.SMS_EMART = SUBRs!SMS_EMART & ""
        
        가맹점정보.SMS_사고품 = "Y"
        
' 1차 행사 기간
'        If Format(Date, "YYYY-MM-DD") >= "20090915" And Format(Date, "YYYY-MM-DD") <= "20091031" Then
' 2차 행사 기간
        
        If Format(Date, "YYYY-MM-DD") >= "20091115" And Format(Date, "YYYY-MM-DD") <= "20091231" Then
            가맹점정보.삼성카드할인여부 = "Y"
            가맹점정보.삼성카드할인비율 = "10"
        Else
            가맹점정보.삼성카드할인여부 = "N"
            가맹점정보.삼성카드할인비율 = "0"
        End If
        
        
        'SMS 서버 정보 확인
        m_SMS.ServerIP = IIf(SUBRs!SMS_IP & "" = "", "115.89.220.5,8657", SUBRs!SMS_IP & "")
        m_SMS.DBName = IIf(SUBRs!SMS_DB & "" = "", "Laundry1000", SUBRs!SMS_DB & "")
        m_SMS.UserID = IIf(SUBRs!SMS_ID & "" = "", "sa", SUBRs!SMS_ID & "")
        m_SMS.UserPW = IIf(SUBRs!SMS_PWD & "" = "", "cleanaid1996!@#", SUBRs!SMS_PWD & "")
        m_SMS.timeout = IIf(SUBRs!timeout & "" = "", 30, Val(SUBRs!timeout & ""))
        
        가맹점정보.DualComputer = GetIniStr("DB", "DualComputer", "N", iniFile)
        
        가맹점정보.로열티여부1 = IIf(UCase(SUBRs!로열티여부1 & "") = "Y", "Y", "N")
        가맹점정보.로열티여부2 = IIf(UCase(SUBRs!로열티여부2 & "") = "Y", "Y", "N")
        가맹점정보.수수료지원여부 = IIf(UCase(SUBRs!수수료지원여부 & "") = "Y", "Y", "N")
        가맹점정보.로열티비율1 = SUBRs!로열티비율1 & ""
        가맹점정보.로열티비율2 = SUBRs!로열티비율2 & ""
        가맹점정보.수수료지원비율 = SUBRs!수수료지원비율 & ""
    
        가맹점정보.PG사용종료일 = SUBRs!PG사용종료일 & ""
        가맹점정보.가맹점상태 = SUBRs!가맹점상태 & ""
        
    
    End If
    SUBRs.Close
    Set SUBRs = Nothing
    
    Exit Function
    
ErrRtn:
    Get_가맹점정보 = "Error"
    
    Query = "DB 정보가 올바르지 않습니다. 전산실에 문의 하여 주시기 바랍니다. "
    
    Call MsgBox(Query, vbCritical, "DB 변경 확인")

End Function

'+------------------------------------------------------
'+
'+ 2002/11/17
'+
'+루틴설명
'+  1. 고객정보를 전역번수에 저장한다.
'+  2. 고객정보을 검색하지 못한경우 'Error'값을 넘긴다.
'+------------------------------------------------------
Public Function Get_고객정보(고객코드 As String) As String
    On Error GoTo ErrRtn
    
    '--------------------------------------------------------
    ' 가맹점 코드를 Check한다.
    '--------------------------------------------------------
    Query = "SELECT    고객코드"
    Query = Query & ", 성명"
    Query = Query & ", 전화번호"
    Query = Query & ", 주소"
    Query = Query & ", ISNULL(미수금액,0) AS 미수금액"
    Query = Query & ", 본사전송여부"
    Query = Query & ", 카드번호"
    Query = Query & ", 휴대전화"
    Query = Query & ", 문자발송여부"
    Query = Query & ", 등록일자"
    Query = Query & ", 메모"
    Query = Query & ", ISNULL(고객등급코드,'C')   AS 고객등급코드"
    Query = Query & ", ISNULL(이용횟수,0)         AS 이용횟수"
    Query = Query & ", ISNULL(총접수금액,0)       AS 총접수금액"
    Query = Query & ", ISNULL(누적마일리지,0)     AS 누적마일리지"
    Query = Query & ", ISNULL(사용가능마일리지,0) AS 사용가능마일리지"
    Query = Query & " FROM TB_고객정보"
    Query = Query & " WHERE 고객코드 = '" & 고객코드 & "'"
    Set Rs = New ADODB.Recordset
    Rs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
        
    If Rs.EOF Then
        Get_고객정보 = "Error"
        
        고객정보.전화번호 = "Error"
    Else
        고객정보.고객코드 = Trim(Rs!고객코드) & ""                 ' 1
        고객정보.성명 = Trim(Rs!성명) & ""                         ' 2
        고객정보.전화번호 = Trim(Rs!전화번호) & ""                 ' 3
        고객정보.휴대전화 = Trim(Rs!휴대전화) & ""                 ' 4
        고객정보.주소 = Trim(Rs!주소) & ""                         ' 5
        고객정보.미수금액 = Rs!미수금액 & ""                       ' 6
        고객정보.본사전송여부 = Trim(Rs!본사전송여부) & ""         ' 7
        고객정보.카드번호 = Trim(Rs!카드번호) & ""                 ' 8
        고객정보.SMS전송여부 = Rs!문자발송여부 & ""                ' 9
        고객정보.등록일자 = Format(Rs!등록일자, "YYYY-MM-DD") & "" '10
        고객정보.메모 = Trim(Rs!메모) & ""                         '11
        
        If Rs!고객등급코드 = "" Then
            고객정보.고객등급 = "C"                                '12
        Else
            고객정보.고객등급 = Rs!고객등급코드 & ""               '12
        End If
        
        고객정보.이용횟수 = Rs!이용횟수 & ""                       '13
        고객정보.총접수금액 = Rs!총접수금액 & ""                   '14
        고객정보.누적마일리지 = Rs!누적마일리지 & ""               '15
        고객정보.사용가능마일리지 = Rs!사용가능마일리지 & ""       '16
    End If
    Rs.Close
    Set Rs = Nothing
    
    Exit Function
    
ErrRtn:
    Get_고객정보 = "Error"
    
    Call Error_Msg("", Err.Source, Err.Number, Err.description)
End Function

'+------------------------------------------------------
'+
'+ 2002/11/17
'+
'+루틴설명
'+  1. tempDate의 일자의 마감 정보를 전역번수에 저장한다
'+  2. 마감여부를 검색하지 못한경우 'Error'값을 넘긴다.
'+------------------------------------------------------
Public Function Fun_일일마감정보(tempDate As String) As String
    On Error GoTo ErrRtn
    
    If IsDate(tempDate) = False Then
        MsgBox "Fun_일일마감정보 함수에 전달된 날짜를 확인 하십시요.", vbExclamation, "오류"
        Fun_일일마감정보 = "Error"
        
        Exit Function
    End If
        
    
    'Query = "SELECT * FROM TB_일일마감 "
    'Query = Query & " WHERE 마감일자 = '" & tempDate & "'"
    
    ' 가맹점 코드를 Check한다.
    'Set SUBRs = MyDB.OpenRecordset("Select * FROM TB_일일마감")
    
    Query = "SELECT * FROM TB_일일마감 "
    Query = Query & " WHERE 마감일자 = '" & tempDate & "'"
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    ' 가맹점코드가 없으면 종료를 한다.
    If Not SUBRs.EOF Then
        일일마감정보.마감일자 = SUBRs!마감일자
        일일마감정보.접수수량 = SUBRs!접수수량
        일일마감정보.반품수량 = SUBRs!반품수량
        일일마감정보.재세탁수량 = SUBRs!재세탁수량
        일일마감정보.수선수량 = SUBRs!수선수량
        일일마감정보.접수금액 = SUBRs!접수금액
        일일마감정보.본사금액 = SUBRs!본사금액
        일일마감정보.가맹점금액 = SUBRs!가맹점금액
        일일마감정보.수선금액 = SUBRs!수선금액
        일일마감정보.판매구분 = SUBRs!판매구분
        일일마감정보.시작택 = SUBRs!시작택
        일일마감정보.종료택 = SUBRs!종료택
        일일마감정보.마감여부 = SUBRs!마감여부
        일일마감정보.본사전송여부 = SUBRs!본사전송여부
    Else
        Fun_일일마감정보 = "Error"
        MsgBox "등록된 가맹점 정보가 없습니다.", vbExclamation, "오류"
    End If
    
    SUBRs.Close
    Set SUBRs = Nothing
    
    Exit Function
    
ErrRtn:
    Fun_일일마감정보 = "Error"
    MsgBox Err.Number & "->" & Err.description, vbInformation, "Error"
End Function
 
'+------------------------------------------------------
'+
'+ 2002/11/16
'+
'+루틴설명
'+  1. 고객코드를 가져 오기 위한 루틴
'+     TempName = 고객성명
'+     TempTel1 = 고객전화번호 중 국번
'+     TempTel2 = 고객전화번호 중 나머지 4자리
'+  2. 고객코드를 검색하지 못한경우 'Error'값을 넘긴다.
'+------------------------------------------------------
Public Function Fun_고객코드(tempName As String, TempTel As String) As String
    On Error GoTo ErrRtn
    
    Query = "SELECT * FROM TB_고객정보 "
    Query = Query & " WHERE 성명     = '" & tempName & "' "
    Query = Query & "   AND 전화번호 = '" & TempTel & "' "
    Set Rs = New ADODB.Recordset
    Rs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
    
    If Rs.EOF Then
        Fun_고객코드 = "Error"
    Else
        Fun_고객코드 = Rs!고객코드
    End If
    Rs.Close
    Set Rs = Nothing
    
    Exit Function
    
ErrRtn:
    Fun_고객코드 = "Error"
    
    MsgBox Err.Number & "->" & Err.description, vbInformation, "Error"
End Function

'+------------------------------------------------------
'+
'+ 2005/10/31
'+
'+루틴설명
'+  1. 해당 고객의 해당일자 수금액을 리턴한다.
'+     sCode = 고객코드
'+     sDate = 일자
'+------------------------------------------------------
Public Function Fun_수금액(sCode As String, sDate As String) As Double
    On Error GoTo ErrRtn
    
    'Query = "SELECT ISNULL(SUM(금액),0) AS 수금액 "
    'Query = Query & " FROM TB_미수회수정보 "
    'Query = Query & " WHERE 일자     = '" & sDate & "' "
    'Query = Query & "   AND 고객코드 = '" & sCode & "' "
    
    Query = "SELECT ISNULL(SUM(입금합계),0) AS 수금액"
    Query = Query & " FROM TB_매출"
    Query = Query & " WHERE 매출일자 = '" & sDate & "'"
    Query = Query & "   AND 고객코드 = '" & sCode & "'"
    Set Rs = New ADODB.Recordset
    Rs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
    
    If Rs.EOF Then
        Fun_수금액 = 0
    Else
        Fun_수금액 = Rs!수금액 & ""
    End If
    Rs.Close
    Set Rs = Nothing
    
    Exit Function
    
ErrRtn:
    Fun_수금액 = 0
    
    MsgBox Err.Number & "->" & Err.description, vbInformation, "Error"
End Function

    
Public Sub FpSpreedText(tempSp As Object, SpRow As Long, SpCol As Long, TempText As Variant)
'+------------------------------------------------------
'+
'+ 2002/12/03
'+
'+루틴설명
'+  1. 전달된 spreed에 문자를 기록한다
'+------------------------------------------------------
    Dim nCol As Integer
    Dim nRow As Integer
    
    With tempSp
        nCol = .ActiveCol
        nRow = .ActiveRow
        .Col = SpCol
        .Row = SpRow
        .Text = TempText & ""
        .Col = nCol
        .Row = nRow
    End With
End Sub

'+------------------------------------------------------
'+
'+ 2002/12/03
'+
'+루틴설명
'+  1. 원하는 위치의 문자를 리턴한다
'+------------------------------------------------------
Public Function Get_SpreadText(tempSp As Object, SpRow As Long, SpCol As Long) As Variant
    Dim nCol As Integer
    Dim nRow As Integer
    
    nCol = tempSp.ActiveCol
    nRow = tempSp.ActiveRow
    
    If nCol < 1 Or nCol > tempSp.MaxCols Then nCol = tempSp.MaxCols
    If nRow < 1 Or nRow > tempSp.MaxRows Then nRow = tempSp.MaxRows
    
    tempSp.Row = SpRow
    tempSp.Col = SpCol: Get_SpreadText = tempSp.Text
    
    tempSp.Row = nRow
    tempSp.Col = nCol
End Function

'+------------------------------------------------------
'+
'+ 2003/01/16
'+
'+루틴설명
'+  1. 전달된 Spread의 마지막 데이타의  다음 위치를 리턴한다
'+------------------------------------------------------
Public Function GetSpreadLine(tempSp As Object) As Integer
    Dim nCol As Integer
    Dim nRow As Integer
    
    nCol = tempSp.ActiveCol ' 이전 위치 보관
    nRow = tempSp.ActiveRow
    
    If nCol < 1 Or nCol > tempSp.MaxCols Then nCol = tempSp.MaxCols
    If nRow < 1 Or nRow > tempSp.MaxRows Then nRow = tempSp.MaxRows
    
    tempSp.Col = 1
    For i = 1 To tempSp.MaxRows
        tempSp.Row = i
        
        If Trim(tempSp.Text) = "" Then
            Exit For
        End If
    Next i
    
    tempSp.Col = nCol ' 이전 위치 설정
    tempSp.Row = nRow
    
    GetSpreadLine = i
End Function

Public Sub MoveWindow(myForm As Form)
    myForm.Top = (Screen.Height - myForm.Height) / 2
    myForm.Left = (Screen.Width - myForm.Width) / 2
End Sub

Public Function ShowFolderSize(filespec) As Double
    Dim fs, f
    
    Set fs = CreateObject("Scripting.FileSystemObject")
    Set f = fs.GetFile(filespec)
    ShowFolderSize = f.Size
End Function

'+-------------------------------------------------------------------------
'+
'+ 2003/01/21
'+
'+루틴설명
'+
'+  1. strTag로 전달된 택번호를 가지고  mode에 맞게 증가 하거나 감소한다.
'+     증가나 감소한경우 그택이 판매 취소된것인지 확인한다.
'+     중간택을 삭제한 경우 다음택번호가 사라지는 것을 방지하기 위하여
'+     다음택 사용여부 확인하여 사용중이면 그 다음 택번호증가
'+  2. Mode 값이 "R"일 경우 택 번호 Check를 무시한다.
'+  3. 전달값
'+     strTag :   "1-234"   5자리 전달
'+     Mode   :   "R"       DB에서 새로 읽는다.
'+     Mode   :   "+"       택번호를 1 증가한다
'+     Mode   :   "-"       택번호를 1 감소한다
'+
'+-------------------------------------------------------------------------
Public Function Get_TagNo(strTag As String, Mode As String) As String
    On Error GoTo ErrRtn
    
    Dim bTagDayCheck  As Boolean
    Dim bTagFormCheck As Boolean
    Dim TagNum        As String
    
    ' 전달된 Mode  검사
    If Len(Mode) <> 1 And Not (Mode = "+" Or Mode = "-") Then
        MsgBox " 전달된 Mode가 올바르지 않습니다.", "택번호 오류"
        
        Exit Function
    End If
    
    ' DB에 저장된 택번호를 읽는다.
    Select Case Mode
        Case "R"
            Query = "SELECT 택번호 FROM TB_기본정보"
            Set SUBRs = New ADODB.Recordset
            SUBRs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
            
            If SUBRs.EOF Then
                SUBRs.Close
                Set SUBRs = Nothing
                
                TagNum = "01" + "-" + "0001"
                
                frm접수.cmdTagNo.Caption = TagNum
                
                Get_TagNo = TagNum
                
                Exit Function
                
            ElseIf IsNull(SUBRs(0)) = True Then
                SUBRs.Close
                Set SUBRs = Nothing
                
                TagNum = "01" + "-" + "0001"
                
                frm접수.cmdTagNo.Caption = TagNum
                
                Get_TagNo = TagNum
                
                Exit Function
            Else
                TagNum = Mid(SUBRs(0), 4, 2) & "-" & Mid(SUBRs(0), 6, 4)
                
                SUBRs.Close
                Set SUBRs = Nothing
                
                Get_TagNo = TagNum
                
                Exit Function
            End If
    End Select
    
    ' 전달된 택 번호 검사
    If Not IsTagNo(strTag) Then
        MsgBox " 전달된 택번호가 올바르지 않습니다. ", vbInformation, "택번호 오류"
        Exit Function
    End If

    bTagDayCheck = False
    bTagFormCheck = False
    
    Do
        bTagDayCheck = DayTagchk(strTag)                     ' DB에서 오늘 사용한 것을 확인 (같은 번호가 있을 경우 False 리턴)
        
        If bTagDayCheck = True Then                          ' 접수 그리드에서 사용한 것을 확인 (같은 번호가 있을 경우 False 리턴)
            bTagFormCheck = TAG_Check(strTag)
        End If
        
        If bTagDayCheck = True And bTagFormCheck = True Then ' DB 및 접수 그리드에 없을 경우 해당 택번호를 사용한다.
            Exit Do
        End If
        
        strTag = Get_ChangeTagNo(strTag, Mode)            ' 어느 한굿이라도 사용중일 경우 택번호를 증가한다.
    Loop
    
    Get_TagNo = strTag
    
    Exit Function
    
ErrRtn:
    Call Error_Msg("", Err.Source, Err.Number, Err.description)

    Screen.MousePointer = 0
End Function

'--------------------------------------------------------------------------------------------------------------
' Procedure : Get_ChangeTagNo
' DateTime  : 2006-10-13 14:15
' Author    : pds2004
' Purpose   : 전달된 택번호의 다음이나 이전을 무조건 리턴한다
'--------------------------------------------------------------------------------------------------------------
Public Function Get_ChangeTagNo(ByVal sTag As String, ByVal Mode As String) As String
    Dim TagNo As String
    
    Get_ChangeTagNo = ""
    
    TagNo = Replace(sTag, "-", "") '
    
    Select Case Mode
        Case "+"
            If TagNo = "999999" Then
                TagNo = "000000"
            Else
                TagNo = Format(Val(TagNo) + 1, "000000")
            End If
            
            Get_ChangeTagNo = Format(TagNo, "00-0000")
            
            Exit Function
            
        Case "-"
            If TagNo = "000000" Then
                TagNo = "999999"
            Else
                TagNo = Format(Val(TagNo) - 1, "000000")
            End If
            
            Get_ChangeTagNo = Format(TagNo, "00-0000")
            
            Exit Function
        
        Case Else
            MsgBox " 전달된 Mode가 올바르지 않습니다.", "택번호 오류"
            
            Exit Function
    End Select
End Function

'+------------------------------------------------------
'+
'+ 2003/01/22
'+
'+루틴설명
'+  1. strTag로 전달된 택번호를 택 번호 규격인지를 검사한다.
'+  2. 전달값
'+     strTag :   "1-234"   5자리 전달
'+  3. 리턴값
'+     True :       택 번호 규격에 맞을 경우
'+     Falss:       택 번호 규격에 맞지 않을 경우
'+
'+------------------------------------------------------
Public Function IsTagNo(strTag) As Boolean
    Dim bTag As Boolean

    bTag = True
    
    If Len(strTag) <> 7 Or Mid(strTag, 3, 1) <> "-" Then
        bTag = False
    End If
    
    IsTagNo = bTag
End Function

'+------------------------------------------------------
'+
'+ 2003/02/03
'+
'+루틴설명
'+  1. strPass로 전달된 비밀번호의 유효성을 검사한다
'+  2. 전달값
'+     strPass :   "05????????????"   앞 2자리는 유효 일자
'+                                       2자리 다음은 비빌번호
'+                                       ( 일자 * 1544 )
'+  3. 리턴값
'+     "OK" 정상
'+     -1 :         임의 수정한 경우
'+     -3 :         입력한 내용이 틀린 경우
'+
'+------------------------------------------------------
Public Function IsCodePassWord(strPass) As String
    If IsNumeric(strPass) = False Then
        MsgBox "전달된 본사확인코드의 형식이 정확하지 않습니다.", vbInformation, "입력오류"
        IsCodePassWord = "-1"
        Exit Function
    End If
    
    ' 일자 * 1544
    If Val(Format(Date, "dd")) * 2025 = CStr(strPass) Then
        IsCodePassWord = "OK"
    Else
        IsCodePassWord = "-3"
    End If
End Function

'+------------------------------------------------------
'+
'+ 2003/02/03
'+
'+루틴설명
'+  1. IsPricPassWord 전달된 비밀번호의 유효성을 검사한다
'+  2. 전달값
'+     strPass :    전달된 확인 번호
'+     strTag  :    전달된 고객코드 ( 승인 고객코드 )
'+  3. 리턴값
'+     "-1"    :    오류 값
'+     -3 :         입력한 내용이 틀린 경우
'+     "고객코드":    허가받은 고객코드를 리턴한다.
'+------------------------------------------------------
Public Function IsServicePassWord(strPass As String, strMCode As String) As String
    Dim nday    As Double
    Dim dPass   As Double
    Dim strTemp As String

    If Len(strMCode) <= 0 Then
        MsgBox "전달된 고객코드 형식이 정확하지 않습니다.", vbInformation, "입력오류"
        IsServicePassWord = "-1"
        Exit Function
    End If
    
    strTemp = Trim(strMCode)
    
    ' 오늘의 일자를 구한다.
    nday = Format(Date, "dd")
    dPass = Left(Format(nday * Val(strTemp) * 1544, "@@@@@@@@"), 8)
    
    If Val(strPass) = dPass Then
        IsServicePassWord = strMCode
    Else
        IsServicePassWord = "-3"
    End If
End Function

'+------------------------------------------------------
'+
'+ 2003/02/03
'+
'+루틴설명
'+  1. IsPricPassWord 전달된 비밀번호의 유효성을 검사한다
'+  2. 전달값
'+     strPass :    전달된 확인 번호
'+     strTag  :    전달된 택번호 ( 승인 택번호 )
'+  3. 리턴값
'+     "-1"    :    오류 값
'+     -3 :         입력한 내용이 틀린 경우
'+     "택번호":    허가받은 택번호를 리턴한다.
'+------------------------------------------------------
Public Function IsPricPassWord(strPass As String, strTag As String) As String
    Dim nday    As Double
    Dim dPass   As Double
    Dim strTemp As String

    If Not IsTagNo(strTag) Then
        MsgBox "전달된 택번호 형식이 정확하지 않습니다.", vbInformation, "입력오류"
        IsPricPassWord = "-1"
        Exit Function
    End If
    
    strTemp = Mid(strTag, 3, Len(strTag))
    
    ' 오늘의 일자를 구한다.
    nday = Format(Date, "dd")
    dPass = nday * Val(strTemp) * 1544
    
    If Val(strPass) = dPass Then
        IsPricPassWord = strTag
    Else
        IsPricPassWord = "-3"
    End If
End Function

'+------------------------------------------------------
'+
'+ 2003/02/03
'+
'+루틴설명
'+  1. strPass로 전달된 비밀번호의 유효성을 검사한다
'+  2. 전달값
'+     strPass :   "05????????????"   앞 2자리는 유효 일자
'+                                       2자리 다음은 비빌번호
'+                                       ( 일자 * 365 * 7079 )
'+  3. 리턴값
'+     앞 2자리를 리턴한다. ( 사용기간 )
'+     -1 :         임의 수정한 경우
'+     -3 :         입력한 내용이 틀린 경우
'+
'+------------------------------------------------------
Public Function IsPassWord(strPass) As String
    Dim nday    As Double
    Dim dPass   As Double
    Dim strTemp As String

    If Mid(strPass, 1, 1) < "0" Or Mid(strPass, 1, 1) > "9" Or Mid(strPass, 2, 1) < "0" Or Mid(strPass, 2, 1) > "9" Then
        MsgBox "전달된 본사확인코드의 형식이 정확하지 않습니다.", vbInformation, "입력오류"
        IsPassWord = "-1"
        Exit Function
    End If
    
    strTemp = Mid(strPass, 3, Len(strPass) - 2)
    
    ' 오늘의 일자를 구한다.
    nday = Format(Date, "dd")
    dPass = nday * Val(Format(Date, "mm")) * 7079
    
    If strTemp = dPass Then
        IsPassWord = Mid(strPass, 1, 2)
    Else
        IsPassWord = "-3"
    End If
    
End Function

'+------------------------------------------------------
'+
'+ 2003/02/03
'+
'+루틴설명
'+  1. 레지스터리의 PassWord저장 내용 임의 변경을 확인한다.
'+  2. 리턴값
'+     -1 :         임의 수정한 경우
'+     -2 :         유효 기간이 만료된 경우
'+     -3 :         입력한 내용이 틀린 경우
'+     일자 :       완료 일자를 리턴한다.
'+
'+------------------------------------------------------
Public Function IsPassREGRead() As String
    Dim strPass As String
    Dim strtemp1 As String
    Dim strtemp2 As String
    Dim strtemp3 As String

'----------------------------------------------------------------------------------------
' 개발자에게 짜증나기 때문에 개발자는 화면이 안뜨도록 하기 위하여 다음 5중을 추가한다.
    If GetSetting("Laundry_Zi", "PassWord", "Administrator", strtemp1) = "ALL" Then
' Administrator 코드 저장
' SaveSetting "Laundry_Zi", "PassWord", "Administrator", "ALL"
        IsPassREGRead = ""
        Exit Function
    End If
'----------------------------------------------------------------------------------------
   
    strtemp1 = GetSetting("Laundry_Zi", "PassWord", "PassVal1", strtemp1)
    strtemp2 = GetSetting("Laundry_Zi", "PassWord", "PassVal2", strtemp2)
    strtemp3 = GetSetting("Laundry_Zi", "PassWord", "PassVal3", strtemp3)
    
    If Len(strtemp1) <= 0 Or Len(strtemp2) <= 0 Or Len(strtemp3) <= 0 Then
        IsPassREGRead = "-1"
        
        Exit Function
    End If

    strPass = Mid(strtemp1, 1, 2)
    
    ' 일자 확인
    If strPass < "00" And strPass > "99" Then
        IsPassREGRead = "-1"
        
        Exit Function
    End If
        
    strtemp2 = Val(strtemp2) / Val(Format(Date, "mm")) / 12                    ' 시작 일자를 확인한다.
    
    strPass = Mid(strtemp1, 3, Len(strtemp1)) / Val(Format(Date, "mm")) / 7079 '1544' 저장비밀번호에서 시작일을 구한다.
    
    If strPass <> strtemp2 Then
        IsPassREGRead = "-1"
        
        Exit Function
    Else
        '확인코드의 유효 기간을 확인한다.
        strtemp3 = Val(strtemp3) / Val(Format(Date, "mm")) / 12
        
        If strtemp3 > Format(Date, "YYYY-MM-DD") Then
            IsPassREGRead = strtemp3
            
            Exit Function
        Else
            IsPassREGRead = "-2"
        End If
    End If
End Function

'+------------------------------------------------------
'+
'+ 2003/02/03
'+
'+루틴설명
'+  temp1 : 유효 일자
'+  temp2 : 비밀번호
'+  1. 레지스터리에 PassWord의 내용을 저장한다.
'+  2. 리턴값
'+     True :       정상인 경우
'+     Falss:       저장 오류인 경우
'+
'+------------------------------------------------------
Public Function IsPassREGSave(temp1 As String) As Boolean
    Dim strTemp As String

    If Mid(temp1, 1, 2) < "00" Or Mid(temp1, 1, 2) > "99" Then
        MsgBox "전달된 비밀번호 형식이 정확하지 않습니다.", vbInformation, "입력오류"
        IsPassREGSave = False
        Exit Function
    End If
    
    ' 확인코드 저장
    SaveSetting "Laundry_Zi", "PassWord", "PassVal1", temp1
    
    ' 확인 코드의 시작일 저장
    strTemp = Format(Date, "dd") * Val(Format(Date, "mm")) * 12
    SaveSetting "Laundry_Zi", "PassWord", "PassVal2", strTemp
    
    ' 확인 코드의 유효기간을 "YYYY-MM-DD"형식으로 저장
    strTemp = Format(DateAdd("d", Val(Mid(temp1, 1, 2)), Date), "YYYY-MM-DD")
    strTemp = strTemp * Val(Format(Date, "mm")) * 12
    SaveSetting "Laundry_Zi", "PassWord", "PassVal3", strTemp
    IsPassREGSave = True
End Function

'+------------------------------------------------------
'+
'+ 2003/08/29
'+
'+루틴설명
'+  1. strPass로 전달된 비밀번호의 유효성을 검사한다
'+  2. 전달값
'+     strPass :   "05????????????"   앞 2자리는 유효 일자
'+                                       2자리 다음은 비빌번호
'+                                       ( 일자 * 365 * 1544 )
'+  3. 리턴값
'+     앞 2자리를 리턴한다. ( 사용기간 )
'+     -1 :         임의 수정한 경우
'+     -3 :         입력한 내용이 틀린 경우
'+
'+------------------------------------------------------
Public Function IsEventPassWord(strPass) As String
    Dim nday    As Double
    Dim intMM   As Integer
    Dim dPass   As Double
    Dim strTemp As String
    
    If IsNull(Mid(strPass, 1, 2)) Then
        MsgBox "전달된 본사확인코드의 형식이 정확하지 않습니다.", vbInformation, "입력오류"
        IsEventPassWord = "-1"
        Exit Function
    End If
        
    strTemp = Mid(strPass, 3, Len(strPass) - 2)
    
    ' 오늘의 일자를 구한다.
    nday = Val(Format(Date, "dd"))
    intMM = Val(Format(Date, "mm"))
    dPass = nday * intMM * 1544
    
    If strTemp = CStr(dPass) Then
        IsEventPassWord = Mid(strPass, 1, 2)
    Else
        IsEventPassWord = "-3"
    End If
    
End Function

'+------------------------------------------------------
'+
'+ 2003/08/29
'+
'+루틴설명
'+  temp1 : 유효 일자
'+  temp2 : 비밀번호
'+  1. 레지스터리에 PassWord의 내용을 저장한다.
'+  2. 리턴값
'+     True :       정상인 경우
'+     Falss:       저장 오류인 경우
'+
'+------------------------------------------------------
Public Function IsEventPassREGSave(temp1 As String) As Boolean
    Dim intMM   As Integer
    Dim strTemp As String

    If Mid(temp1, 1, 2) < "00" Or Mid(temp1, 1, 2) > "99" Then
        MsgBox "전달된 비밀번호 형식이 정확하지 않습니다.", vbInformation, "입력오류"
        IsEventPassREGSave = False
        Exit Function
    End If
    
    intMM = Val(Format(Date, "mm"))
    
    ' 확인코드 저장
    SaveSetting "Laundry_Zi", "PassWord", "EventPassVal1", temp1
    
    ' 확인 코드의 시작일 저장
    strTemp = Format(Date, "dd") * intMM * 12
    SaveSetting "Laundry_Zi", "PassWord", "EventPassVal2", strTemp
    
    ' 확인 코드의 유효기간을 "YYYY-MM-DD"형식으로 저장
    strTemp = Format(DateAdd("d", Val(Mid(temp1, 1, 2)), Date), "YYYY-MM-DD")
    
    strTemp = strTemp * intMM * 12
    SaveSetting "Laundry_Zi", "PassWord", "EventPassVal3", strTemp
    
    IsEventPassREGSave = True

End Function

'+------------------------------------------------------
'+
'+ 2003/08/29
'+
'+루틴설명
'+  1. 레지스터리의 PassWord저장 내용 임의 변경을 확인한다.
'+  2. 리턴값
'+     -1 :         임의 수정한 경우
'+     -2 :         유효 기간이 만료된 경우
'+     -3 :         입력한 내용이 틀린 경우
'+     일자 :       완료 일자를 리턴한다.
'+
'+------------------------------------------------------
Public Function IsEventPassREGRead() As String
    Dim strPass As String
    Dim strtemp1 As String
    Dim strtemp2 As String
    Dim strtemp3 As String
    Dim intMM    As Integer
   
    strtemp1 = GetSetting("Laundry_Zi", "PassWord", "EventPassVal1", strtemp1)
    strtemp2 = GetSetting("Laundry_Zi", "PassWord", "EventPassVal2", strtemp2)
    strtemp3 = GetSetting("Laundry_Zi", "PassWord", "EventPassVal3", strtemp3)
    
    If Len(strtemp1) <= 0 Or Len(strtemp2) <= 0 Or Len(strtemp3) <= 0 Then
        IsEventPassREGRead = "-1"
        chkEventSale = False
        Exit Function
    End If
    
    intMM = Val(Format(Date, "MM"))

    
    strPass = Mid(strtemp1, 1, 2)
    ' 일자 확인
    If strPass < "00" And strPass > "99" Then
        IsEventPassREGRead = "-1"
        chkEventSale = False
        Exit Function
    End If
    
    strtemp2 = Val(strtemp2) / intMM / 12                    ' 시작 일자를 확인한다.
    
    strPass = Mid(strtemp1, 3, Len(strtemp1)) / intMM / 1544 ' 저장비밀번호에서 시작일을 구한다.
    
    If strPass <> strtemp2 Then
        IsEventPassREGRead = "-1"
        Exit Function
    Else
        '확인코드의 유효 기간을 확인한다.
        strtemp3 = Val(strtemp3) / intMM / 12
        
        If strtemp3 > Format(Date, "YYYY-MM-DD") Then
            IsEventPassREGRead = strtemp3
            Exit Function
        Else
            IsEventPassREGRead = "-2"
            chkEventSale = False
        End If
    End If

End Function

Public Sub Delay(ByVal utime As Single)
    Dim starttime As Single

    starttime = Timer
 
    Do
        'DoEvents
    Loop While Timer < starttime + utime
End Sub

'-------------------------------------------------------------------
' 고객코드 = 년도(YY) + 순번(9999)
'-------------------------------------------------------------------
Public Function Get_CustomNo() As String
    Dim sYEAR As String
    
    sYEAR = Format(Date, "YY")
    
    Query = "SELECT ISNULL(MAX(고객코드),'" & sYEAR & "0000') + 1 FROM TB_고객정보"
    Query = Query & " WHERE SUBSTRING(고객코드,1,2) = '" & sYEAR & "'"
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly

    Get_CustomNo = Format(SUBRs(0), "000000")

    SUBRs.Close
    Set SUBRs = Nothing
End Function

'+------------------------------------------------------
'+ 2003/03/10
'+
'+루틴설명
'+  보관증을 보존할 일자를 리턴한다.
'+------------------------------------------------------
Public Function Get_Bo_Day() As String
    Dim strTemp As String

    If Val(GetSetting("Laundry_Zi", "Printer", "Bo_Day", strTemp)) = 0 Then
        strTemp = 0
    Else
        strTemp = Val(GetSetting("Laundry_Zi", "Printer", "Bo_Day", strTemp))
    End If
    
    If Val(strTemp & "") > 30 Then
        strTemp = "30"
    ElseIf Val(strTemp & "") <= 0 Then
        strTemp = "30"
    End If

    Get_Bo_Day = Format(strTemp, "00")
End Function

'-----------------------------------------------------------------------------------------------------------------------------------------
' Function명  : Get_ColWidth
' 작  성  자  : IT21
' 작  성  일  : 2000.06.07
' 파 라 미 터 : New_App  -
'               New_Form -
'               New_SS   -
' 리  턴  값  : Boolean
' 비      고  : 스프레드의 Column의 길이를 불러온다.
'-----------------------------------------------------------------------------------------------------------------------------------------
Public Function Get_ColWidth(ByVal New_App As String, ByVal New_Form As String, ByVal New_SS As Object) As Boolean
    Dim Col As Long

    On Error GoTo ErrRtn:
    
    Get_ColWidth = True
    
    For Col = 1 To New_SS.MaxCols
        New_SS.ColWidth(Col) = GetSetting(New_App, New_Form, New_SS.Name + "_ColWidth_" + CStr(Col), CStr(New_SS.ColWidth(Col)))
    Next Col
    
    Exit Function

ErrRtn:
    Get_ColWidth = False
    Resume Next

End Function

'-----------------------------------------------------------------------------------------------------------------------------------------
' Function명  : SaveColWidth
' 작  성  자  : IT21
' 작  성  일  : 2000.06.07
' 파 라 미 터 : New_App  -
'               New_Form -
'               New_SS   -
' 리  턴  값  : Boolean
' 비      고  : 스프레드의 Column의 길이를 저장한다.
'-----------------------------------------------------------------------------------------------------------------------------------------
Public Function SaveColWidth(ByVal New_App As String, ByVal New_Form As String, ByVal New_SS As Object) As Boolean
    Dim Col As Long

    On Error GoTo ErrRtn:
    
    SaveColWidth = True
    For Col = 1 To New_SS.MaxCols
        SaveSetting New_App, New_Form, New_SS.Name + "_ColWidth_" + CStr(Col), CStr(New_SS.ColWidth(Col))
    Next Col

    Exit Function

ErrRtn:
    SaveColWidth = False
    Resume Next
End Function


Public Sub ClearArray(fpArr As Variant)
' 2차원 배열을 초기화 한다.
    Dim iCnt As Integer
    Dim jCnt As Integer
    
    For iCnt = LBound(fpArr, 1) To UBound(fpArr, 1)
        If Len(fpArr(iCnt, 1)) < 1 Then
            Exit For
        End If
        
        For jCnt = LBound(fpArr, 2) To UBound(fpArr, 2)
            fpArr(iCnt, jCnt) = Empty
        Next jCnt
    Next iCnt
End Sub


Public Sub CrateCommondFiles(Mode As CommandFiles, Optional SW As Boolean = False)
    Dim HFandle As Integer
    
    If SW = False Then
        '일경우에만 있는지 확인하여 없을 경우만 만듣다.

        Select Case Mode
            Case BACKUP:  If Dir("backup.bat", vbDirectory) <> "" Then Exit Sub
            Case Restore: If Dir("Restore.bat", vbDirectory) <> "" Then Exit Sub
            Case PGDown:  If Dir("PGDown.bat", vbDirectory) <> "" Then Exit Sub
            Case DBSend:  If Dir("DBSend.bat", vbDirectory) <> "" Then Exit Sub
        End Select
    End If
    
    ' 무조건 만든다.
    HFandle = FreeFile
    
    Select Case Mode
        Case BACKUP
            Open App.Path & "\Backup.Bat" For Output As #HFandle
            Print #HFandle, "@echo off"
            Print #HFandle, "c:\Laundry\arj a -v1440 -y c:\Laundry\db\BackData c:\Laundry\DB\LAUNDRY.MDB"
            Print #HFandle, "COPY c:\Laundry\bACKUP.BAT c:\Laundry\BACKUP.OK"
            Close #HFandle
            
        Case Restore
            Open App.Path & "\Restore.Bat" For Output As #HFandle
            Print #HFandle, "@echo off"
            Print #HFandle, "c:\Laundry\arj e -v1440 -y c:\Laundry\db\BackData c:\Laundry\db\"
            Print #HFandle, "COPY c:\Laundry\bACKUP.BAT c:\Laundry\BACKUP.OK"
            Close #HFandle

        Case PGDown
        
        Case DBSend
            Open App.Path & "\DBSend.Bat" For Output As #HFandle
            Print #HFandle, "@echo off"
            Print #HFandle, "c:"
            Print #HFandle, "cd c:\Laundry"
            Print #HFandle, "Copy c:\Laundry\DB\Laundry.MDB C:\Laundry\db\Laundry1.MDB"
            Print #HFandle, "C:\Laundry\Pkzip.exe c:\Laundry\db\" & 가맹점정보.택코드 & ".zip C:\Laundry\DB\Laundry1.MDB"
            Print #HFandle, "COPY c:\Laundry\DBSend.BAT c:\Laundry\DBSend.OK"
            Close #HFandle
    End Select
End Sub

Public Function GetStatus(RasStatus As Long) As String
    Dim StatusString As String

    Select Case RasStatus
        Case RASCS_OpenPort:            StatusString = "포트를 OPEN 하는 중 입니다..."
        Case RASCS_PortOpened:          StatusString = "포트가 OPEN 되었습니다."
        Case RASCS_ConnectDevice:       StatusString = "디바이스에 연결하는 중입니다..."
        Case RASCS_DeviceConnected:     StatusString = "디바이스에 연결되었습니다."
        Case RASCS_AllDevicesConnected: StatusString = "모든 디바이스에 연결되었습니다."
        Case RASCS_Authenticate:        StatusString = "사용자를 인증하고 있습니다..."
        Case RASCS_AuthNotify:          StatusString = "AuthNotify"
        Case RASCS_AuthRetry:           StatusString = "사용자 인증 재시도중..."
        Case RASCS_AuthCallback:        StatusString = "AuthCallback"
        Case RASCS_AuthChangePassword:  StatusString = "비밀번호가 잘못되었습니다."
        Case RASCS_AuthProject:         StatusString = "AuthProject"
        Case RASCS_AuthLinkSpeed:       StatusString = "AuthLinkSpeed"
        Case RASCS_AuthAck:             StatusString = "AuthAck"
        Case RASCS_ReAuthenticate:      StatusString = "ReAuthenticate"
        Case RASCS_Authenticated:       StatusString = "사용자가 인증되었습니다."
        Case RASCS_PrepareForCallback:  StatusString = "PrepareForCallback"
        Case RASCS_WaitForModemReset:   StatusString = "WaitForModemReset"
        Case RASCS_WaitForCallback:     StatusString = "WaitForCallback"
        Case RASCS_Projected:           StatusString = "Projected"
        Case RASCS_StartAuthentication: StatusString = "사용자 인증을 시작하는 중 입니다."
        Case RASCS_CallbackComplete:    StatusString = "CallbackComplete"
        Case RASCS_LogonNetwork:        StatusString = "네트워크에 로그온이 되었습니다."
        Case RASCS_Interactive:         StatusString = "상호네트워크 Checking 중..."
        Case RASCS_RetryAuthentication: StatusString = "사용자 인증을 다시 하시기 바랍니다."
        Case RASCS_CallbackSetByCaller: StatusString = "CallbackSetByCaller"
        Case RASCS_PasswordExpired:     StatusString = "비밀번호가 만료되었습니다."
        Case RASCS_Connected:           StatusString = "본사에 접속이 되었습니다."
        Case RASCS_Disconnected:        StatusString = "본사에 접속이 되지 않았습니다."
        Case 0:                         StatusString = "본사에 접속이 되지 않았습니다."
        Case RASBASE:                   StatusString = "접속 중..."
        Case Else:                      StatusString = "RAS Error " & RasStatus
    End Select
    
    GetStatus = StatusString

End Function

'+++++++++++++++++++++++++++++++++++++++++++++++++
' 작성일 : 2003/04/15
' 작성자 : pds2004 (박대선)
' 설  명 : 프로그램을 업그레이드 한다.
' 리턴값 : 0 정상실행
'          1 업그레이드 성공
'          -1 업그레이드 실패
'+++++++++++++++++++++++++++++++++++++++++++++++++
Public Function ProgramUpgrade() As Boolean
    Dim PauseTime
    Dim Start
    Dim Finish
    Dim TotalTime
    
    Dim SourceFile As String
    Dim DestinationFile As String


    SourceFile = App.Path & "\" & App.EXEName & ".exe" ' 판매재고관리UP.EXE
    
    DestinationFile = App.Path & "\" & Mid(App.EXEName, 1, Len(App.EXEName) - 2) & ".exe" '판매재고관리.EXE
    
    If UCase(Right(App.EXEName, 2)) = "UP" Then
        ' 업그레이드 파일일경우
        On Error Resume Next
        
        PauseTime = 10                  ' 기간을 지정합니다.
        Start = Timer                   ' 시작 시간을 지정합니다.
        
        Do
            Finish = Timer              ' 종료 시간을 지정합니다.
            TotalTime = Finish - Start  ' 전체 시간을 계산합니다.
            
            If Dir(DestinationFile, vbDirectory) <> "" Then
                If Timer > Start + PauseTime Then
                    MsgBox " 정상적으로 업그레이드 되지 않았습니다." & vbLf & "다시 시도 합니다.", vbCritical, "오류"
                    
                    On Error GoTo Kill_End
                    
                    Kill DestinationFile
                End If
            Else
                Exit Do
            End If
            
            DoEvents                    ' 다른 프로시저로 넘깁니다.
            Kill DestinationFile        ' 원본 파일을 삭제한다.
        Loop
    
Kill_End:
        If Dir(DestinationFile, vbDirectory) = "" Then
            FileCopy SourceFile, DestinationFile
            
            MsgBox " 업그레이드 완료. " & vbLf & vbLf & " 프로그램을 다시 시작 하여 주십시요.     ", vbInformation, "확인"
            
            Call Get_가맹점정보
            Call SendProgramVersion
    
            End
            
            Exit Function
        Else
            MsgBox " 정상적으로 업그레이드 되지 않았습니다.", vbCritical, "오류"
            
            ProgramUpgrade = False
            Exit Function
        End If
        
    Else
        ProgramUpgrade = True
    End If
End Function

'-----------------------------------------------------------------
' 함수명 : Get_고객마일리지
'
' 회원 코드를 전송 받아 마일리지 정보를 리턴한다.
'-----------------------------------------------------------------
Public Sub Get_고객마일리지(UserCode As String)
    On Error GoTo ErrRtn
    
    '---------------------------------------------------------------
    ' TB_매출
    '---------------------------------------------------------------
'    Query = "SELECT TOP 1"
'    Query = Query & "  ISNULL(사용가능마일리지,0)"
'    Query = Query & ", ISNULL(누적마일리지,0)"
'    Query = Query & " FROM TB_매출"
'    Query = Query & " WHERE 고객코드 = '" & UserCode & "'"
'    Query = Query & " ORDER BY 매출일자 DESC, 매출시간 DESC"
    
    Query = "SELECT    ISNULL(사용가능마일리지,0)"
    Query = Query & ", ISNULL(누적마일리지,0)"
    Query = Query & " FROM TB_고객정보"
    Query = Query & " WHERE 고객코드 = '" & UserCode & "'"
    Set Rs = New ADODB.Recordset
    Rs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly

    If Rs.EOF Then
        With 마일리지
            .사용가능마일리지 = 0
            .누적마일리지 = 0
        End With
    Else
        With 마일리지
            .사용가능마일리지 = Rs(0) & ""
            .누적마일리지 = Rs(1) & ""
        End With
    End If
    Rs.Close
    Set Rs = Nothing

    Exit Sub

ErrRtn:
    Call Error_Msg("Get_고객마일리지", Err.Source, Err.Number, Err.description)
End Sub
'
'' 총사용금액,  최종발생금액,  고객코드
'' 사용금액이 전달되면 거기에 해당하는 마일리지 금액이 전달된다.
'' 한번에 여러 단계가 발생 할수 있다.
'' NextMileage = 100,000
'Public Function Fnc_MileagePoint(UserMoney As Double, LastMoney As Double) As Double
'    Dim TempMileage As Double
'    Dim j           As Double
'    Dim kk          As Double
'
'    If LastMoney < 0 Then Exit Function
'
'    kk = ((LastMoney \ NextMileage) + 1) * NextMileage ' 마일리지 시작 값을 구한다.
'
'    TempMileage = 0
'
'    If 가맹점정보.마일리지증가구분 = "0" Then
'        For j = kk To UserMoney Step NextMileage
'            '   500,000 이상일 경우
'            If j >= (NextMileage * 5) Then
'                TempMileage = TempMileage + 7000
'
'            '   400,000 이상일 경우
'            ElseIf j >= (NextMileage * 4) Then
'                TempMileage = TempMileage + 6000
'
'            '   300,000 이상일 경우
'            ElseIf j >= (NextMileage * 3) Then
'                TempMileage = TempMileage + 5000
'
'            '   200,000 이상일 경우
'            ElseIf j >= (NextMileage * 2) Then
'                TempMileage = TempMileage + 4000
'
'            '   100,000 이상일 경우
'            ElseIf j >= (NextMileage * 1) Then
'                TempMileage = TempMileage + 3000
'
'            '   100,000 미만일 경우
'            ElseIf j < NextMileage Then
'                TempMileage = TempMileage + 0
'            End If
'        Next j
'
'    ElseIf 가맹점정보.마일리지증가구분 = "1" Then
'        For j = kk To UserMoney Step NextMileage
'
''            '   500,000 이상일 경우
''            If j >= (NextMileage * 5) Then
''                TempMileage = TempMileage + 7000
''
''            '   400,000 이상일 경우
''            ElseIf j >= (NextMileage * 4) Then
''                TempMileage = TempMileage + 6000
''
''            '   300,000 이상일 경우
''            ElseIf j >= (NextMileage * 3) Then
''                TempMileage = TempMileage + 5000
''
''            '   200,000 이상일 경우
''            ElseIf j >= (NextMileage * 2) Then
''                TempMileage = TempMileage + 4000
'
'            '   100,000 이상일 경우
'            If j >= (NextMileage * 1) Then
'                TempMileage = TempMileage + 3000
'
'            '   100,000 미만일 경우
'            ElseIf j < NextMileage Then
'                TempMileage = TempMileage + 0
'            End If
'        Next j
'
'    End If
'
'    Fnc_MileagePoint = TempMileage
'End Function

'-------------------------------------------------------------------------------
' 함수명 : Set_고객미수금액
'
' 전달된 고객의 미수금을 적용한다.
' 이전 미수금액을 구한다음 그걸 이용한다
'-------------------------------------------------------------------------------
Public Sub Set_고객미수금액(고객코드 As String, 금액 As Long, Mode As String)
    On Error GoTo ErrRtn
    
    If UCase(Mode) = "ADD" Then
        Query = "UPDATE TB_고객정보 SET 미수금액     = 미수금액 + " & 금액
        Query = Query & "             , 최종거래일자 = '" & Format(Now, "YYYY-MM-DD hh:mm:ss") & "'"
        Query = Query & "             , 본사전송여부 = ''"
        Query = Query & " WHERE 고객코드 = '" & 고객코드 & "'"
        ADOCon.Execute Query
    Else
        Query = "UPDATE TB_고객정보 SET 미수금액     = 미수금액 - " & 금액
        Query = Query & "             , 최종거래일자 = '" & Format(Now, "YYYY-MM-DD hh:mm:ss") & "'"
        Query = Query & "             , 본사전송여부 = ''"
        Query = Query & " WHERE 고객코드 = '" & 고객코드 & "'"
        ADOCon.Execute Query
    End If
    
    Exit Sub
    
ErrRtn:

End Sub

' 마일리지 마감 ( 100일동안 이용 실적이 없을 경우 마일리지 삭제 )
Public Sub Set_마일리지삭제()
    On Error GoTo ErrRtn
    
    Dim iSEQ         As Long
    Dim 삭제마일리지 As Long
    
    Query = "SELECT * FROM TB_고객정보"
    Query = Query & " WHERE SUBSTRING(최종거래일자,1,10) < '" & Format(DateAdd("d", -100, Date), "YYYY-MM-DD") & "'"
    Query = Query & "   AND 사용가능마일리지 > 0 "
    Set ADORs = New ADODB.Recordset
    ADORs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly

    Do Until ADORs.EOF
        DoEvents
        
        Query = "SELECT ISNULL(MAX(일련번호),0) + 1"
        Query = Query & " FROM TB_매출"
        Query = Query & " WHERE 고객코드 = '" & ADORs!고객코드 & "'"
        Query = Query & "   AND 접수번호 = 0"
        Set SUBRs = New ADODB.Recordset
        SUBRs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
                        
        iSEQ = SUBRs(0)
        SUBRs.Close:    Set SUBRs = Nothing
            
        삭제마일리지 = ADORs!사용가능마일리지
        
        ADOCon.BeginTrans
        
        Query = "INSERT INTO TB_매출 ( 고객코드"          ' 1
        Query = Query & "            , 접수번호"          ' 2
        Query = Query & "            , 일련번호"          ' 3
        Query = Query & "            , 매출일자"          ' 4
        Query = Query & "            , 매출시간"          ' 5
        Query = Query & "            , 적요"              ' 6
        Query = Query & "            , 접수금액"          ' 7
        Query = Query & "            , 입금합계"          ' 8
        Query = Query & "            , 현금입금"          ' 9
        Query = Query & "            , 카드입금"          '10
        Query = Query & "            , 쿠폰입금"          '11
        Query = Query & "            , 쿠폰번호"          '12
        Query = Query & "            , 사용마일리지"      '13
        Query = Query & "            , 세트할인"          '14
        Query = Query & "            , 에누리"            '15
        Query = Query & "            , 접수수량"          '16
        Query = Query & "            , 반품수량"          '17
        Query = Query & "            , 발생마일리지"      '18
        Query = Query & "            , 누적마일리지"      '19
        Query = Query & "            , 사용가능마일리지"  '20
        Query = Query & "            , 삭제마일리지"      '21
        Query = Query & "            , 가맹점코드"        '22
        Query = Query & "            , 지사코드"          '23
        Query = Query & "            , 본사전송여부"      '
        Query = Query & "            ) VALUES ("
        Query = Query & "              '" & ADORs!고객코드 & "'"             ' 1
        Query = Query & "            , 0"                                    ' 2
        Query = Query & "            ,  " & iSEQ                             ' 3
        Query = Query & "            , '" & Format(Date, "YYYY-MM-DD") & "'" ' 4
        Query = Query & "            , '" & Format(Time, "hh:mm:ss") & "'"   ' 5
        Query = Query & "            , '[마일리지 삭제]'"                    ' 6
        Query = Query & "            , 0"                                    ' 7
        Query = Query & "            , 0"                                    ' 8
        Query = Query & "            , 0"                                    ' 9
        Query = Query & "            , 0"                                    '10
        Query = Query & "            , 0"                                    '11
        Query = Query & "            , 0"                                    '12
        Query = Query & "            , 0"                                    '13
        Query = Query & "            , 0"                                    '14
        Query = Query & "            , 0"                                    '15
        Query = Query & "            , 0"                                    '16
        Query = Query & "            , 0"                                    '17
        Query = Query & "            , 0"                                    '18
        Query = Query & "            ,  " & ADORs!누적마일리지 & " "         '19
        Query = Query & "            , 0"                                    '20
        Query = Query & "            ,  " & 삭제마일리지                     '21
        Query = Query & "            , '" & 가맹점정보.가맹점코드 & "'"      '22
        Query = Query & "            , '" & 가맹점정보.지사코드 & "'"        '23
        Query = Query & "            , '')"
        ADOCon.Execute Query
        
        ' 고객정보를 수정한다.
        Query = "UPDATE TB_고객정보 SET 사용가능마일리지 = 0, 본사전송여부 = 'N' WHERE 고객코드 = '" & ADORs!고객코드 & "'"
        ADOCon.Execute Query
        
        ADOCon.CommitTrans
        
        ADORs.MoveNext
    Loop
    ADORs.Close
    Set ADORs = Nothing
    
    Exit Sub
    
ErrRtn:
    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure Set_마일리지삭제 of Module basGlobal"
    ADOCon.RollbackTrans

End Sub
    
Public Function LOG_SaleDelete_SAVE(ByVal sDescription As String) As Boolean
    On Error GoTo ERR_RTN
    
    Dim FHandle As Integer
    Dim sText   As String
    
    If Dir(App.Path & "\Logs", vbDirectory) = "" Then MkDir App.Path & "\Logs"
    
    sText = Now & " : " & sDescription
    
    FHandle = FreeFile
    Open App.Path & "\Logs\" & "SaleDeleteLog.Txt" For Append As FHandle

    Print #FHandle, sText
    Close #FHandle
    Exit Function

ERR_RTN:
    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure LOG_SaleDelete_SAVE of Module basGlobal"

End Function

Public Function ERR_SAVE(ByVal sDescription As String) As Boolean
    On Error GoTo ERR_RTN
    
    Dim FHandle As Integer
    Dim sText   As String
    
    If Dir(App.Path & "\Logs", vbDirectory) = "" Then MkDir App.Path & "\Logs"

    sText = Now & " : " & sDescription

    FHandle = FreeFile
    Open App.Path & "\Logs\" & Format(Date, "YYYY-MM-DD") & "_ERR_MSG.Txt" For Append As FHandle

    Print #FHandle, sText
    Close #FHandle
    Exit Function

ERR_RTN:
    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure ERR_SAVE of Module basGlobal"

End Function

Public Function FTP_LOG_SAVE(ByVal sDescription As String) As Boolean
    Dim FHandle As Integer
    Dim sText   As String
    
    sText = Now & " : " & sDescription
    
    FHandle = FreeFile
    Open App.Path & "\" & "FTP_MSG.Txt" For Append As FHandle

    Print #FHandle, sText
    Close #FHandle
    Exit Function

End Function

Public Function IsJuminNum(ByVal strJuminNum As String) As Boolean
    Dim iSum As Integer
    Dim iRe As Integer
    
    On Error GoTo Wrong_Number
   
    strJuminNum = Replace(strJuminNum, "-", "")
   
    If Len(strJuminNum) <> 13 Then
        IsJuminNum = False
        Exit Function
    End If
   
    If CInt(Mid(strJuminNum, 3, 2)) < 0 Or CInt(Mid(strJuminNum, 3, 2)) > 12 Or _
      CInt(Mid(strJuminNum, 5, 2)) < 0 Or CInt(Mid(strJuminNum, 5, 2)) > 31 Or _
      CInt(Mid(strJuminNum, 7, 1)) < 0 Or CInt(Mid(strJuminNum, 7, 1)) > 4 Then
         IsJuminNum = False
         Exit Function
    End If
   
    iSum = CInt(Mid(strJuminNum, 1, 1)) * 2 + _
           CInt(Mid(strJuminNum, 2, 1)) * 3 + _
           CInt(Mid(strJuminNum, 3, 1)) * 4 + _
           CInt(Mid(strJuminNum, 4, 1)) * 5 + _
           CInt(Mid(strJuminNum, 5, 1)) * 6 + _
           CInt(Mid(strJuminNum, 6, 1)) * 7 + _
           CInt(Mid(strJuminNum, 7, 1)) * 8 + _
           CInt(Mid(strJuminNum, 8, 1)) * 9 + _
           CInt(Mid(strJuminNum, 9, 1)) * 2 + _
           CInt(Mid(strJuminNum, 10, 1)) * 3 + _
           CInt(Mid(strJuminNum, 11, 1)) * 4 + _
           CInt(Mid(strJuminNum, 12, 1)) * 5

    iSum = iSum Mod 11
    iRe = 11 - iSum
   
    If iRe > 9 Then
        iRe = iRe Mod 10
    End If

    iSum = CInt(Mid(strJuminNum, 13, 1))

    If iSum = iRe Then
        IsJuminNum = True
    Else
        IsJuminNum = False
    End If
   
    Exit Function
   
Wrong_Number:
   IsJuminNum = False
End Function

' 전달된 코드의 금액을 DB에서 읽어온다.
Public Function Get_DryPrice(ClothCode As String) As Long
    Dim iPrice      As Double
    Dim sGoodsStats As String
    
    On Error GoTo ErrRtn
      
    iPrice = Get_세탁금액(ClothCode, sGoodsStats)
    
    If iPrice = -1 Then
        Get_DryPrice = 0
        
        Exit Function
    End If
    
    Call Get_고객정보(frm접수.txtCode.Text)  ' 고객 정보를 얻어 온다.
    frm접수.lblGoodsPriceStats.Caption = sGoodsStats
    
    '크렌즈 겔러리 최초 손님일 경우 10% 자동 DC 적용처리
    ' 2014-04-01일 부터는 10% 적용하지 않도록 설정
    If 가맹점정보.지사코드 = M_COUPON_KLENZ_CODE And Format(Date, "yyyy-MM-dd") <= "2014-03-31" Then
    
        If UCase(GetIniStr("RUNMODE", "FIRSTDC", "Y", iniFile)) = "Y" Then
            ' 당일 등록일 경우,
            ' 반복적으로 계산 버튼을 클릭한경우의 처리를 위하여(한번만 처리되도록 하기 위하여)
            If 고객정보.등록일자 = Format(Date, "YYYY-MM-DD") Then
                iPrice = CDbl(Int(CDbl((iPrice * 0.9) / 100)) * 100) ' 10원단위를 절사 한다.
            End If
        End If
    End If
    
    Get_DryPrice = iPrice
    
    Exit Function
          
ErrRtn:
    Get_DryPrice = 0
End Function

'====================================================================================================
' Procedure : SetTableDefaultSendData
' DateTime  : 2008-05-03 01:11
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 최초 아무런 자료가 없을 경우 초기 값을 저장한다.
'====================================================================================================
Public Function SetTableDefaultSendData() As Boolean
    On Error GoTo ErrRtn
    
    SetTableDefaultSendData = False
    
    If Trim(가맹점정보.가맹점코드) = "000000" Then
        MsgBox "가맹점 정보가 올바르지 않습니다.", vbCritical, "경고"
        Exit Function
    End If
    
    If Server_Connection(HostCon) = True Then
        ' 최초 아무것도 없을 경우 초기 기준일자를 입력한다.
        Query = "SELECT STORE_CD FROM TB_가맹점전송정보"
        Query = Query & " WHERE STORE_CD = '" & 가맹점정보.가맹점코드 & "'"
        Set SUBRs = New ADODB.Recordset
        SUBRs.Open Query, HostCon, adOpenStatic, adLockOptimistic
        
        If SUBRs.EOF = True Then
            Query = "INSERT INTO TB_가맹점전송정보(STORE_CD, "
            Query = Query & " 고객정보, 고객정보기준일자, 고객정보전송일자, "
            Query = Query & " 대리점정보, 대리점정보기준일자, 대리점정보전송일자, "
            Query = Query & " 마일리지스토리, 마일리지스토리기준일자, 마일리지스토리전송일자, "
            Query = Query & " 마일리지현황, 마일리지현황기준일자, 마일리지현황전송일자, "
            Query = Query & " 목요세일, 목요세일기준일자, 목요세일전송일자, "
            Query = Query & " 미수회수정보, 미수회수정보기준일자, 미수회수정보전송일자, "
            Query = Query & " 입출고, 입출고기준일자, 입출고전송일자, "
            Query = Query & " 참조코드, 참조코드기준일자, 참조코드전송일자, "
            Query = Query & " 할인정보, 할인정보기준일자, 할인정보전송일자) "
            Query = Query & " VALUES('" & 가맹점정보.가맹점코드 & "',"
            Query = Query & " 'N','2008-01-01','', "
            Query = Query & " 'N','2008-01-01','', "
            Query = Query & " 'N','2008-01-01','', "
            Query = Query & " 'N','2008-01-01','', "
            Query = Query & " 'N','2008-01-01','', "
            Query = Query & " 'N','2008-01-01','', "
            Query = Query & " 'N','2008-01-01','', "
            Query = Query & " 'N','2008-01-01','', "
            Query = Query & " 'N','2008-01-01','') "
            HostCon.Execute Query
        End If
    End If
    
    Set HostCon = Nothing
    Set SUBRs = Nothing
    
    SetTableDefaultSendData = True
    
    On Error GoTo 0
    
    Exit Function

ErrRtn:
    
    Set HostCon = Nothing
    Set SUBRs = Nothing

    SetTableDefaultSendData = False
    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure SetTableDefaultSendData of Module Global"
End Function

'====================================================================================================
' Procedure : SendTable_DateSave
' DateTime  : 2008-05-03 01:11
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 전달된 테이블에 전송 "Y"를 설정한다.
'====================================================================================================
Public Function SendProgramVersion() As Boolean
    On Error GoTo SendProgramVersion_Error
    
    If Server_Connection(HostCon) = False Then
        Set HostCon = Nothing
        Exit Function
    End If
    
    SendProgramVersion = True
    
    Query = "UPDATE TB_가맹점 SET Ver = '" & Program_Version & "'  "
    Query = Query & " WHERE 가맹점코드 = '" & 가맹점정보.가맹점코드 & "' "
    HostCon.Execute Query
    
    Set HostCon = Nothing
    
    On Error GoTo 0
    
    Exit Function

SendProgramVersion_Error:

    Set HostCon = Nothing
    SendProgramVersion = False
    
    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure SendProgramVersion of Module Global"
End Function

'====================================================================================================
' Procedure : SendTable_DateSave
' DateTime  : 2008-05-03 01:11
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 전달된 테이블에 전송 "Y"를 설정한다.
'====================================================================================================
Private Function SendTable_DateSave(ByVal sTableName As String, ByRef HostCon As ADODB.Connection) As Boolean
    On Error GoTo ErrRtn
        
    SendTable_DateSave = True
    
    sTableName = Replace(sTableName, "가맹점", "")
    
    Query = "UPDATE TB_가맹점전송정보 SET " & sTableName & "전송일자 = '" & Format(Date, "YYYY-MM-DD") & "', "
    Query = Query & sTableName & " = 'Y'"
    Query = Query & " WHERE STORE_CD = '" & 가맹점정보.가맹점코드 & "' "
    HostCon.Execute Query
    
    On Error GoTo 0
    
    Exit Function

ErrRtn:
    SendTable_DateSave = False
    
    Call Error_Msg("SendTable_DateSave", Err.Source, Err.Number, Err.description)
End Function
 
'====================================================================================================
' Procedure : SendTable_DateCheck
' DateTime  : 2008-05-03 01:11
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 기준일자와 전송일자를 확인하여 전송일자 이후의 일자를 리턴한다.
'             기준일자 : 2008-01-01 전송일자 : '' 일경우 2008-01-01리턴
'             기준일자 : 2008-01-01 전송일자 : '2008-04-20' 일경우 2008-04-21을 리턴
'====================================================================================================
Public Function SendTable_DateCheck(ByVal sTableName As String, ByRef HostCon As ADODB.Connection, ByRef SendYN As String) As String
    On Error GoTo ErrRtn
    
    SendYN = "N"
    SendTable_DateCheck = "2008-01-01"
    
    sTableName = Replace(sTableName, "가맹점", "")
    
    ' 최초 아무것도 없을 경우 초기 기준일자를 입력한다.
    Query = "SELECT " & sTableName & "전송일자, " & sTableName
    Query = Query & " FROM TB_가맹점전송정보"
    Query = Query & " WHERE STORE_CD = '" & 가맹점정보.가맹점코드 & "' "
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, HostCon, adOpenStatic, adLockOptimistic
        
    If Not SUBRs.EOF Then
        SendYN = IIf(Trim(SUBRs.Fields(1) & "") <> "Y", "N", "Y")
        
        If Trim(SUBRs.Fields(0) & "") = "" Then
            SendTable_DateCheck = "2008-08-01"
        Else
            SendTable_DateCheck = Trim(SUBRs.Fields(0) & "")
        End If
    End If
    SUBRs.Close
    Set SUBRs = Nothing

    On Error GoTo 0
    
    Exit Function

ErrRtn:
    SendTable_DateCheck = False
    
    Call Error_Msg("SendTable_DateCheck", Err.Source, Err.Number, Err.description)
End Function
'
''====================================================================================================
'' Procedure : SendTable_Data
'' DateTime  : 2008-05-03 01:03
'' Author    : pds2004
'' Last Edit :
'' Return Val:
''----------------------------------------------------------------------------------------------------
'' 설     명 : 각종테이블의 자료를 본사 SQL 서버에 저장한다.
''====================================================================================================
'Public Function SendTable_Data(objPrBar As Object, Optional DaySendYN As Boolean = False) As Boolean
'    Dim sSendData   As String
'    Dim sYN         As String
'
'    'On Error GoTo ErrRtn
'
'    If Trim(가맹점정보.가맹점코드) = "000000" Then
'        MsgBox "가맹점 정보가 올바르지 않습니다.", vbCritical, "경고"
'        Exit Function
'    End If
'
'    If Server_Connection(HostCon) = False Then
'        Set HostCon = Nothing
'
'        Exit Function
'    End If
'
'    '---------------------------------------------------------------
'    ' 가맹점정보를 전송한다.
'    '---------------------------------------------------------------
'    sSendData = SendTable_DateCheck("TB_가맹점", HostCon, sYN)
'
'    If sYN = "N" Then
'        Call SendTable_가맹점정보(sSendData, HostCon, objPrBar)
'    End If
'
'
'    '---------------------------------------------------------------
'    ' 가맹점 가맹점참조코드를 전송한다.
'    '---------------------------------------------------------------
'    sSendData = SendTable_DateCheck("TB_가맹점참조코드", HostCon, sYN)
'
'    If sYN = "N" Then
'        Call SendTable_참조코드(sSendData, HostCon, objPrBar)
'    End If
'
'    '---------------------------------------------------------------
'    ' 사고품 정보를 전송한다.
'    ' 사고품은 입력된 내용이 있을 경우 매일 전송하여야 하기 때문에 "Y" 일 경우도 전송한다.
'    '---------------------------------------------------------------
'    sSendData = SendTable_DateCheck("사고품", HostCon, sYN)
'
'    Call SendTable_사고품(sSendData, HostCon, objPrBar)
'
'    '---------------------------------------------------------------
'    ' 마감 자료를 전송한다.
'    ' 기본 30일을 확인한다. 가맹점전송정보에 마감일자 관련 테이블이 없어서 30일 기준으로 처리한다.
'    ' DaySendYN = true 일경우 당일날 물건을 받기 위하여 본사연결 화면에 들오롤경우 당일 매출이 발생하지
'    ' 않는 내용이 저장되어 다음날 적용되지 않는 문제가 발생하여 처리함.
'    '---------------------------------------------------------------
'    Call SendSalesData(Format(DateAdd("d", -7, Date), "YYYY-MM-DD"), IIf(DaySendYN = True, 6, 7))
'
'    Call SendTable_쿠폰정보(Format(DateAdd("d", -7, Date), "YYYY-MM-DD"), 7) ' 쿠폰정보 본사 전송
'
'    '입출고 정보를 전송한다.
'    '입출고는 입력된 내용이 있을 경우 매일 전송하여야 하기 때문에 "Y" 일경우도전송한다.
'    sSendData = SendTable_DateCheck("입출고", HostCon, sYN)
'
'    Call SendTable_입출고(sSendData, HostCon, objPrBar)
'    Call SendTable_메시지(sSendData, HostCon, objPrBar) '메시지 확인 내용을 전송한다.
'
'    '세트 상품 관련 내용을 전송한다.
'    If Format(Date, "YYYY-MM-DD") <= "20100131" Then
'        Call SendTable_세트응모번호(sSendData, HostCon, objPrBar)
'    End If
'
'    ''Call SendTable_세트상품정보(sSendData, HostCon, objPrBar)
'
'    Set HostCon = Nothing
'
'    SendTable_Data = True
'
'    On Error GoTo 0
'
'    Exit Function
'
'ErrRtn:
'    SendTable_Data = False
'
'    Call Error_Msg("SendTable_Data", Err.Source, Err.Number, Err.Description)
'End Function


'====================================================================================================
' Procedure : SendTable_가맹점정보
' DateTime  : 2008-05-03 01:42
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 전달된 일자부터 현재일자까지의 고객정보를 본사 SQL 서버에 저장한다.
'====================================================================================================
Private Function SendTable_가맹점정보(ByVal sStartDate As String, ByRef HostCon As Object, ByRef objPrBar As Object) As Long
    On Error GoTo ErrRtn
    
    If IsDate(sStartDate) = False Then
        MsgBox "전달된 일자가 올바르지 않습니다.  [" & sStartDate & "]", vbCritical, "경고"
        Exit Function
    End If
     
     SendTable_가맹점정보 = 0
     'aa = "시작시간: " & CStr(Now) & vbNewLine
     
    '----------------------------------------------------------------------
    ' 가맹점 코드를 Check한다.
    '----------------------------------------------------------------------
    Query = "SELECT * FROM TB_기본정보"
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    
    ' 고객정보가 없으면 종료를 한다.
    If Not SUBRs.EOF Then
        '----------------------------------------------------------------------
        Query = "DELETE FROM TB_가맹점"
        Query = Query & " WHERE 가맹점코드 = '" & 가맹점정보.가맹점코드 & "' "
        HostCon.Execute Query
        
    
        Query = "INSERT INTO TB_가맹점 ("
        Query = Query & ", 가맹점코드"       '
        Query = Query & ", 가맹점명"         '
        Query = Query & ", 적용일자"         '
        Query = Query & ", 대리점번호"       '
        Query = Query & ", 대리점색상"       '
        Query = Query & ", 대리점명"         '
        Query = Query & ", 수선"             '
        Query = Query & ", 택번호"           '
        Query = Query & ", 일수"             '
        Query = Query & ", 비율"             '
        Query = Query & ", 전화1"            '
        Query = Query & ", 전화2"            '
        Query = Query & ", 목요세일"         '
        Query = Query & ", 수선마진"         '
        Query = Query & ", 프린터"           '
        Query = Query & ", 세탁소요일"       '
        Query = Query & ", 운동화마진"       '
        Query = Query & ", 가죽무스탕마진"   '
        Query = Query & ", 카페트마진"       '
        Query = Query & ", 마일리지여부"     '
        'Query = Query & ", 보관증종류"      '
        Query = Query & ", 특정할인여부"     '
        Query = Query & ", 특정할인비율"     '
        Query = Query & ", 고가세탁비율"     '
        Query = Query & ", 마일리지검사일자" '
        Query = Query & ", 마일리지증가구분" '
        Query = Query & ", SMS_IP"         '
        Query = Query & ", SMS_DB"         '
        Query = Query & ", SMS_ID"       '
        Query = Query & ", SMS_PWD"       '
        Query = Query & ", TimeOut"          '
        Query = Query & ", TRANS_CHK"        '
        Query = Query & ", TRANS_DT"         '
        Query = Query & ") VALUES ("
        Query = Query & "  '" & SUBRs!가맹점코드 & "'"
        Query = Query & ", '" & SUBRs!가맹점명 & "'"
        Query = Query & ", '" & SUBRs!적용일자 & "'"
        Query = Query & ", '" & SUBRs!택코드 & "'"
        Query = Query & ", '" & SUBRs!택색상 & "'"
        Query = Query & ", '" & SUBRs!가맹점명 & "'"
        Query = Query & ", '" & SUBRs!수선 & "'"
        Query = Query & ", '" & SUBRs!택번호 & "'"
        Query = Query & ", '" & SUBRs!일수 & "'"
        Query = Query & ", '" & SUBRs!비율 & "'"
        Query = Query & ", '" & SUBRs!전화1 & "'"
        Query = Query & ", '" & SUBRs!전화2 & "'"
        Query = Query & ", '" & SUBRs!목요세일 & "'"
        Query = Query & ", '" & SUBRs!수선마진 & "'"
        Query = Query & ", '" & SUBRs!프린터 & "'"
        Query = Query & ", '" & SUBRs!세탁소요일 & "'"
        Query = Query & ", '" & SUBRs!운동화마진 & "'"
        Query = Query & ", '" & SUBRs!가죽무스탕마진 & "'"
        Query = Query & ", '" & SUBRs!카페트마진 & "'"
        Query = Query & ", '" & SUBRs!마일리지여부 & "'"
        'Query = Query & ", '" & SUBRs!보관증종류 & "'"
        Query = Query & ", '" & SUBRs!특정할인여부 & "'"
        Query = Query & ", '" & SUBRs!특정할인비율 & "'"
        Query = Query & ", '" & SUBRs!고가세탁비율 & "'"
        Query = Query & ", '" & SUBRs!마일리지검사일자 & "'"
        Query = Query & ", '" & SUBRs!마일리지증가구분 & "'"
        Query = Query & ", '" & SUBRs!SMS_IP & "'"
        Query = Query & ", '" & SUBRs!SMS_DB & "'"
        Query = Query & ", '" & SUBRs!SMS_ID & "'"
        Query = Query & ", '" & SUBRs!SMS_PWD & "'"
        Query = Query & ", '" & SUBRs!timeout & "'"
        Query = Query & ", '" & "Y" & "'"
        Query = Query & ", '" & Format(Date, "YYYY-MM-DD") & "')"
        HostCon.Execute Query & Query
        
        Call SendTable_DateSave("TB_가맹점", HostCon)
    End If
    
    SUBRs.Close
    Set SUBRs = Nothing
    
    ' aa = aa & "종료시간: " & CStr(Now) & vbNewLine
    ' aa = aa & "전송수량: " & CStr(SendTable_가맹점정보) & vbNewLine
    ' MsgBox aa
    
    On Error GoTo 0
    
    Exit Function

ErrRtn:
    SendTable_가맹점정보 = False
    
    Call Error_Msg("SendTable_가맹점정보", Err.Source, Err.Number, Err.description)
    
    Resume Next
End Function

'====================================================================================================
' Procedure : SendTable_참조코드
' DateTime  : 2008-05-03 01:42
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 전달된 일자부터 현재일자까지의 고객정보를 본사 SQL 서버에 저장한다.
'====================================================================================================
Private Function SendTable_참조코드(ByVal sStartDate As String, ByRef HostCon As Object, ByRef objPrBar As Object) As Long
    On Error GoTo ErrRtn
    
    If IsDate(sStartDate) = False Then
        MsgBox "전달된 일자가 올바르지 않습니다.  [" & sStartDate & "]", vbCritical, "경고"
        Exit Function
    End If
     
     SendTable_참조코드 = 0
     'aa = "시작시간: " & CStr(Now) & vbNewLine
     
    '--------------------------------------------------------------------
    ' 가맹점 코드를 Check한다.
    '--------------------------------------------------------------------
    Query = "SELECT 의류코드, 의류명, 금액 FROM TB_의류"
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    '--------------------------------------------------------------------
    '
    '--------------------------------------------------------------------
    Query = "DELETE FROM TB_가맹점참조코드 "
    Query = Query & " WHERE STORE_CD = '" & 가맹점정보.가맹점코드 & "' "
    HostCon.Execute Query
    
    ' 미전송 자료가 없으면 종료를 한다.
    If Not SUBRs.EOF Then
        SUBRs.MoveLast
        objPrBar.MAX = SUBRs.RecordCount
        SUBRs.MoveFirst
    End If
    
    
    ' 고객정보가 없으면 종료를 한다.
    Do While Not SUBRs.EOF
        Query = "INSERT INTO TB_가맹점참조코드 ("
        Query = Query & "STORE_CD, ":
        Query = Query & "의류코드, ":
        Query = Query & "의류명, ":
        Query = Query & "금액, ":
        Query = Query & "TRANS_CHK, ":
        Query = Query & "TRANS_DT) ":
        Query = Query & "VALUES("
        Query = Query & "'" & 가맹점정보.가맹점코드 & "', "
        Query = Query & "'" & SUBRs.Fields("의류코드") & "', "
        Query = Query & "'" & SUBRs.Fields("의류명") & "', "
        Query = Query & "" & SUBRs.Fields("금액") & ", "
        Query = Query & "'" & "Y" & "', "
        Query = Query & "'" & Format(Date, "YYYY-MM-DD") & "') "
        HostCon.Execute Query
        
        SUBRs.MoveNext
        
        If objPrBar.Value < objPrBar.MAX Then
            objPrBar.Value = objPrBar.Value + 1
        End If
    Loop
    
    Call SendTable_DateSave("TB_가맹점참조코드", HostCon)
    
    SUBRs.Close
    Set SUBRs = Nothing
    
    ' aa = aa & "종료시간: " & CStr(Now) & vbNewLine
    ' aa = aa & "전송수량: " & CStr(SendTable_가맹점정보) & vbNewLine
    ' MsgBox aa
    
    On Error GoTo 0
    
    Exit Function

ErrRtn:
    SendTable_참조코드 = False
    
    Call Error_Msg("SendTable_참조코드", Err.Source, Err.Number, Err.description)
    
    Resume Next
End Function

'====================================================================================================
' Procedure : SendTable_쿠폰정보
' DateTime  : 2008-04-15 20:29
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 기본적으로 최근 1주일 내용을 전송한다.
'====================================================================================================
Public Function SendTable_쿠폰정보(ByVal sSendDate As String, Optional iSendDay As Integer = 0) As Boolean
    Dim iDay    As Integer
    Dim iTempDay    As String
    
    Dim sData(23)   As String
    Dim sCode(1)    As String
    
    'On Error GoTo ErrRtn

    If Trim(가맹점정보.가맹점코드) = "000000" Then
        MsgBox "가맹점 정보가 올바르지 않습니다.", vbCritical, "경고"
        
        'Set ADORset = Nothing
        Exit Function
    End If
        
    If Server_Connection(HostCon) = True Then
        For iDay = 0 To iSendDay
            '실제 전송일자
            iTempDay = DateAdd("d", iDay, sSendDate)
                
            ' 해당 일자의 지사및 체인점 코드를 알아온다.
            Erase sCode
            
            If GetMasterStoreFromToDate(Format(iTempDay, "YYYY-MM-DD"), sCode(0), sCode(1)) = False Then
                ' 본사에서 확인하여 처리할 수 있도록 하기위하여
                ' 지사 정보가 없도라도 전송 처리한다.
            End If
                
            'Set rsTempTb = MyDB.OpenRecordset("SELECT * FROM TB_쿠폰자료 WHERE 접수일자 = '" & Format(iTempDay, "YYYY-MM-DD") & "' ")
        
            Query = "SELECT * FROM TB_쿠폰자료 WHERE 접수일자 = '" & Format(iTempDay, "YYYY-MM-DD") & "' "
            Set SUBRs = New ADODB.Recordset
            SUBRs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
        
            ' 자료가 없으면 종료를 한다.
            Do While Not SUBRs.EOF
                sData(0) = 가맹점정보.가맹점코드 & ""
                sData(1) = Trim(SUBRs!접수일자 & "")
                sData(2) = Trim(SUBRs!쿠폰번호 & "")
                sData(3) = IIf(IsNumeric(SUBRs!쿠폰단가 & ""), SUBRs!쿠폰단가, "0")
                sData(4) = IIf(IsNumeric(SUBRs!쿠폰금액 & ""), SUBRs!쿠폰금액, "0")
                sData(5) = Trim(SUBRs!고객코드 & "")
                sData(6) = Trim(SUBRs!고객이름 & "")
                sData(7) = IIf(IsNumeric(SUBRs!접수금액 & ""), SUBRs!접수금액, "0")
                sData(8) = Trim(SUBRs!택번호 & "")
                
                '------------------------------------------------------------------------
                '
                '------------------------------------------------------------------------
                Query = "SELECT * "
                Query = Query & " FROM CouponUseDataALL "
                Query = Query & " WHERE StoreCode = '" & 가맹점정보.가맹점코드 & "' "
                Query = Query & "   AND SaleDate  = '" & Format(iTempDay, "YYYY-MM-DD") & "' "
                Query = Query & "   AND Number    = '" & Trim(SUBRs!쿠폰번호 & "") & "' "
                Set Rs = New ADODB.Recordset
                Rs.Open Query, HostCon, adOpenStatic, adLockOptimistic
                
                'If ADORset.State = adStateOpen Then ADORset.Close
                '
                'ADORset.CursorLocation = adUseClient
                'ADORset.Open Query, HostCon, adOpenStatic, adLockBatchOptimistic, adCmdText
                
                If Rs.EOF = True Then
                    Query = "INSERT INTO TB_CouponUseDataALL (SaleDate, StoreCode, MASTER_CD, "
                    Query = Query & " Number , Cost, "
                    Query = Query & " Money, CustNum, "
                    Query = Query & " CustName, SaleMoney, StoreTag, "
                    Query = Query & " SendYN, SendDate  )"
                    Query = Query & " VALUES ('" & sData(1) & "', '" & 가맹점정보.가맹점코드 & "', '" & sCode(0) & "', "
                    Query = Query & " '" & sData(2) & "', " & sData(3) & ", " 'Number, Cost
                    Query = Query & " " & sData(4) & ", '" & sData(5) & "', "       'Money, CustNum
                    Query = Query & " '" & sData(6) & "', " & sData(7) & ", '" & sData(8) & "', "  'CustName, SaleMoney, StoreTag"
                    Query = Query & " 'Y', '" & Format(Date, "YYYY-MM-DD") & "' "    'SendYN , SendDate
                    Query = Query & " )"
                    HostCon.Execute Query
                Else
                    If Rs.Fields("SendYN") = "N" Then
                        Query = "UPDATE CouponUseDataALL "
                        Query = Query & " SET Number = '" & sData(2) & "', "
                        Query = Query & " Cost =  " & sData(3) & ", "
                        Query = Query & " Money =  " & sData(4) & ", "
                        Query = Query & " CustNum =  '" & sData(5) & "', "
                        Query = Query & " CustName = '" & sData(6) & "', "
                        Query = Query & " SaleMoney = " & sData(7) & ", "
                        Query = Query & " StoreTag = '" & sData(8) & "', "
                        Query = Query & " SendYN =  'Y', "
                        Query = Query & " SendDate =  '" & Format(Date, "YYYY-MM-DD") & "'  "
                        Query = Query & " WHERE StoreCode = '" & 가맹점정보.가맹점코드 & "' "
                        Query = Query & "   AND MASTER_CD = '" & sCode(0) & "' "
                        Query = Query & "   AND SaleDate = '" & Format(iTempDay, "YYYY-MM-DD") & "' "
                        HostCon.Execute Query
                    End If
                End If
                Rs.Close
                Set Rs = Nothing
                
                SUBRs.MoveNext
            Loop
                
            SUBRs.Close
            Set SUBRs = Nothing
        Next iDay
    End If
    
    Set HostCon = Nothing
    
    SendTable_쿠폰정보 = True

    On Error GoTo 0
    
    Exit Function

ErrRtn:
    SendTable_쿠폰정보 = False
    
    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure SendTable_쿠폰정보 of Module Global"
End Function

Public Function GetSelectSpread(MySS As Object, nCol As Long) As Long
    Dim lRow    As Long
    Dim nSelCnt As Long
    
    nSelCnt = 0
    
    For lRow = 1 To MySS.MaxRows
        MySS.Col = nCol
        MySS.Row = lRow
        
        If MySS.Value = 1 Then nSelCnt = nSelCnt + 1
    Next lRow
    
    GetSelectSpread = nSelCnt
End Function

Public Function Get_CouponMoney(ByVal strCouponNumbar As String) As Double
     Dim dblMoney As Double
    
    Select Case Left(strCouponNumbar, 2)
        Case "02": dblMoney = 50000 ' 모피행사 2009-12-31일가지
        Case "01": dblMoney = 5000  ' LG 타운젠트 행사
        Case "00": dblMoney = 33000 ' 크랜즈겔러리
        Case "05": dblMoney = 3000  ' 삼성전자 (2011-10-07 ~ 2011-12-31)
        Case Else: dblMoney = 5000
    End Select
    
    Get_CouponMoney = dblMoney
    
End Function

Public Function Get_CouponCost(ByVal strCouponNumbar As String) As Double
    Dim dblMoney As Double
    
    Select Case Left(strCouponNumbar, 2)
    
        Case "02"
            ' 모피행사 2009-12-31일가지
            dblMoney = 0
        
        Case "01"
            ' LG 타운젠트 행사
            dblMoney = 3000
            
        Case "00"
            ' 크랜즈겔러리
            dblMoney = 0
        
        Case "05"
            ' 삼성전자 (2011-10-07 ~ 2011-12-31)
            dblMoney = 1800
        
        
        Case Else
            dblMoney = 5000
    End Select
    
    Get_CouponCost = dblMoney
End Function


' 현재 전달된 일자의 쿠폰 금액을 가저온다.
Public Function GetCouponCount(ByVal strDate As String, sCouponCode As String) As Integer
    
    GetCouponCount = 1
    
    Query = "SELECT TOP 1 쿠폰번호 FROM TB_쿠폰자료 "
    Query = Query & " WHERE 접수일자 = '" & strDate & "' "
    Query = Query & " AND LEFT(쿠폰번호,2) = '" & sCouponCode & "' "
    Query = Query & " ORDER BY  쿠폰번호 DESC "
    Set Rs = New ADODB.Recordset
    Rs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    If Not Rs.EOF Then
        GetCouponCount = Val(Right(Rs.Fields("쿠폰번호") & "", 3)) + 1
    End If
    Rs.Close
    Set Rs = Nothing

End Function


' 현재 전달된 일자의 쿠폰 금액을 가저온다.
Public Function GetCouponSaleTotalMoney(ByVal strDate As String, ByRef CouponCnt As Integer) As Double
    Dim dblMoney As Double
    
    dblMoney = 0
    
    Query = "SELECT 쿠폰번호 FROM TB_쿠폰자료 "
    Query = Query & " WHERE 접수일자 = '" & strDate & "' "
    Set Rs = New ADODB.Recordset
    Rs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    If Not Rs.EOF Then
        Rs.MoveLast
        
        CouponCnt = CStr(Rs.RecordCount)
        
        Rs.MoveFirst
        
        Do Until Rs.EOF
            dblMoney = dblMoney + Get_CouponMoney(CStr(Rs.Fields("쿠폰번호")) & "")
            
            Rs.MoveNext
        Loop
    End If
    Rs.Close
    Set Rs = Nothing
    
    GetCouponSaleTotalMoney = dblMoney
End Function


' 현재 전달된 일자의 쿠폰 금액을 가저온다.
Public Function GetCouponSaleTotalMoney2(ByVal strDate As String) As Double
    Dim sTemp     As String
    Dim Index     As Integer
    Dim dblMoney  As Double
    Dim dCost     As Double
    Dim sSale     As Double
    Dim sNum(99)  As Integer

    dblMoney = 0
    
    Erase sNum
    
    Query = "SELECT 쿠폰번호  FROM TB_쿠폰자료 "
    Query = Query & " WHERE 접수일자 = '" & strDate & "' "
    Set Rs = New ADODB.Recordset
    Rs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    Do Until Rs.EOF
        sTemp = Left(Rs.Fields("쿠폰번호") & "", 2)
        
        sNum(Val(sTemp)) = sNum(Val(sTemp)) + 1
        
        Rs.MoveNext
    Loop
    Rs.Close
    Set Rs = Nothing
    
    For Index = 0 To 99
        If sNum(Index) > 0 Then
            dCost = Get_CouponCost(Format(Index, "00"))
            sSale = Get_CouponMoney(Format(Index, "00"))
            
            dblMoney = dblMoney + (sNum(Index) * (sSale - dCost))
        End If
    Next Index
    
    GetCouponSaleTotalMoney2 = dblMoney
End Function

Public Function ReadSendTextMessage(cboSendText As Object) As Boolean
    cboSendText.Clear
    
    If 가맹점정보.SMS_EMART = "Y" Then
        cboSendText.AddItem "고객님 세탁물이 도착했습니다. 인수 부탁 드립니다. 즐겁고 행복한 하루 되세요."
        cboSendText.AddItem "고객님 세탁물을 보관 중입니다. 인수 부탁 드립니다. 즐겁고 행복한 하루 되세요."
        cboSendText.AddItem "고객님 세탁물을 보관 중입니다. 보관 중 먼지가 쌓일 수 있으니 빠른 인수 바랍니다."
        cboSendText.AddItem "고객님 크린에이드를 이용해 주셔서 감사 드립니다. 즐겁고 행복한 하루 되세요."
        cboSendText.AddItem "고객님 금일 크린에이드 이용중에 불편 드렸던 점 진심으로 사과 드립니다."
        cboSendText.AddItem "고객님 접수하신 세탁물이 다소 지연되고 있습니다. 도착하는 대로 연락 드리겠습니다"
        cboSendText.AddItem "고객님 접수하신 세탁물이 반품되어 확인이 필요합니다. 내방 부탁 드립니다."
        cboSendText.AddItem "고객님 죄송합니다.^^ 고객님께 메시지전송이 오류로 발송되었습니다. 감사합니다."
        
'        cboSendText.AddItem "고객님 세탁물이 도착했습니다. 조속한 시일 내에 인수 부탁 드립니다."
'        cboSendText.AddItem "고객님 크린에이드를 이용해 주신 점 감사 드립니다.즐겁고 행복한 하루 되세요."
'        cboSendText.AddItem "고객님 금일 크린에이드 이용 중에 불편 드렸던 점 진심으로 사과 드립니다."
'        cboSendText.AddItem "고객님 접수하신 세탁물이 다소 지연되고 있습니다.도착하는 대로 연락 드리겠습니다."
'        cboSendText.AddItem "고객님 접수하신 세탁물이 반품되어 확인이 필요합니다. 내방 부탁 드립니다."
    Else
        Query = "SELECT * FROM TB_문자발송문 "
        Query = Query & " ORDER BY 순번 "
        Set SUBRs = New ADODB.Recordset
        SUBRs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
    
        If SUBRs.EOF Then
            SUBRs.Close
            Set SUBRs = Nothing
            
            Query = "INSERT INTO TB_문자발송문 VALUES('01', '" & "전할 메시지를 입력하여 주십시요" & "') "
            ADOCon.Execute Query
        
            '--------------------------------------------
            Query = "SELECT * FROM TB_문자발송문 "
            Query = Query & " ORDER BY 순번 "
            Set SUBRs = New ADODB.Recordset
            SUBRs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
        End If
        
        While Not SUBRs.EOF
            cboSendText.AddItem Trim(SUBRs!내용) & ""
            cboSendText.ItemData(cboSendText.ListCount - 1) = Val(SUBRs!순번) & ""
            
            SUBRs.MoveNext
        Wend
        
        SUBRs.Close
        Set SUBRs = Nothing
    End If
        
    ' 마지막 문구 선택
    If cboSendText.ListCount > 0 Then
        cboSendText.ListIndex = 0
    End If
End Function

'====================================================================================================
' Procedure : SendTable_참조코드
' DateTime  : 2008-05-03 01:42
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 전달된 일자부터 현재일자까지의 고객정보를 본사 SQL 서버에 저장한다.
'====================================================================================================
Public Function SendTable_사고품(ByVal sStartDate As String, ByRef HostCon As Object, ByRef objPrBar As Object) As Long
    On Error GoTo ErrRtn
    
    If IsDate(sStartDate) = False Then
        MsgBox "전달된 일자가 올바르지 않습니다.  [" & sStartDate & "]", vbCritical, "경고"
        Exit Function
    End If
     
     SendTable_사고품 = 0
    
    ' 미전송 자료를 구한다.
    Query = "SELECT * FROM TB_사고품"
    Query = Query & " WHERE 본사전송여부 <> 'Y'"
    Query = Query & "    OR  접수일자    >= '" & Format(sStartDate, "YYYY-MM-DD") & "'"
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    ' 미전송 자료가 없으면 종료를 한다.
    If Not SUBRs.EOF Then
        SUBRs.MoveLast
        
        objPrBar.MAX = SUBRs.RecordCount
        
        SUBRs.MoveFirst
    End If
    
    Do While Not SUBRs.EOF
        Query = "EXEC PRO_P_06004_01 "
        Query = Query & "'" & Replace(SUBRs!접수일자, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!일련번호, vbNullChar, "") & "', "
        Query = Query & "'" & 가맹점정보.가맹점코드 & "', "
        Query = Query & "'" & 가맹점정보.지사코드 & "', "
        Query = Query & "'" & Replace(SUBRs!성명, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!고객전화, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!주소, Chr(2), "") & "', "
        Query = Query & "'" & Replace(SUBRs!휴대전화, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!의류명, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!상표, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!구입일자, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!색상, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!구입처, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!최초택번호, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!최종택번호, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!구입형태, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!최초입고일, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!최종입고일, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!구입가격, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!사고접수일, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!사고종류, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!사고내용, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!사고의견, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!보상금액, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!합의금액, vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!처리유무, vbNullChar, "") & "' "
        HostCon.Execute Query
        
        '---------------------------------------------------------------
        '
        '---------------------------------------------------------------
        Query = "UPDATE TB_사고품 SET 본사전송여부 = 'Y'  "
        Query = Query & " WHERE 일련번호 = " & SUBRs!일련번호
        ADOCon.Execute Query
        
        If objPrBar.Value < objPrBar.MAX Then
            objPrBar.Value = objPrBar.Value + 1
        End If
        
        SUBRs.MoveNext
    Loop
    
    Call SendTable_DateSave("사고품", HostCon)
    
    SUBRs.Close
    Set SUBRs = Nothing
    
    On Error GoTo 0
    
    Exit Function

ErrRtn:
    SendTable_사고품 = 0
    
    Call Error_Msg("SendTable_사고품", Err.Source, Err.Number, Err.description)
    
    Resume Next
End Function



'====================================================================================================
' Procedure : SendTable_입출고
' DateTime  : 2008-05-03 01:42
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 전달된 일자부터 현재일자까지의 입출고 내요을 본사 SQL 서버에 저장한다.
'====================================================================================================
Public Function SendTable_입출고(ByVal sStartDate As String, ByRef HostCon As Object, ByRef objPrBar As Object) As Long
    On Error GoTo SendTable_입출고_Error
    
    If IsDate(sStartDate) = False Then
        MsgBox "전달된 일자가 올바르지 않습니다.  [" & sStartDate & "]", vbCritical, "경고"
        Exit Function
    End If
     
     SendTable_입출고 = 0
    
    '-------------------------------------------------------------------------------------------------------------
    ' 미전송 자료를 구한다. ' 최초 너무 많은 자료 전송을 막기 위하여 2009-08-01일을 기준으로 정한다.
    '-------------------------------------------------------------------------------------------------------------
    'Query = "SELECT * FROM TB_입출고 "
    'Query = Query & " WHERE (iif( 본사전송여부  is null , 'N',본사전송여부) <> 'Y'  and 접수일자 >= '2009-08-01')  "
    'Query = Query & "   AND  접수일자 >= '" & Format(sStartDate, "YYYY-MM-DD") & "' "
    'Query = Query & "   AND ( 의류코드 LIKE 'a%' OR  세탁환불일자 <> '') "
    'Query = Query & "    OR  left(세탁환불일자,8) = '" & Format(sStartDate, "YYYY-MM-DD") & "' "
    
    Query = "SELECT * FROM TB_입출고"
    Query = Query & " WHERE (CASE 본사전송여부 WHEN Null THEN 'N' ELSE 본사전송여부 END) <> 'Y'"
    Query = Query & "   AND  접수일자 >= '" & Format(sStartDate, "YYYY-MM-DD") & "' "
    Query = Query & "   AND ( 의류코드 LIKE 'a%' OR  세탁환불일자 <> '') "
    Query = Query & "    OR SUBSTRING(세탁환불일자,1,10) = '" & Format(sStartDate, "YYYY-MM-DD") & "' "
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    ' 미전송 자료가 없으면 종료를 한다.
    If Not SUBRs.EOF Then
        SUBRs.MoveLast
        
        objPrBar.MAX = SUBRs.RecordCount
        
        SUBRs.MoveFirst
    End If
    
    Do While Not SUBRs.EOF
        Query = "EXEC PRO_A_00005 "
        Query = Query & "'" & 가맹점정보.가맹점코드 & "', "
        Query = Query & "'" & Replace(SUBRs!접수일자 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!택번호 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!고객코드 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!의류코드 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!의류명 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!색상 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!내용 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!금액 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!상표 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!지사출고상태 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!결제여부 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!확인 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!출고일자 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!판매취소 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!예정일자 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!반품환불일자 & "", vbNullChar, "") & "', "
        Query = Query & "" & Replace(Val(SUBRs!수선금액 & ""), vbNullChar, "") & ", "
        Query = Query & "'" & Replace(SUBRs!지사출고일자 & "", vbNullChar, "") & "', "
        Query = Query & "'" & Replace(SUBRs!가맹점입고구분 & "", vbNullChar, "") & "', "
        Query = Query & " " & Replace(Val(SUBRs!외주마진 & ""), vbNullChar, "") & ", "
        Query = Query & "'" & Replace(SUBRs!세탁환불일자 & "", vbNullChar, "") & "'  "
        HostCon.Execute Query
        
        '-------------------------------------------------------------------------
        '
        '-------------------------------------------------------------------------
        Query = "UPDATE TB_입출고 SET 본사전송여부 = 'Y'  "
        Query = Query & " WHERE 접수일자 = '" & SUBRs!접수일자 & "' "
        Query = Query & "   AND 택번호   = '" & SUBRs!택번호 & "'"
        ADOCon.Execute Query
        
        If objPrBar.Value < objPrBar.MAX Then
            objPrBar.Value = objPrBar.Value + 1
        End If
        
        SUBRs.MoveNext
    Loop
    
    Call SendTable_DateSave("입출고", HostCon)
    
    SUBRs.Close
    Set SUBRs = Nothing
    
    On Error GoTo 0
    
    Exit Function

SendTable_입출고_Error:
    SendTable_입출고 = 0
    
    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure SendTable_입출고 of Module Global"
    
    Resume Next
End Function


'====================================================================================================
' Procedure : SendTable_입출고
' DateTime  : 2008-05-03 01:42
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 전달된 일자부터 현재일자까지의 입출고 내요을 본사 SQL 서버에 저장한다.
'====================================================================================================
Public Function SendTable_메시지(ByVal sStartDate As String, ByRef HostCon As Object, ByRef objPrBar As Object) As Long
    'On Error GoTo ErrRtn
    
    If IsDate(sStartDate) = False Then
        MsgBox "전달된 일자가 올바르지 않습니다.  [" & sStartDate & "]", vbCritical, "경고"
        Exit Function
    End If
     
    SendTable_메시지 = 0
    
    
    '------------------------------------------------------------------------------
    ' 미전송 자료를 구한다.
    ' 최초 너무 많은 자료 전송을 막기 위하여 2009-08-01일을 기준으로 정한다.
    '------------------------------------------------------------------------------
    Query = "SELECT * FROM TB_공지사항 "
    Query = Query & " WHERE (CASE 본사전송여부 WHEN Null THEN 'N' ELSE 본사전송여부 END) <> 'Y' "
    'Query = Query & " WHERE IIF(ISNULL(전송여부) ,'N',전송여부) <> 'Y' "
    Set Rs = New ADODB.Recordset
    Rs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
    
    ' 미전송 자료가 없으면 종료를 한다.
    If Not Rs.EOF Then
        Rs.MoveLast
        
        objPrBar.MAX = Rs.RecordCount
        
        Rs.MoveFirst
    End If
    
    Do While Not Rs.EOF
        ' MailType, MailDate, MailNo, AgencyCode, MailFrom, MailTo, MailDesc, ReadChk, ReadDate, SendChk
        
        '----------------------------------------------------------------------------
        '
        '----------------------------------------------------------------------------
        Query = "UPDATE Mail_ALL SET "
        Query = Query & " ReadChk  = '" & Rs.Fields("수신여부") & "', "
        Query = Query & " ReadDate = '" & Rs.Fields("수신일자") & "' "
        Query = Query & " WHERE MailType   = '2' "
        Query = Query & "   AND MailDate   = '" & Rs.Fields("작성일자") & "' "
        Query = Query & "   AND MailNo     = " & Val(Rs.Fields("문서번호")) & " "
        Query = Query & "   AND AgencyCode = '" & 가맹점정보.가맹점코드 & "' "
        HostCon.Execute Query
        
        '----------------------------------------------------------------------------
        '
        '----------------------------------------------------------------------------
        Query = "UPDATE TB_공지사항 SET 본사전송여부 = 'Y' "
        Query = Query & " WHERE 작성일자 = '" & Rs.Fields("작성일자") & "" & "' "
        Query = Query & "   AND 문서번호 =  " & Rs.Fields("문서번호") & "" & " "
        ADOCon.Execute Query
    
        If objPrBar.Value < objPrBar.MAX Then
            objPrBar.Value = objPrBar.Value + 1
        End If
        
        Rs.MoveNext
    Loop
    
    Rs.Close
    Set Rs = Nothing
    
    On Error GoTo 0
    
    Exit Function

ErrRtn:
    SendTable_메시지 = 0
    
    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure SendTable_메시지 of Module Global"
End Function


Public Function SendTable_세트응모번호(ByVal sStartDate As String, ByRef HostCon As Object, ByRef objPrBar As Object) As Long
    Dim sValue(7) As String
    
    On Error GoTo ErrRtn
    
    If IsDate(sStartDate) = False Then
        MsgBox "전달된 일자가 올바르지 않습니다.  [" & sStartDate & "]", vbCritical, "경고"
        Exit Function
    End If
     
    SendTable_세트응모번호 = 0
    
    '--------------------------------------------------------------------------------
    '
    '--------------------------------------------------------------------------------
    Query = "SELECT * FROM TB_세트응모번호 "
    Query = Query & " WHERE SendDate = '' "
    Set SUBRs = New ADODB.Recordset
    SUBRs.Open Query, ADOCon, adOpenStatic, adLockOptimistic
        
    ' 미전송 자료가 없으면 종료를 한다.
    If Not SUBRs.EOF Then
        SUBRs.MoveLast
        
        objPrBar.MAX = SUBRs.RecordCount
        
        SUBRs.MoveFirst
    End If
    
    Do While Not SUBRs.EOF
        sValue(0) = 가맹점정보.가맹점코드
        sValue(1) = SUBRs.Fields("응모번호") & ""
        sValue(2) = SUBRs.Fields("세트Key") & ""
        sValue(3) = SUBRs.Fields("일자") & ""
        sValue(4) = SUBRs.Fields("고객코드") & ""
        sValue(5) = SUBRs.Fields("고객명") & ""
        sValue(6) = SUBRs.Fields("고객전화번호") & ""
        sValue(7) = SUBRs.Fields("휴대전화") & ""
        
        Query = "EXEC PRO_GROUPGOODS_NUMBER_SEND "
        Query = Query & "  '" & sValue(0) & "'"
        Query = Query & ", '" & sValue(1) & "'"
        Query = Query & ", '" & sValue(2) & "'"
        Query = Query & ", '" & sValue(3) & "'"
        Query = Query & ", '" & sValue(4) & "'"
        Query = Query & ", '" & sValue(5) & "'"
        Query = Query & ", '" & sValue(6) & "'"
        Query = Query & ", '" & sValue(7) & "'"
        HostCon.Execute Query
        
        
        Query = "UPDATE TB_세트응모번호 SET SendDate = '" & Format(Date, "YYYY-MM-DD") & "'"
        Query = Query & " WHERE 응모번호 = '" & SUBRs.Fields("응모번호") & "" & "' "
        ADOCon.Execute Query
    
        If objPrBar.Value < objPrBar.MAX Then
            objPrBar.Value = objPrBar.Value + 1
        End If
        
        SUBRs.MoveNext
    Loop
    SUBRs.Close
    Set SUBRs = Nothing
    
    On Error GoTo 0
    
    Exit Function

ErrRtn:
    SendTable_세트응모번호 = 0
    
    Call Error_Msg("SendTable_세트응모번호", Err.Source, Err.Number, Err.description)
    
    'MsgBox "Error " & Err.Number & " (" & Err.Description & ") in procedure SendTable_세트응모번호 of Module Global"
End Function

'---------------------------------------------------------------------------
' 함수명 : Error_Msg
' 기  능 :
' 설  명 :
'---------------------------------------------------------------------------
Public Sub Error_Msg(strEvent As String, strSource As String, strNumber As String, strDescription As String)
    Dim FileNum As Integer
    Dim Err_Msg As String
        
'********************************************************************************************
    FileNum = FreeFile
    
    If Dir(AppPath & "ErrFile", vbDirectory) = "" Then
        MkDir AppPath & "ErrFile"
    End If

    Open AppPath & "ErrFile\" & Format(Date, "YYYYMMDD") & ".txt" For Append As #FileNum
        
    Print #FileNum, "발생시간 : " & Format(Now, "YYYY-MM-DD hh:mm:ss")
    Print #FileNum, "발생위치 : " & strEvent
    Print #FileNum, "오류소스 : " & strSource
    Print #FileNum, "오류번호 : " & strNumber
    Print #FileNum, "오류내용 : " & strDescription
    Print #FileNum, "=============================================================="
    Close #FileNum
'********************************************************************************************

              Err_Msg = "발생위치 : " & strEvent & vbNewLine & vbNewLine
    Err_Msg = Err_Msg & "오류소스 : " & strSource & vbNewLine & vbNewLine
    Err_Msg = Err_Msg & "오류번호 : " & strNumber & vbNewLine & vbNewLine
    Err_Msg = Err_Msg & "오류내용 : " & strDescription
    
    MsgBox Err_Msg, vbCritical, "오류"
    
    Screen.MousePointer = 0
End Sub

Public Sub Error_Msg2(strEvent As String, strSource As String, strNumber As String, strDescription As String)
    Dim FileNum As Integer
    Dim Err_Msg As String
        
'********************************************************************************************
    FileNum = FreeFile
    
    If Dir(AppPath & "ErrFile", vbDirectory) = "" Then
        MkDir AppPath & "ErrFile"
    End If

    Open AppPath & "ErrFile\" & Format(Date, "YYYYMMDD") & ".txt" For Append As #FileNum
        
    Print #FileNum, "발생시간 : " & Format(Now, "YYYY-MM-DD hh:mm:ss")
    Print #FileNum, "발생위치 : " & strEvent
    Print #FileNum, "오류소스 : " & strSource
    Print #FileNum, "오류번호 : " & strNumber
    Print #FileNum, "오류내용 : " & strDescription
    Print #FileNum, "=============================================================="
    Close #FileNum
'********************************************************************************************

              Err_Msg = "발생위치 : " & strEvent & vbNewLine & vbNewLine
    Err_Msg = Err_Msg & "오류소스 : " & strSource & vbNewLine & vbNewLine
    Err_Msg = Err_Msg & "오류번호 : " & strNumber & vbNewLine & vbNewLine
    Err_Msg = Err_Msg & "오류내용 : " & strDescription
    
    'MsgBox Err_Msg, vbCritical, "오류"
    
    Screen.MousePointer = 0
End Sub

Public Function TAG_Convert(Tag As String) As String
    Dim TAG_Cnt As Integer
    Dim Tmp_TAG As String
    
    Tmp_TAG = ""
    TAG_Cnt = Len(Tag)
    
    For TAG_Cnt = 1 To TAG_Cnt
        If IsNumeric(Mid(Tag, TAG_Cnt, 1)) Then
            Tmp_TAG = Tmp_TAG & Mid(Tag, TAG_Cnt, 1)
        End If
    Next TAG_Cnt
    
    TAG_Convert = Tmp_TAG
End Function

'----------------------------------------------------------------
' String에 Single Quote가 존재할 경우 Single Quote를 두개로 만듦.
'----------------------------------------------------------------
Public Function SubSQuotA(parStr As String) As String
    Dim lenStr As Long
    Dim i      As Long
    Dim bufStr As String

    SubSQuotA = parStr
    
    If InStr(parStr, "'") = 0 Then Exit Function
    
    lenStr = Len(parStr)
    
    bufStr = ""

    For i = 1 To lenStr
        bufStr = bufStr & IIf(Mid(parStr, i, 1) = "'", "''", Mid(parStr, i, 1))
    Next i
    
    SubSQuotA = bufStr
End Function

Public Sub Spread_SetData(Spread As fpSpread, iRow As Long, iCol As Long, strData As Variant)
    Spread.Row = iRow
    Spread.Col = iCol
    Spread.Text = strData & ""
End Sub

Public Function Spread_GetData(Spread As fpSpread, iRow As Long, iCol As Long, Optional Character As Boolean = True) As String
    Spread.Row = iRow
    Spread.Col = iCol
    
    If Character = True Then
        Spread_GetData = Trim(Spread.Text) & ""  '문자형
    Else
        Spread_GetData = Spread.Value & "" '숫자형
    End If
End Function

Public Sub 고객등급_Display(Combo As Object, Optional 전체 As Boolean = False)
    Query = "SELECT * FROM TB_고객등급"
    Query = Query & " ORDER BY 순서"
    Set ADORs = New ADODB.Recordset
    ADORs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
    
    With Combo
        .Clear
    
        If 전체 = True Then
            .AddItem "-전체-": .ItemData(.NewIndex) = 0
        End If
        
        Do Until ADORs.EOF
            .AddItem ADORs!고객등급코드 & "- " & ADORs!고객등급명 & ""
        
            ADORs.MoveNext
        Loop
        ADORs.Close
        Set ADORs = Nothing
        
        If .ListCount > 0 Then .ListIndex = 0
    End With
End Sub

'-----------------------------------------------------------------------------------
' 한수명 : TelePhone_Number
' 내  용 :
'-----------------------------------------------------------------------------------
Public Function TelePhone_Number(Tel As String) As String
    Dim PhoneNum As String
    
    'PhoneNum = Trim(Replace(Tel, "-", ""))
    PhoneNum = gGet_Number(Tel)

    Select Case Left(PhoneNum, 2)
        Case "01", "03"
            Select Case Len(PhoneNum)
                Case 10:   TelePhone_Number = Left(PhoneNum, 3) & "-" & Mid(PhoneNum, 4, 3) & "-" & Right(PhoneNum, 4)
                Case 11:   TelePhone_Number = Left(PhoneNum, 3) & "-" & Mid(PhoneNum, 4, 4) & "-" & Right(PhoneNum, 4)
                Case Else: TelePhone_Number = Tel
            End Select
        
        Case "02"
            Select Case Len(PhoneNum)
                Case 9:    TelePhone_Number = Left(PhoneNum, 2) & "-" & Mid(PhoneNum, 3, 3) & "-" & Right(PhoneNum, 4)
                Case 10:   TelePhone_Number = Left(PhoneNum, 2) & "-" & Mid(PhoneNum, 3, 4) & "-" & Right(PhoneNum, 4)
                Case Else: TelePhone_Number = Tel
            End Select
        
        Case Else
            Select Case Len(PhoneNum)
                Case 7:    TelePhone_Number = Left(PhoneNum, 3) & "-" & Right(PhoneNum, 4)
                Case 8:    TelePhone_Number = Left(PhoneNum, 4) & "-" & Right(PhoneNum, 4)
                Case 10:   TelePhone_Number = Left(PhoneNum, 3) & "-" & Mid(PhoneNum, 4, 3) & "-" & Right(PhoneNum, 4)
                Case 11:   TelePhone_Number = Left(PhoneNum, 3) & "-" & Mid(PhoneNum, 4, 4) & "-" & Right(PhoneNum, 4)
                Case Else: TelePhone_Number = Tel
            End Select
    End Select
End Function

'-----------------------------------------------------------------------------------
' 한수명 : gGet_Number
' 내  용 : 숫자외에 모든문자를 제거한다.
'-----------------------------------------------------------------------------------
Public Function gGet_Number(ByRef strReturn As String) As String
    Dim i      As Integer
    Dim strNum As String
    Dim strTmp As String

    strNum = ""
    
    For i = 1 To Len(strReturn)
        strTmp = Mid(strReturn, i, 1)
        
        If Asc(strTmp) >= 48 And Asc(strTmp) <= 57 Then '숫자라면
            strNum = strNum & strTmp
        End If
    Next i

    gGet_Number = strNum
End Function


Public Function Recordset_Result(Query As String) As Long
    On Error GoTo ErrRtn
    
    Set ADORs = New ADODB.Recordset
    ADORs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
    
    Recordset_Result = ADORs(0)
    
    ADORs.Close
    Set ADORs = Nothing

    Exit Function
    
ErrRtn:
    Recordset_Result = 0
End Function


Public Function fnc_MoveForm(myForm As Form)

    DoEvents
    
    Select Case UCase(myForm.Name)
    
        Case "FRM고객검색"
            myForm.Left = frmMain.Left + (frmMain.Width - myForm.Width) / 2
            myForm.Top = frmMain.Top + (frmMain.Height - myForm.Height) / 2
        
        Case Else
            myForm.Left = frmMain.Left + (frmMain.Width - myForm.Width) / 2
            myForm.Top = frmMain.Top + (frmMain.Height - myForm.Height) / 2
                    
    End Select

End Function


'------------------------------------------------------------
' TB_고객정보 - 누적된 마일리지를 차감한다.
'------------------------------------------------------------
Public Function Fnc_마일리지삭제(sCustCode As String, Mile As Long) As Boolean
    Dim 총누적마일리지 As Long
    Dim 누적마일리지 As Long
    Dim 사용가능마일리지 As Long
    Dim Query As String
    Dim ADORs As ADODB.Recordset
    
    '------------------------------------------------------------
    ' TB_입출고
    '------------------------------------------------------------
    Query = "SELECT 누적마일리지, 사용가능마일리지  FROM TB_고객정보"
    Query = Query & " WHERE  고객코드 = '" & sCustCode & "'"
    Set ADORs = New ADODB.Recordset
    ADORs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
    
    If Not ADORs.EOF Then
    
        총누적마일리지 = Val(ADORs.Fields("누적마일리지")) + Val(ADORs.Fields("사용가능마일리지"))
    
        '삭제 마일리지가 누적 마일리지보다 적을 경우 누적 마일리지에서 바로 처리한다
        If Mile <= Val(ADORs.Fields("누적마일리지")) Then
            Query = "UPDATE TB_고객정보 SET 누적마일리지 = 누적마일리지 - " & CStr(Mile)
            Query = Query & " WHERE 고객코드 = '" & sCustCode & "'"
            ADOCon.Execute Query
        
        ' 누적 마일리지가 적을 경우 사용가능 마일리지에서 가저와서 삭제 처리한다.
        ElseIf Mile < 총누적마일리지 Then
        
            ' 전체 마일리지에서 삭제분을 제외하고 다시 사용가능 마일리지를 구한다.
            총누적마일리지 = 총누적마일리지 - Mile
            Call Fnc_마일리지누적사용(총누적마일리지, 누적마일리지, 사용가능마일리지)
        
        
            Query = "UPDATE TB_고객정보 SET 누적마일리지 = " & 누적마일리지
            Query = Query & "             , 사용가능마일리지 = " & 사용가능마일리지
            Query = Query & " WHERE 고객코드 = '" & sCustCode & "'"
            ADOCon.Execute Query
    
        ' 이외의 경우에는 문제가 있다.
        ' 사용가능 마일리지가 발생한후 해당 마일리지를 사용한 후 세탁환불, 반품환불을 한경우
        Else
        
        
        End If
    End If
    ADORs.Close:    Set ADORs = Nothing

End Function


Public Function Fnc_마일리지누적사용(TmpValue As Long, 누적마일리지 As Long, 사용가능마일리지 As Long) As Boolean
    ' 최소마일리지 = 적립하여 사용가능한 금액 (3,000원)
    Dim 사용마일리지    As Long
    사용마일리지 = 0

    If 가맹점정보.마일리지여부 = "Y" Then
        If TmpValue >= 가맹점정보.최소마일리지 Then
            If 가맹점정보.최소마일리지 > 0 Then
                누적마일리지 = (TmpValue Mod 가맹점정보.최소마일리지)
            Else
                ' 최소 마일리지가 0보다 적을 경우는 사용가능 마일리지로 처리되기 때문에 누적 마일리지로 저장하면 안된다.
                '누적마일리지 = TmpValue
            End If
            
            If 가맹점정보.최소마일리지 > 0 Then
                '사용가능마일리지 = 마일리지.사용가능마일리지 + (TmpValue - (TmpValue Mod 최소마일리지)) '오류 x
                사용가능마일리지 = (TmpValue - (TmpValue Mod 가맹점정보.최소마일리지))
            Else
                ' 사용가능마일리지 = (마일리지.사용가능마일리지 - 사용마일리지) + TmpValue
                사용가능마일리지 = TmpValue
            End If
        Else
            누적마일리지 = TmpValue
            사용가능마일리지 = 0
        End If
        
    ' 마일리지를 적용하지 않을 경우
    ' pds2004 수정 2011-12-12일
    Else
        누적마일리지 = 0
        사용가능마일리지 = 0
    End If


End Function



' 5원 이상은 반올림한다.
Public Function GetNumber5UP(Price As Double) As Double
  GetNumber5UP = Int((Price + (10 - 5)) / 10) * 10
End Function

' 50원 이상은 반올림한다.
Public Function GetNumber50UP(Price As Double) As Double
  GetNumber50UP = Int((Price + (100 - 50)) / 100) * 100
End Function

' 500원 이상은 반올림한다.
Public Function GetNumber500UP(Price As Double) As Double
    GetNumber500UP = Int((Price + (1000 - 500)) / 1000) * 1000
End Function



' 전달된 콤보박스에서 해당 문자열의 길이만큼 검색하여 자동 선택되게 한다.
' 못찾을경우 -1을 리턴하고 찾을 경우 해당 선택된 것을 리턴한다.
Public Function cboSelectText(ByRef MyCbo As Object, ByVal sSelectText As String, _
                                ByVal iLength As Integer, Optional ByVal sLeft As Boolean = True) As Integer
    Dim i As Integer
    
    cboSelectText = -1
    
    If iLength = 0 Then iLength = Len(sSelectText)
    If iLength = 0 Then Exit Function
    
    For i = 0 To MyCbo.ListCount - 1
        If sLeft = True Then
            If sSelectText = Left(MyCbo.List(i), iLength) Then
                MyCbo.ListIndex = i
                cboSelectText = MyCbo.ListIndex
                Exit Function
            End If
        Else
            If sSelectText = Right(MyCbo.List(i), iLength) Then
                MyCbo.ListIndex = i
                cboSelectText = MyCbo.ListIndex
                Exit Function
            End If
        End If
    
    Next i

End Function


Private Sub 공지사항파일_Download(sDate As String, sDouNum As String)
    Dim sFilename As String
    On Error GoTo ErrRtn
        
    If Server_Connection(HostCon, "LAUNDRY1000") = False Then Exit Sub
    
    ' 본사 서버의 파일을 PC에 저장한다.
    sFilename = DataPCSaveFile(sDate, sDouNum, HostCon)
    If sFilename = "" Then Exit Sub
    
    ' PC에 저장된 파일을 PC 서버에 저장한다.
    Call DataSqlSaveFile(sDate, sDouNum, sFilename)


    Exit Sub
    
ErrRtn:

End Sub

Public Function DataPCSaveFileView(sDate As String, sDocNum As String, MyObj As RichTextBox) As String
    Dim sFileFullName   As String

    On Error GoTo ERR_RTN

    DataPCSaveFileView = ""
    MyObj.Text = ""
    sFileFullName = DataPCSaveFile(sDate, sDocNum, ADOCon)
    If sFileFullName = "" Then
        Call 공지사항파일_Download(sDate, sDocNum)
    
        ' 다시 한번 읽는다.
        sFileFullName = DataPCSaveFile(sDate, sDocNum, ADOCon)
    
    End If
    
    If sFileFullName = "" Then Exit Function
    
    If Dir(sFileFullName, vbDirectory) <> "" Then
        MyObj.LoadFile sFileFullName, rtfRTF
    End If
    
    DataPCSaveFileView = sFileFullName
    Exit Function

ERR_RTN:
    Call Error_Msg("", Err.Source, Err.Number, Err.description)

End Function

' 전달된 내용의 파일을 PC에 파일로 저장한다.
Public Function DataPCSaveFile(sDate As String, sDocNum As String, MyCon As ADODB.Connection) As String
    Dim ADOStream   As ADODB.Stream
    Dim SSQL        As String
    Dim Any_Rs      As ADODB.Recordset
    Dim sFileFullName As String

    On Error GoTo ERR_RTN

    If Dir(App.Path & "\Temp", vbDirectory) = "" Then MkDir App.Path & "\Temp"
    sFileFullName = App.Path & "\Temp\" & sDate & sDocNum
    
    Set Any_Rs = New ADODB.Recordset
    Set ADOStream = New ADODB.Stream

    SSQL = "SELECT  문서파일 FROM TB_공지사항파일  "
    SSQL = SSQL & " WHERE 작성일자 = '" & sDate & "'"
    SSQL = SSQL & "   AND 문서번호 = " & sDocNum & ""
    Any_Rs.Open SSQL, MyCon, adOpenDynamic, adLockOptimistic

    If Not Any_Rs.EOF Then
        If Len(Any_Rs.Fields(0)) > 0 Then
            ADOStream.Type = adTypeBinary
            ADOStream.Open
            ADOStream.Write Any_Rs.Fields(0)
    
            ADOStream.SaveToFile sFileFullName, adSaveCreateOverWrite
        End If
    Else
        sFileFullName = ""
    End If
    Any_Rs.Close

    Set Any_Rs = Nothing
    Set ADOStream = Nothing
    
    DataPCSaveFile = sFileFullName
    Exit Function

ERR_RTN:
    DataPCSaveFile = ""
    Call Error_Msg("", Err.Source, Err.Number, Err.description)

    Set Any_Rs = Nothing
    Set ADOStream = Nothing

End Function

'전달된 파일을 PC 서버에 저장한다.
Private Sub DataSqlSaveFile(sDate As String, sDocNum As String, sFilename As String)
    Dim ADOStream   As ADODB.Stream
    Dim SSQL        As String
    Dim Any_Rs      As ADODB.Recordset
    
    On Error GoTo ERR_RTN
    
    Set Any_Rs = New ADODB.Recordset
    Set ADOStream = New ADODB.Stream
     
    SSQL = "SELECT  작성일자, 문서번호, 문서파일 FROM TB_공지사항파일  "
    SSQL = SSQL & " WHERE 작성일자 = '" & sDate & "'"
    SSQL = SSQL & "   AND 문서번호 = " & sDocNum & ""
    Any_Rs.Open SSQL, ADOCon, adOpenDynamic, adLockOptimistic
    
    If Any_Rs.EOF Then
        Any_Rs.AddNew
        Any_Rs!작성일자 = sDate
        Any_Rs!문서번호 = sDocNum
    End If
    
    With ADOStream
        .Type = adTypeBinary
        .Open
        
        If Trim(sFilename) <> "" Then
            .LoadFromFile sFilename
            Any_Rs.Fields("문서파일") = .Read
        Else
            Any_Rs!Fields("문서파일") = Null
        End If
        
    End With
    
    Any_Rs.Update
    Any_Rs.Close
    
    Set Any_Rs = Nothing
    Set ADOStream = Nothing
    
    Exit Sub

ERR_RTN:
    
    Call Error_Msg("", Err.Source, Err.Number, Err.description)

    Set Any_Rs = Nothing
    Set ADOStream = Nothing


End Sub



Public Function Fn_결제마일리지금액(sSaleDate As String, sCustCode As String, sID As String) As Double
    Dim Query   As String
    Dim ADORs   As New ADODB.Recordset
    
    On Error GoTo ERR_RTN

        
    '------------------------------------------------------------
    ' TB_매출
    '------------------------------------------------------------
    Query = "SELECT    ISNULL(SUM(사용마일리지),0) AS 사용마일리지"
    Query = Query & " FROM TB_매출"
    Query = Query & " WHERE 매출일자 = '" & sSaleDate & "'"
    Query = Query & "   AND 고객코드 = '" & sCustCode & "'"
    Query = Query & "   AND 접수번호 =  " & sID
    Set ADORs = New ADODB.Recordset
    ADORs.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
    
    If ADORs.EOF Then
        Fn_결제마일리지금액 = 0                       '
    Else
        Fn_결제마일리지금액 = Val(ADORs!사용마일리지 & "")  '
    End If
    ADORs.Close:    Set ADORs = Nothing
    
ERR_RTN:
    
    Call Error_Msg("", Err.Source, Err.Number, Err.description)

    Set ADORs = Nothing

End Function




'====================================================================================================
' Procedure : GetCheckSMSSendTel
' DateTime  : 15-06-15
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 문자 메시지 발송 번호 확인
'      전기통신사업법 제84조에 의하여 문자 발신 번호는 반드시 입력 하여야 합니다."
'      주요내용
'      - 발신번호 없이 문자 전송 불가
'      - 발신번호는 수신자가 실제 발신(통화)이 가능한 번호만 허용
'      - 일반번호의 경우 지역번호(02,031등)를 앞자리에 포함한 번호만 허용
'      - 대표번호는 8자리만 입력 허용되며,내선번호 포함불가
'       - 030 번호의 경우 12자리까지 허용
'====================================================================================================
Public Function GetCheckSMSSendTel(ByVal sNumber As String, ByRef sTel() As String, Optional s지역번호확인 As Boolean = True) As Boolean
    
    Dim strTel As String
    Dim Tel_Check  As String
    
    On Error GoTo GetCheckSMSSendTel_Error
    
    GetCheckSMSSendTel = False
    strTel = Trim(Replace(sNumber, "-", ""))
    strTel = Replace(strTel, ")", "")

    ' 기본 사항 확인
    If IsNumeric(strTel) = False Then Exit Function
    If s지역번호확인 = True And Len(strTel) <= 7 Then Exit Function
    If Len(strTel) < 7 Then Exit Function
    
    If Len(strTel) = 7 Then
        Tel_Check = Format(strTel, "-000-0000")
    ElseIf Len(strTel) = 8 Then
        Tel_Check = Format(strTel, "0000-0000")
    ElseIf Len(strTel) = 9 Then
        Tel_Check = Format(strTel, "00-000-0000")
    ElseIf Len(strTel) = 10 Then
         If Left(strTel, 2) = "02" Then
             Tel_Check = Format(strTel, "00-0000-0000")
         Else
             Tel_Check = Format(strTel, "000-000-0000")
         End If
    ElseIf Len(strTel) = 11 Then
        Tel_Check = Format(strTel, "000-0000-0000")
    ElseIf Len(strTel) = 12 Then
         If Left(strTel, 3) = "030" Then
             Tel_Check = Format(strTel, "000-0000-0000")
         End If
        
    ElseIf Len(strTel) >= 13 Then
        
        Tel_Check = ""
    End If
    
    sTel = Split(Tel_Check, "-")
    GetCheckSMSSendTel = True
    
    Exit Function

GetCheckSMSSendTel_Error:
    GetCheckSMSSendTel = False
    MsgBox "Error " & Err.Number & " (" & Err.description & ") in procedure GetCheckSMSSendTel of Form pds_Module"

End Function




Public Function CheckKSNET_OCX_Ver(sFullFileName As String) As String

Dim fVersionInfosize As Long
Dim Data() As Byte
Dim lpBuffer As Long
Dim lpBuffer1 As Long
Dim lpBuffer2 As Long
Dim lpBuffer3 As Long
Dim uLen As Long
Dim ptr1 As Long
Dim buff As String
Dim Query As String
Dim VersionTabList(12) As String
Dim VersionStr As String
Dim strByte() As Byte
Dim sFilePath   As String



    CheckKSNET_OCX_Ver = ""
    
    VersionTabList(0) = "CompanyName"
    VersionTabList(1) = "FileDescription"
    VersionTabList(2) = "FileVersion"
    VersionTabList(3) = "InternalName"
    VersionTabList(4) = "LegalCopyRight"
    VersionTabList(5) = "OriginalFileName"
    VersionTabList(6) = "ProductName"
    VersionTabList(7) = "ProductVersion"
    VersionTabList(8) = "Comments"
    VersionTabList(9) = "LegalTrademarks"
    VersionTabList(10) = "PrivateBuild"
    VersionTabList(11) = "SpecialBuild"

    fVersionInfosize = GetFileVersionInfoSize(sFullFileName, 0)
    ReDim Data(fVersionInfosize)
    Call GetFileVersionInfo(sFullFileName, 0, fVersionInfosize, Data(0))
    Call VerQueryValue(Data(0), "\VarFileInfo\Translation", lpBuffer, uLen)
    ptr1 = VarPtr(lpBuffer)
    CopyMemory lpBuffer1, ByVal ptr1, LenB(uLen)
    CopyMemory lpBuffer2, ByVal lpBuffer1, LenB(lpBuffer2)
    buff = Right("00000000" + CStr(Hex(lpBuffer2)), 8)
    buff = Mid(buff, 5, 2) & Mid(buff, 7, 2) & Mid(buff, 1, 2) & Mid(buff, 3, 2)
    Dim i As Integer
    Dim j As Integer
    For i = 0 To 11 Step 1
        Query = "\StringFileInfo\" + buff + "\" + VersionTabList(i)
        Call VerQueryValue(Data(0), Query, lpBuffer, uLen)
        ReDim strByte(uLen)
        ptr1 = VarPtr(lpBuffer)
        CopyMemory lpBuffer1, ByVal ptr1, LenB(uLen)
        CopyMemory strByte(0), ByVal lpBuffer1, uLen
        VersionStr = StrConv(strByte, vbUnicode)
'        RichTextBox1.Text = RichTextBox1.Text & VersionTabList(i) & ": " & VersionStr & Chr(13) & Chr(10)
        Debug.Print VersionTabList(i) & ": " & VersionStr & Chr(13) & Chr(10)
        
        If i = 2 Then CheckKSNET_OCX_Ver = VersionStr
    Next i
    
End Function



'====================================================================================================
' Procedure : Check_세탁마진
' DateTime  : 2017-02-15
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 가맹점에서 SQL 자료를 직접 변경을 하여 처리하는 문제가 있어서 프로그램에서 확인 가능하도록
'              하기 위해서 만듬

'        1. 로그인시 확인
'        2. 지점입고시 확인
'====================================================================================================
Public Function Check_세탁마진() As Boolean
    Dim Query       As String
    Dim RsSt        As ADODB.Recordset
    Dim RsMa        As ADODB.Recordset
    Dim 적용일자    As String
     
    On Error GoTo ERR_RTN
    
    Check_세탁마진 = False
    
    
    ' 테스트할 경우 처리하지 않는다.
    If InStr(HostCon, "123.141.99.251") > 0 Then
        Check_세탁마진 = True
        Exit Function
    
    End If
    
    
    
    '--------------------------------------------------------------
    ' 2. 서버의 자료를 암호화해서 저장된 자료와 가맹점 자료 구함
    Query = "SELECT    substring(응답코드,1,2) as 의류분류코드"
    Query = Query & " FROM TB_선불카드응답코드"
    Query = Query & " ORDER BY 응답코드 ASC "
    
    Set RsMa = New ADODB.Recordset
    RsMa.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
    
    Query = "SELECT * FROM TB_의류분류  ORDER BY 의류분류코드 ASC "
    Set RsSt = New ADODB.Recordset
    RsSt.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
    '--------------------------------------------------------------
    
    If RsMa.RecordCount <> RsSt.RecordCount Then
        
        Check_세탁마진 = False
        MsgBox "가맹점 마진 정보가 임의로 변경 되었습니다. " & vbNewLine & vbNewLine & "프로그램을 실행할 수 없습니다. " & vbNewLine & vbNewLine & "본사 연락처 : 031-522-2025 ", _
            vbCritical, "경고(" & CStr(RsSt.RecordCount) & "=" & RsMa.RecordCount & ")"
        
        RsSt.Close: Set RsSt = Nothing
        RsMa.Close: Set RsMa = Nothing
        Exit Function
    End If
    
    RsMa.Close: Set RsMa = Nothing
    Do Until RsSt.EOF
        Query = "SELECT    substring(응답코드,1,2) as 의류분류코드, substring(응답코드,5,10) as 세탁마진"
        Query = Query & " FROM TB_선불카드응답코드"
        Query = Query & " WHERE substring(응답코드,1,2) = '" & RsSt.Fields("의류분류코드") & "'"
        
        Set RsMa = New ADODB.Recordset
        RsMa.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly
        
        ' 해당 품목의 마진 정보가 없는경우
        If RsMa.EOF = True Then
            
            Check_세탁마진 = False
            MsgBox "가맹점 마진 정보가 임의로 변경 되었습니다. " & vbNewLine & vbNewLine & "프로그램을 실행할 수 없습니다. " & vbNewLine & vbNewLine & "본사 연락처 : 031-522-2025 ", _
                vbCritical, "경고(" & RsSt.Fields("의류분류코드") & ")"
            
            RsSt.Close: Set RsSt = Nothing
            RsMa.Close: Set RsMa = Nothing
            Exit Function
        
        ' 마진 정보가 동일한 경우
        Else
            If RsMa.Fields("세탁마진") = CStr(RsSt.Fields("세탁마진")) Then
            
            
            ' 마진 정보가 변경된 경우
            Else
                Check_세탁마진 = False
                MsgBox "가맹점 마진 정보가 임의로 변경 되었습니다. " & vbNewLine & vbNewLine & "프로그램을 실행할 수 없습니다. " & vbNewLine & vbNewLine & "본사 연락처 : 031-522-2025 ", _
                    vbCritical, "경고(" & RsSt.Fields("의류분류코드") & ")"
                
                RsSt.Close: Set RsSt = Nothing
                RsMa.Close: Set RsMa = Nothing
                Exit Function
            End If
        End If
        
        RsMa.Close: Set RsMa = Nothing
        RsSt.MoveNext
    Loop
    
    RsSt.Close: Set RsSt = Nothing
    Check_세탁마진 = True
    Exit Function
    
ERR_RTN:
    Check_세탁마진 = False
    Call ERR_SAVE("Check_세탁마진 " & Err.description)

End Function



'====================================================================================================
' Procedure : Check_세탁마진_다운로드
' DateTime  : 2017-02-15
' Author    : pds2004
' Last Edit :
' Return Val:
'----------------------------------------------------------------------------------------------------
' 설     명 : 가맹점에서 SQL 자료를 직접 변경을 하여 처리하는 문제가 있어서 프로그램에서 확인 가능하도록
'              하기 위해서 만듬

'        1. 로그인시 확인
'        2. 지점입고시 확인
'====================================================================================================
Public Function Check_세탁마진_다운로드() As Boolean
    Dim Query       As String
    Dim RsSt        As ADODB.Recordset
    Dim RsMa        As ADODB.Recordset
    Dim 적용일자    As String
    
    On Error GoTo ERR_RTN
    Check_세탁마진_다운로드 = False
    '--------------------------------------------------------------
    ' 1. 다운 로드할 자료 확정
    적용일자 = ""
    Query = "SELECT TOP 1 적용일자 FROM TB_의류분류"
    Query = Query & " ORDER BY 적용일자 DESC"
    Set RsSt = New ADODB.Recordset
    RsSt.Open Query, ADOCon, adOpenForwardOnly, adLockReadOnly

    If RsSt.EOF Then
        ' 자료없을 경우 가장 최근일자를 무조건 다운로드를 한다.
        Query = " SELECT MAX(적용일자) FROM TB_가맹점의류분류"
        Query = Query & "                   WHERE 가맹점코드 = '" & 가맹점정보.가맹점코드 & "'"
        Query = Query & "                     AND 적용일자  <= '" & Format(Date, "YYYY-MM-DD") & "'"
        
    Else
        ' 수신이 안된 내용을 기준으로 다운로드를 한다.
        Query = " SELECT MAX(적용일자) FROM TB_가맹점의류분류"
        Query = Query & "                   WHERE 가맹점코드 = '" & 가맹점정보.가맹점코드 & "'"
        Query = Query & "                     AND (적용일자  >= '" & Format(RsSt(0) & "", "YYYY-MM-DD") & "'"
        Query = Query & "                     AND  적용일자 <= '" & Format(Date, "YYYY-MM-DD") & "')"
    End If
    
    RsSt.Close:    Set RsSt = Nothing
    
    Set RsMa = New ADODB.Recordset
    RsMa.Open Query, HostCon, adOpenForwardOnly, adLockReadOnly

        If Not RsMa.EOF Then
            적용일자 = RsMa(0) & ""
            RsMa.Close
        End If
    
    Set RsMa = Nothing
    '--------------------------------------------------------------
    
    '--------------------------------------------------------------
    ' 2. 서버와 가맹점 자료 구함
    Query = "SELECT    가맹점코드"
    Query = Query & ", 적용일자"
    Query = Query & ", 의류분류코드"
    Query = Query & ", 의류분류명"
    Query = Query & ", ISNULL(세탁마진,0) AS 세탁마진"
    Query = Query & ", ISNULL(외주마진,0) AS 외주마진"
    Query = Query & ", ISNULL(수선마진,0) AS 수선마진"
    Query = Query & " FROM TB_가맹점의류분류"
    Query = Query & " WHERE 가맹점코드 = '" & 가맹점정보.가맹점코드 & "'"
    Query = Query & "   AND 적용일자  = '" & 적용일자 & "'"
    Query = Query & " ORDER BY 의류분류코드 ASC "
    
    Set RsMa = New ADODB.Recordset
    RsMa.Open Query, HostCon, adOpenForwardOnly, adLockReadOnly
    
    '-----------------------------------------------------------------
    ' 3. 서버 자료를 오프라인에서 변경하거나 할 수 있기 때문에 별도저장
    ADOCon.Execute "DELETE FROM  TB_선불카드응답코드 "
    
    ' 난수 생성을 초기화 한다.
    Call Randomize(CInt(Int((6 * Rnd()) + 1)))

    Do Until RsMa.EOF
        Query = "INSERT INTO TB_선불카드응답코드( 응답코드, 내용) "
        Query = Query & " VALUES('" & RsMa.Fields("의류분류코드") & Left(CStr(Rnd() * 100), 2) & RsMa.Fields("세탁마진") & "', '기타오류" & Left(CStr(Rnd() * 100000), 4) & "' )"
        ADOCon.Execute Query
        
        RsMa.MoveNext
    Loop
    
    RsMa.Close: Set RsMa = Nothing
    Check_세탁마진_다운로드 = True
    Exit Function
    
ERR_RTN:
    Check_세탁마진_다운로드 = False
    Call ERR_SAVE("Check_세탁마진_다운로드 " & Err.description)
    
    
End Function

